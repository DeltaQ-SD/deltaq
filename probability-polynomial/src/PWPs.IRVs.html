<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MonoLocalBinds #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeSynonymInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-unrecognised-pragmas #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# HLINT ignore &quot;Redundant bracket&quot; #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="annot"><span class="hs-comment">{-|
Module      : IRVs
Description : Operations on improper random variables
Copyright   : (c) Peter Thompson, 2024
License     : BSD-2-Clause
Maintainer  : peter.thompson@pnsol.com
Stability   : experimental

We build IRVs as an abstract datatype on top of piecewise polynomials and deltas.
IRVs may be represented as PDFs or CDFs. They are polymorphic in a constrained numeric type.

We provide functions to construct IRVs as uniform distributions on an interval; a delta at a point;
and a CDF from a list of point-pairs.

We provide functions to turn an IRV into a set of point-pairs representing either the PDF or CDF.

We define operators for convolution, first-to-finish, all-to-finish and weighted choice.
We also provide an operation to extract the probability mass (&lt;= 1) and the support of the
distribution.

We provide an implementation of the partial order on IRVs.

We enable extraction of centiles and computation of moments.

Note that we can consistently represent 'bottom' using polynomials and 'top' by including deltas.
-}</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="PWPs.IRVs.html"><span class="hs-identifier">PWPs.IRVs</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier">IRV</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier">makePDF</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier">makeCDF</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#constructUniform"><span class="hs-identifier">constructUniform</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#constructDelta"><span class="hs-identifier">constructDelta</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#zeroPDF"><span class="hs-identifier">zeroPDF</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#constructCDF"><span class="hs-identifier">constructCDF</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#constructLinearCDF"><span class="hs-identifier">constructLinearCDF</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#constructGeneralCDF"><span class="hs-identifier">constructGeneralCDF</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#firstToFinish"><span class="hs-identifier">firstToFinish</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#multiFtF"><span class="hs-identifier">multiFtF</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#allToFinish"><span class="hs-identifier">allToFinish</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#multiAtF"><span class="hs-identifier">multiAtF</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#probChoice"><span class="hs-identifier">probChoice</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#multiWeightedChoice"><span class="hs-identifier">multiWeightedChoice</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#%3C%2B%3E"><span class="hs-operator">(PWPs.IRVs.&lt;+&gt;)</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#probMass"><span class="hs-identifier">probMass</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#asDiscreteCDF"><span class="hs-identifier">asDiscreteCDF</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#asDiscretePDF"><span class="hs-identifier">asDiscretePDF</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#compareIRVs"><span class="hs-identifier">compareIRVs</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#support"><span class="hs-identifier">support</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#top"><span class="hs-identifier">top</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#bottom"><span class="hs-identifier">bottom</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#centiles"><span class="hs-identifier">centiles</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#cumulativeMass"><span class="hs-identifier">cumulativeMass</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#shiftIRV"><span class="hs-identifier">shiftIRV</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#Moments"><span class="hs-identifier">Moments</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#moments"><span class="hs-identifier">moments</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#complexityOfIRV"><span class="hs-identifier">complexityOfIRV</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Numeric.Polynomial.Simple.html"><span class="hs-identifier">Numeric.Polynomial.Simple</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Numeric.Polynomial.Simple.html#Poly"><span class="hs-identifier">Poly</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html"><span class="hs-identifier">PWPs.Piecewise</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html"><span class="hs-identifier">PWPs.PiecewiseClasses</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PWPs.PolyDeltas.html"><span class="hs-identifier">PWPs.PolyDeltas</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Numeric.Polynomial.Simple.html"><span class="hs-identifier">Numeric.Polynomial.Simple</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Poly</span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">type</span><span> </span><span id="DistD"><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-var">DistD</span></a></span></span><span> </span><span id="local-6989586621679058525"><span class="annot"><a href="#local-6989586621679058525"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058525"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.PolyDeltas.html#PolyDelta"><span class="hs-identifier hs-type">PolyDelta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058525"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">type</span><span> </span><span id="DistP"><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-var">DistP</span></a></span></span><span> </span><span id="local-6989586621679058526"><span class="annot"><a href="#local-6989586621679058526"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058526"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Numeric.Polynomial.Simple.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058526"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">data</span><span> </span><span id="IRV"><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-var">IRV</span></a></span></span><span> </span><span id="local-6989586621679058314"><span class="annot"><a href="#local-6989586621679058314"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PDF"><span class="annot"><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058314"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="CDF"><span class="annot"><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058314"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679058532"><span id="local-6989586621679058542"><span class="annot"><span class="annottext">IRV a -&gt; IRV a -&gt; Bool
(IRV a -&gt; IRV a -&gt; Bool) -&gt; (IRV a -&gt; IRV a -&gt; Bool) -&gt; Eq (IRV a)
forall a. (Eq a, Num a) =&gt; IRV a -&gt; IRV a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. (Eq a, Num a) =&gt; IRV a -&gt; IRV a -&gt; Bool
== :: IRV a -&gt; IRV a -&gt; Bool
$c/= :: forall a. (Eq a, Num a) =&gt; IRV a -&gt; IRV a -&gt; Bool
/= :: IRV a -&gt; IRV a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679058550"><span id="local-6989586621679058560"><span id="local-6989586621679058564"><span class="annot"><span class="annottext">Int -&gt; IRV a -&gt; ShowS
[IRV a] -&gt; ShowS
IRV a -&gt; String
(Int -&gt; IRV a -&gt; ShowS)
-&gt; (IRV a -&gt; String) -&gt; ([IRV a] -&gt; ShowS) -&gt; Show (IRV a)
forall a. Show a =&gt; Int -&gt; IRV a -&gt; ShowS
forall a. Show a =&gt; [IRV a] -&gt; ShowS
forall a. Show a =&gt; IRV a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; IRV a -&gt; ShowS
showsPrec :: Int -&gt; IRV a -&gt; ShowS
$cshow :: forall a. Show a =&gt; IRV a -&gt; String
show :: IRV a -&gt; String
$cshowList :: forall a. Show a =&gt; [IRV a] -&gt; ShowS
showList :: [IRV a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span id="local-6989586621679058310"><span class="annot"><a href="PWPs.IRVs.html#top"><span class="hs-identifier hs-type">top</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058310"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058310"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058310"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-85"></span><span id="top"><span class="annot"><span class="annottext">top :: forall a. (Ord a, Num a) =&gt; IRV a
</span><a href="PWPs.IRVs.html#top"><span class="hs-identifier hs-var hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, PolyDelta a)] -&gt; DistD a
forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var">makePieces</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; PolyDelta a
forall a. a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#D"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Poly a -&gt; PolyDelta a
forall a. Poly a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#Pd"><span class="hs-identifier hs-var">Pd</span></a></span><span> </span><span class="annot"><span class="annottext">Poly a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span id="local-6989586621679058585"><span class="annot"><a href="PWPs.IRVs.html#bottom"><span class="hs-identifier hs-type">bottom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058585"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058585"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058585"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-88"></span><span id="bottom"><span class="annot"><span class="annottext">bottom :: forall a. (Ord a, Num a) =&gt; IRV a
</span><a href="PWPs.IRVs.html#bottom"><span class="hs-identifier hs-var hs-var">bottom</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; IRV a
forall a. DistP a -&gt; IRV a
</span><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, Poly a)] -&gt; DistP a
forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var">makePieces</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Poly a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span id="local-6989586621679058320"><span class="annot"><a href="PWPs.IRVs.html#cumulativeMass"><span class="hs-identifier hs-type">cumulativeMass</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-92"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-93"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-94"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-95"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058320"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-101"></span><span id="cumulativeMass"><span class="annot"><span class="annottext">cumulativeMass :: forall a.
(Ord a, Enum a, Num a, Fractional a, Evaluable a (DistP a),
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; a -&gt; a
</span><a href="PWPs.IRVs.html#cumulativeMass"><span class="hs-identifier hs-var hs-var">cumulativeMass</span></a></span></span><span> </span><span id="local-6989586621679058608"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679058608"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679058609"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058609"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; DistP a -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058609"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679058608"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="annot"><span class="hs-comment">-- | Make a delta and convolve with it</span></span><span>
</span><span id="line-104"></span><span id="local-6989586621679058327"><span class="annot"><a href="PWPs.IRVs.html#shiftIRV"><span class="hs-identifier hs-type">shiftIRV</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-type">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058327"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-109"></span><span id="shiftIRV"><span class="annot"><span class="annottext">shiftIRV :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
a -&gt; IRV a -&gt; IRV a
</span><a href="PWPs.IRVs.html#shiftIRV"><span class="hs-identifier hs-var hs-var">shiftIRV</span></a></span></span><span> </span><span id="local-6989586621679058634"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058634"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679058635"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679058635"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; IRV a
forall a. (Fractional a, Ord a, Num a, Enum a, Eq a) =&gt; a -&gt; IRV a
</span><a href="PWPs.IRVs.html#constructDelta"><span class="hs-identifier hs-var">constructDelta</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058634"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; IRV a -&gt; IRV a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; IRV a -&gt; IRV a
</span><a href="PWPs.IRVs.html#%3C%2B%3E"><span class="hs-operator hs-var">PWPs.IRVs.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679058635"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="annot"><span class="hs-comment">-- | Force an IRV into a PDF by differentiating if necessary</span></span><span>
</span><span id="line-112"></span><span id="local-6989586621679058332"><span class="annot"><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-type">makePDF</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058332"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058332"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058332"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058332"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058332"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-type">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058332"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058332"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058332"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058332"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-116"></span><span id="makePDF"><span class="annot"><span class="annottext">makePDF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var hs-var">makePDF</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-type">PDF</span></a></span><span> </span><span id="local-6989586621679058652"><span class="annot"><span class="annottext">DistD a
</span><a href="#local-6989586621679058652"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a
</span><a href="#local-6989586621679058652"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-117"></span><span class="annot"><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-type">CDF</span></a></span><span> </span><span id="local-6989586621679058653"><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679058653"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistD a
forall a b c.
(Num a, Eq a, Ord a, StepDifferentiable a b c, Evaluable a b,
 Mergeable c) =&gt;
Pieces a b -&gt; Pieces a c
</span><a href="PWPs.Piecewise.html#differentiatePieces"><span class="hs-identifier hs-var">differentiatePieces</span></a></span><span> </span><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679058653"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><span class="hs-comment">-- | Force an IRV into a CDF by integrating if necessary</span></span><span>
</span><span id="line-120"></span><span id="local-6989586621679058326"><span class="annot"><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-type">makeCDF</span></a></span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058326"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-124"></span><span id="makeCDF"><span class="annot"><span class="annottext">makeCDF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var hs-var">makeCDF</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-type">CDF</span></a></span><span> </span><span id="local-6989586621679058668"><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679058668"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679058668"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-125"></span><span class="hs-comment">-- assume PDFs are 0 at 0</span><span>
</span><span id="line-126"></span><span class="annot"><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-type">PDF</span></a></span><span> </span><span id="local-6989586621679058669"><span class="annot"><span class="annottext">DistD a
</span><a href="#local-6989586621679058669"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; DistP a
forall a b c.
(Num a, Eq a, Ord a, StepIntegrable a b c, Evaluable a c) =&gt;
Pieces a b -&gt; Pieces a c
</span><a href="PWPs.Piecewise.html#integratePieces"><span class="hs-identifier hs-var">integratePieces</span></a></span><span> </span><span class="annot"><span class="annottext">DistD a
</span><a href="#local-6989586621679058669"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-127"></span><span>
</span><span id="line-128"></span><span class="annot"><span class="hs-comment">-- | Construct a PDF with uniform probability from 0 to the given value</span></span><span>
</span><span id="line-129"></span><span id="local-6989586621679058671"><span class="annot"><a href="PWPs.IRVs.html#constructUniform"><span class="hs-identifier hs-type">constructUniform</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058671"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058671"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058671"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058671"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058671"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058671"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058671"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-130"></span><span id="constructUniform"><span class="annot"><span class="annottext">constructUniform :: forall a. (Fractional a, Ord a, Num a, Enum a, Eq a) =&gt; a -&gt; IRV a
</span><a href="PWPs.IRVs.html#constructUniform"><span class="hs-identifier hs-var hs-var">constructUniform</span></a></span></span><span> </span><span id="local-6989586621679058688"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058688"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058688"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid interval&quot;</span></span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, PolyDelta a)] -&gt; DistD a
forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var">makePieces</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Poly a -&gt; PolyDelta a
forall a. Poly a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#Pd"><span class="hs-identifier hs-var">Pd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Poly a
forall a. a -&gt; Poly a
</span><a href="Numeric.Polynomial.Simple.html#constant"><span class="hs-identifier hs-var">Poly.constant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058688"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058688"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Poly a -&gt; PolyDelta a
forall a. Poly a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#Pd"><span class="hs-identifier hs-var">Pd</span></a></span><span> </span><span class="annot"><span class="annottext">Poly a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><span class="hs-comment">-- | Construct a PDF that is a delta function at the given value</span></span><span>
</span><span id="line-136"></span><span id="local-6989586621679058330"><span class="annot"><a href="PWPs.IRVs.html#constructDelta"><span class="hs-identifier hs-type">constructDelta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058330"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058330"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058330"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058330"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058330"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058330"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058330"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-137"></span><span id="constructDelta"><span class="annot"><span class="annottext">constructDelta :: forall a. (Fractional a, Ord a, Num a, Enum a, Eq a) =&gt; a -&gt; IRV a
</span><a href="PWPs.IRVs.html#constructDelta"><span class="hs-identifier hs-var hs-var">constructDelta</span></a></span></span><span> </span><span id="local-6989586621679058718"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058718"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058718"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid value&quot;</span></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058718"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, PolyDelta a)] -&gt; DistD a
forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var">makePieces</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; PolyDelta a
forall a. a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#D"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Poly a -&gt; PolyDelta a
forall a. Poly a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#Pd"><span class="hs-identifier hs-var">Pd</span></a></span><span> </span><span class="annot"><span class="annottext">Poly a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, PolyDelta a)] -&gt; DistD a
forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var">makePieces</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Poly a -&gt; PolyDelta a
forall a. Poly a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#Pd"><span class="hs-identifier hs-var">Pd</span></a></span><span> </span><span class="annot"><span class="annottext">Poly a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058718"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; PolyDelta a
forall a. a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#D"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058718"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Poly a -&gt; PolyDelta a
forall a. Poly a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#Pd"><span class="hs-identifier hs-var">Pd</span></a></span><span> </span><span class="annot"><span class="annottext">Poly a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><span class="hs-comment">-- | PDF with zero value everywhere</span></span><span>
</span><span id="line-143"></span><span id="local-6989586621679058359"><span class="annot"><a href="PWPs.IRVs.html#zeroPDF"><span class="hs-identifier hs-type">zeroPDF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058359"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058359"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058359"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058359"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058359"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058359"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-144"></span><span id="zeroPDF"><span class="annot"><span class="annottext">zeroPDF :: forall a. (Fractional a, Ord a, Num a, Enum a, Eq a) =&gt; IRV a
</span><a href="PWPs.IRVs.html#zeroPDF"><span class="hs-identifier hs-var hs-var">zeroPDF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, PolyDelta a)] -&gt; DistD a
forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var">makePieces</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Poly a -&gt; PolyDelta a
forall a. Poly a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#Pd"><span class="hs-identifier hs-var">Pd</span></a></span><span> </span><span class="annot"><span class="annottext">Poly a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span id="local-6989586621679058361"><span class="annot"><a href="PWPs.IRVs.html#monotonicFromZero"><span class="hs-identifier hs-type">monotonicFromZero</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058361"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058361"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679058361"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-147"></span><span id="monotonicFromZero"><span class="annot"><span class="annottext">monotonicFromZero :: forall a. (Ord a, Num a) =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#monotonicFromZero"><span class="hs-identifier hs-var hs-var">monotonicFromZero</span></a></span></span><span> </span><span id="local-6989586621679058743"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058743"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058743"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty list&quot;</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058743"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; Bool
</span><a href="PWPs.Piecewise.html#monotonic"><span class="hs-identifier hs-var">monotonic</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058743"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span id="local-6989586621679058367"><span class="annot"><a href="PWPs.IRVs.html#repeatedPoint"><span class="hs-identifier hs-type">repeatedPoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058367"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679058367"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-150"></span><span id="repeatedPoint"><span class="annot"><span class="annottext">repeatedPoint :: forall a. Eq a =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#repeatedPoint"><span class="hs-identifier hs-var hs-var">repeatedPoint</span></a></span></span><span> </span><span id="local-6989586621679058754"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058754"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool) -&gt; [Bool] -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058754"><span class="hs-keyword hs-var">as</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058754"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><span class="hs-comment">{-| Construct a CDF from a list of (time, probability) pairs, which start at (0,0) and are monotonic.
     If the next time is strictly greater than the previous one, construct a linear interpolation between
     the two probabilities. If the next time is the same as the previous one, construct a Heaviside step
     between the two probabilities.
-}</span></span><span>
</span><span id="line-157"></span><span id="local-6989586621679058378"><span class="annot"><a href="PWPs.IRVs.html#constructGeneralCDF"><span class="hs-identifier hs-type">constructGeneralCDF</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058378"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058378"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058378"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058378"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058378"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058378"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058378"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058378"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-159"></span><span id="constructGeneralCDF"><span class="annot"><span class="annottext">constructGeneralCDF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a) =&gt;
[(a, a)] -&gt; IRV a
</span><a href="PWPs.IRVs.html#constructGeneralCDF"><span class="hs-identifier hs-var hs-var">constructGeneralCDF</span></a></span></span><span> </span><span id="local-6989586621679058797"><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058797"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(a, a)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058797"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Insufficient points&quot;</span></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. (Ord a, Num a) =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#monotonicFromZero"><span class="hs-identifier hs-var">monotonicFromZero</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, a) -&gt; a) -&gt; [(a, a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058797"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Basepoints not monotonic&quot;</span></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. (Ord a, Num a) =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#monotonicFromZero"><span class="hs-identifier hs-var">monotonicFromZero</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058801"><span class="hs-identifier hs-var">probabilities</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probabilities not monotonic&quot;</span></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058801"><span class="hs-identifier hs-var">probabilities</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probability exceeds one&quot;</span></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistP a -&gt; IRV a
forall a. DistP a -&gt; IRV a
</span><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; IRV a)
-&gt; ([(a, Poly a)] -&gt; DistP a) -&gt; [(a, Poly a)] -&gt; IRV a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a
forall b a. Mergeable b =&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#mergePieces"><span class="hs-identifier hs-var">mergePieces</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; DistP a)
-&gt; ([(a, Poly a)] -&gt; DistP a) -&gt; [(a, Poly a)] -&gt; DistP a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(a, Poly a)] -&gt; DistP a
forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var">makePieces</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, a) -&gt; [(a, a)] -&gt; [(a, Poly a)]
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a) =&gt;
(a, a) -&gt; [(a, a)] -&gt; [(a, Poly a)]
</span><a href="#local-6989586621679058806"><span class="hs-identifier hs-var">goCDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, a)] -&gt; (a, a)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058797"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, a)] -&gt; [(a, a)]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058797"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621679058801"><span class="annot"><span class="annottext">probabilities :: [a]
</span><a href="#local-6989586621679058801"><span class="hs-identifier hs-var hs-var">probabilities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; a) -&gt; [(a, a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058797"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span id="local-6989586621679058391"><span class="annot"><a href="#local-6989586621679058806"><span class="hs-identifier hs-type">goCDF</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Numeric.Polynomial.Simple.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058391"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- construct a constant poly from last point</span><span>
</span><span id="line-173"></span><span>    </span><span id="local-6989586621679058806"><span class="annot"><span class="annottext">goCDF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a) =&gt;
(a, a) -&gt; [(a, a)] -&gt; [(a, Poly a)]
</span><a href="#local-6989586621679058806"><span class="hs-identifier hs-var hs-var">goCDF</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679058826"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058826"><span class="hs-identifier hs-var">bf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679058827"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058827"><span class="hs-identifier hs-var">pf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058826"><span class="hs-identifier hs-var">bf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Poly a
forall a. a -&gt; Poly a
</span><a href="Numeric.Polynomial.Simple.html#constant"><span class="hs-identifier hs-var">Poly.constant</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058827"><span class="hs-identifier hs-var">pf</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="#local-6989586621679058806"><span class="hs-identifier hs-var">goCDF</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679058828"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058828"><span class="hs-identifier hs-var">bm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679058829"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058829"><span class="hs-identifier hs-var">pm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679058830"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058830"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679058831"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058831"><span class="hs-identifier hs-var">pn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679058832"><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058832"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058828"><span class="hs-identifier hs-var">bm</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058830"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; [(a, a)] -&gt; [(a, Poly a)]
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a) =&gt;
(a, a) -&gt; [(a, a)] -&gt; [(a, Poly a)]
</span><a href="#local-6989586621679058806"><span class="hs-identifier hs-var">goCDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058830"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058831"><span class="hs-identifier hs-var">pn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058832"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-177"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058828"><span class="hs-identifier hs-var">bm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; (a, a) -&gt; Poly a
forall a. (Eq a, Fractional a) =&gt; (a, a) -&gt; (a, a) -&gt; Poly a
</span><a href="Numeric.Polynomial.Simple.html#lineFromTo"><span class="hs-identifier hs-var">Poly.lineFromTo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058828"><span class="hs-identifier hs-var">bm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058829"><span class="hs-identifier hs-var">pm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058830"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058831"><span class="hs-identifier hs-var">pn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, Poly a) -&gt; [(a, Poly a)] -&gt; [(a, Poly a)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; [(a, a)] -&gt; [(a, Poly a)]
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a) =&gt;
(a, a) -&gt; [(a, a)] -&gt; [(a, Poly a)]
</span><a href="#local-6989586621679058806"><span class="hs-identifier hs-var">goCDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058830"><span class="hs-identifier hs-var">bn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058831"><span class="hs-identifier hs-var">pn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058832"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="annot"><span class="hs-comment">{-| Construct a CDF from a list of values, treating each new value as a step up from the one before, assuming we start at 0
| First interval is a zero polynomial: subsequent intervals have a constant polynomial.
-}</span></span><span>
</span><span id="line-182"></span><span id="local-6989586621679058834"><span class="annot"><a href="PWPs.IRVs.html#constructCDF"><span class="hs-identifier hs-type">constructCDF</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058834"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058834"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058834"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058834"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058834"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058834"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058834"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058834"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-183"></span><span id="constructCDF"><span class="annot"><span class="annottext">constructCDF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a) =&gt;
[(a, a)] -&gt; IRV a
</span><a href="PWPs.IRVs.html#constructCDF"><span class="hs-identifier hs-var hs-var">constructCDF</span></a></span></span><span> </span><span id="local-6989586621679058865"><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058865"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(a, a)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058865"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Insufficient points&quot;</span></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. (Ord a, Num a) =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#monotonicFromZero"><span class="hs-identifier hs-var">monotonicFromZero</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058866"><span class="hs-identifier hs-var">basepoints</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Basepoints not monotonic&quot;</span></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#repeatedPoint"><span class="hs-identifier hs-var">repeatedPoint</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058866"><span class="hs-identifier hs-var">basepoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Repeated basepoint&quot;</span></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. (Ord a, Num a) =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#monotonicFromZero"><span class="hs-identifier hs-var">monotonicFromZero</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058867"><span class="hs-identifier hs-var">probabilities</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probabilities not monotonic&quot;</span></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058867"><span class="hs-identifier hs-var">probabilities</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probability exceeds one&quot;</span></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistP a -&gt; IRV a
forall a. DistP a -&gt; IRV a
</span><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; IRV a)
-&gt; ([(a, Poly a)] -&gt; DistP a) -&gt; [(a, Poly a)] -&gt; IRV a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(a, Poly a)] -&gt; DistP a
forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var">makePieces</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; [Poly a] -&gt; [(a, Poly a)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058866"><span class="hs-identifier hs-var">basepoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; Poly a) -&gt; [a] -&gt; [Poly a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Poly a
forall a. a -&gt; Poly a
</span><a href="Numeric.Polynomial.Simple.html#constant"><span class="hs-identifier hs-var">Poly.constant</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058867"><span class="hs-identifier hs-var">probabilities</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621679058866"><span class="annot"><span class="annottext">basepoints :: [a]
</span><a href="#local-6989586621679058866"><span class="hs-identifier hs-var hs-var">basepoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; a) -&gt; [(a, a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058865"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679058867"><span class="annot"><span class="annottext">probabilities :: [a]
</span><a href="#local-6989586621679058867"><span class="hs-identifier hs-var hs-var">probabilities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; a) -&gt; [(a, a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058865"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><span class="hs-comment">-- | Construct a CDF from a list of values, interpolating linearly between each pair of points</span></span><span>
</span><span id="line-196"></span><span id="local-6989586621679058868"><span class="annot"><a href="PWPs.IRVs.html#constructLinearCDF"><span class="hs-identifier hs-type">constructLinearCDF</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058868"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058868"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058868"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058868"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058868"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058868"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058868"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058868"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-198"></span><span id="constructLinearCDF"><span class="annot"><span class="annottext">constructLinearCDF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a) =&gt;
[(a, a)] -&gt; IRV a
</span><a href="PWPs.IRVs.html#constructLinearCDF"><span class="hs-identifier hs-var hs-var">constructLinearCDF</span></a></span></span><span> </span><span id="local-6989586621679058914"><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058914"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(a, a)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058914"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Insufficient points&quot;</span></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. (Ord a, Num a) =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#monotonicFromZero"><span class="hs-identifier hs-var">monotonicFromZero</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058915"><span class="hs-identifier hs-var">basepoints</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Basepoints not monotonic&quot;</span></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#repeatedPoint"><span class="hs-identifier hs-var">repeatedPoint</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058915"><span class="hs-identifier hs-var">basepoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Repeated basepoint&quot;</span></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. (Ord a, Num a) =&gt; [a] -&gt; Bool
</span><a href="PWPs.IRVs.html#monotonicFromZero"><span class="hs-identifier hs-var">monotonicFromZero</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058916"><span class="hs-identifier hs-var">probabilities</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probabilities not monotonic&quot;</span></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; Bool
forall a. Eq a =&gt; a -&gt; [a] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058918"><span class="hs-identifier hs-var">steps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Zero-width interval&quot;</span></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058916"><span class="hs-identifier hs-var">probabilities</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probability exceeds one&quot;</span></span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistP a -&gt; IRV a
forall a. DistP a -&gt; IRV a
</span><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; IRV a)
-&gt; ([(a, Poly a)] -&gt; DistP a) -&gt; [(a, Poly a)] -&gt; IRV a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(a, Poly a)] -&gt; DistP a
forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var">makePieces</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; [Poly a] -&gt; [(a, Poly a)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058915"><span class="hs-identifier hs-var">basepoints</span></a></span><span> </span><span class="annot"><span class="annottext">[Poly a]
</span><a href="#local-6989586621679058919"><span class="hs-identifier hs-var">segments</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">{-
        Each linear polynomial has the form y = sx + c, where s is given by the difference
        in successive probabilities divided by the difference in succesive basepoints.
        The constant c is fixed by the constraint that we need to pass through the point (xn,yn),
        so cn = yn - xnsn
    -}</span><span>
</span><span id="line-213"></span><span>    </span><span id="local-6989586621679058915"><span class="annot"><span class="annottext">basepoints :: [a]
</span><a href="#local-6989586621679058915"><span class="hs-identifier hs-var hs-var">basepoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; a) -&gt; [(a, a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058914"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679058916"><span class="annot"><span class="annottext">probabilities :: [a]
</span><a href="#local-6989586621679058916"><span class="hs-identifier hs-var hs-var">probabilities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, a) -&gt; a) -&gt; [(a, a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058914"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621679058918"><span class="annot"><span class="annottext">steps :: [a]
</span><a href="#local-6989586621679058918"><span class="hs-identifier hs-var hs-var">steps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; [a] -&gt; [a] -&gt; [a]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058915"><span class="hs-identifier hs-var">basepoints</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058915"><span class="hs-identifier hs-var">basepoints</span></a></span><span> </span><span class="hs-comment">-- width of each interval</span><span>
</span><span id="line-216"></span><span>    </span><span id="local-6989586621679058920"><span class="annot"><span class="annottext">stepUps :: [a]
</span><a href="#local-6989586621679058920"><span class="hs-identifier hs-var hs-var">stepUps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; [a] -&gt; [a] -&gt; [a]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058916"><span class="hs-identifier hs-var">probabilities</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058916"><span class="hs-identifier hs-var">probabilities</span></a></span><span> </span><span class="hs-comment">-- increments in probabilities</span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621679058921"><span class="annot"><span class="annottext">slopes :: [a]
</span><a href="#local-6989586621679058921"><span class="hs-identifier hs-var hs-var">slopes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a) -&gt; [a] -&gt; [a] -&gt; [a]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(/)</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058920"><span class="hs-identifier hs-var">stepUps</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058918"><span class="hs-identifier hs-var">steps</span></a></span><span> </span><span class="hs-comment">-- slope of each segment</span><span>
</span><span id="line-218"></span><span>    </span><span id="local-6989586621679058919"><span class="annot"><span class="annottext">segments :: [Poly a]
</span><a href="#local-6989586621679058919"><span class="hs-identifier hs-var hs-var">segments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a -&gt; a -&gt; Poly a) -&gt; [a] -&gt; [a] -&gt; [a] -&gt; [Poly a]
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; [d]
</span><span class="hs-identifier hs-var">zipWith3</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a -&gt; Poly a
forall {a}. Num a =&gt; a -&gt; a -&gt; a -&gt; Poly a
</span><a href="#local-6989586621679058923"><span class="hs-identifier hs-var">makeSegment</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058916"><span class="hs-identifier hs-var">probabilities</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058915"><span class="hs-identifier hs-var">basepoints</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058921"><span class="hs-identifier hs-var">slopes</span></a></span><span>
</span><span id="line-220"></span><span>            </span><span class="annot"><span class="annottext">[Poly a] -&gt; [Poly a] -&gt; [Poly a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a -&gt; Poly a
forall a. a -&gt; Poly a
</span><a href="Numeric.Polynomial.Simple.html#constant"><span class="hs-identifier hs-var">Poly.constant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679058916"><span class="hs-identifier hs-var">probabilities</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-221"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621679058923"><span class="annot"><span class="annottext">makeSegment :: a -&gt; a -&gt; a -&gt; Poly a
</span><a href="#local-6989586621679058923"><span class="hs-identifier hs-var hs-var">makeSegment</span></a></span></span><span> </span><span id="local-6989586621679058928"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058928"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679058929"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058929"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679058930"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058930"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Poly a
forall a. Num a =&gt; [a] -&gt; Poly a
</span><a href="Numeric.Polynomial.Simple.html#fromCoefficients"><span class="hs-identifier hs-var">Poly.fromCoefficients</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058928"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058929"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058930"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058930"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><span class="hs-comment">{-| Return a sequence of (Left) (time, step base) (the lower value of the jump at that point)
     or (Right) a sequence of (Time, Probability). The sequence is monotonically increasing in Time.
-}</span></span><span>
</span><span id="line-227"></span><span class="annot"><a href="PWPs.IRVs.html#asDiscreteCDF"><span class="hs-identifier hs-type">asDiscreteCDF</span></a></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679058408"><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-229"></span><span>     </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-233"></span><span id="asDiscreteCDF"><span class="annot"><span class="annottext">asDiscreteCDF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; Int -&gt; [Either (a, a) [(a, a)]]
</span><a href="PWPs.IRVs.html#asDiscreteCDF"><span class="hs-identifier hs-var hs-var">asDiscreteCDF</span></a></span></span><span> </span><span id="local-6989586621679058986"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679058986"><span class="hs-identifier hs-var">xirv</span></a></span></span><span> </span><span id="local-6989586621679058987"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679058987"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679058987"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Either (a, a) [(a, a)]]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid number of points&quot;</span></span><span>
</span><span id="line-236"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058988"><span class="hs-identifier hs-var">processRepeatedPoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistP a -&gt; a -&gt; [Either (a, a) [(a, a)]]
forall a b.
(Ord a, Enum a, Eq a, Fractional a, Num a, Displayable a b) =&gt;
Pieces a b -&gt; a -&gt; [Either (a, a) [(a, a)]]
</span><a href="PWPs.Piecewise.html#displayPolyDeltaIntervals"><span class="hs-identifier hs-var">displayPolyDeltaIntervals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679058986"><span class="hs-identifier hs-var">xirv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058990"><span class="hs-identifier hs-var">spacing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-238"></span><span>    </span><span id="local-6989586621679058991"><span class="annot"><span class="annottext">width :: a
</span><a href="#local-6989586621679058991"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; (a, a)
forall a. (Eq a, Fractional a) =&gt; IRV a -&gt; (a, a)
</span><a href="PWPs.IRVs.html#support"><span class="hs-identifier hs-var">support</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679058986"><span class="hs-identifier hs-var">xirv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; (a, a)
forall a. (Eq a, Fractional a) =&gt; IRV a -&gt; (a, a)
</span><a href="PWPs.IRVs.html#support"><span class="hs-identifier hs-var">support</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679058986"><span class="hs-identifier hs-var">xirv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>    </span><span id="local-6989586621679058990"><span class="annot"><span class="annottext">spacing :: a
</span><a href="#local-6989586621679058990"><span class="hs-identifier hs-var hs-var">spacing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058991"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Prelude.fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679058987"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><a href="#local-6989586621679058988"><span class="hs-identifier hs-type">processRepeatedPoints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058408"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-241"></span><span>    </span><span id="local-6989586621679058988"><span class="annot"><span class="annottext">processRepeatedPoints :: [Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058988"><span class="hs-identifier hs-var hs-var">processRepeatedPoints</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- stop when list is empty</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="#local-6989586621679058988"><span class="hs-identifier hs-var">processRepeatedPoints</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679058992"><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058992"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058992"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- nothing to do when only one element left</span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><a href="#local-6989586621679058988"><span class="hs-identifier hs-var">processRepeatedPoints</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679058993"><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058993"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679058994"><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058994"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-245"></span><span>            </span><span id="local-6989586621679058995"><span class="annot"><span class="annottext">y :: Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058995"><span class="hs-identifier hs-var hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]] -&gt; Either (a, a) [(a, a)]
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058994"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-246"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-247"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058993"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058995"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-248"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679058996"><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058996"><span class="hs-identifier hs-var">x0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679058997"><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058997"><span class="hs-identifier hs-var">y0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-249"></span><span>                    </span><span class="hs-comment">-- both are just lists of points, assumed to be non-empty</span><span>
</span><span id="line-250"></span><span>                    </span><span class="hs-keyword">let</span><span>
</span><span id="line-251"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621679058998"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058998"><span class="hs-identifier hs-var">xLastPoint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679058999"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058999"><span class="hs-identifier hs-var">xLastValue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, a)] -&gt; (a, a)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058996"><span class="hs-identifier hs-var">x0</span></a></span><span>
</span><span id="line-252"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621679059000"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059000"><span class="hs-identifier hs-var">yFirstPoint</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059001"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059001"><span class="hs-identifier hs-var">yFirstValue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, a)] -&gt; (a, a)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058997"><span class="hs-identifier hs-var">y0</span></a></span><span>
</span><span id="line-253"></span><span>                        </span><span id="local-6989586621679059002"><span class="annot"><span class="annottext">xMinusLastPoint :: Either (a, a) [(a, a)]
</span><a href="#local-6989586621679059002"><span class="hs-identifier hs-var hs-var">xMinusLastPoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, a)] -&gt; Either (a, a) [(a, a)]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">([(a, a)] -&gt; Either (a, a) [(a, a)])
-&gt; ([(a, a)] -&gt; [(a, a)]) -&gt; [(a, a)] -&gt; Either (a, a) [(a, a)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)] -&gt; [(a, a)]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">init</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058996"><span class="hs-identifier hs-var">x0</span></a></span><span>
</span><span id="line-254"></span><span>                        </span><span id="local-6989586621679059004"><span class="annot"><span class="annottext">yMinusFirstPoint :: Either (a, a) [(a, a)]
</span><a href="#local-6989586621679059004"><span class="hs-identifier hs-var hs-var">yMinusFirstPoint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, a)] -&gt; Either (a, a) [(a, a)]
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">([(a, a)] -&gt; Either (a, a) [(a, a)])
-&gt; ([(a, a)] -&gt; [(a, a)]) -&gt; [(a, a)] -&gt; Either (a, a) [(a, a)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(a, a)] -&gt; [(a, a)]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, a)]
</span><a href="#local-6989586621679058997"><span class="hs-identifier hs-var">y0</span></a></span><span>
</span><span id="line-255"></span><span>                    </span><span class="hs-keyword">in</span><span>
</span><span id="line-256"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058998"><span class="hs-identifier hs-var">xLastPoint</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059000"><span class="hs-identifier hs-var">yFirstPoint</span></a></span><span>
</span><span id="line-257"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058993"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
-&gt; [Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058988"><span class="hs-identifier hs-var">processRepeatedPoints</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058994"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-comment">-- no repeated point, so nothing to do</span><span>
</span><span id="line-258"></span><span>                            </span><span class="hs-keyword">else</span><span>
</span><span id="line-259"></span><span>                                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058999"><span class="hs-identifier hs-var">xLastValue</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059001"><span class="hs-identifier hs-var">yFirstValue</span></a></span><span> </span><span class="hs-comment">-- we have a jump, so report it as a Left</span><span>
</span><span id="line-260"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679059002"><span class="hs-identifier hs-var">xMinusLastPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
-&gt; [Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, a) -&gt; Either (a, a) [(a, a)]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058998"><span class="hs-identifier hs-var">xLastPoint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679058999"><span class="hs-identifier hs-var">xLastValue</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
-&gt; [Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058988"><span class="hs-identifier hs-var">processRepeatedPoints</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058994"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-261"></span><span>                                    </span><span class="hs-keyword">else</span><span>
</span><span id="line-262"></span><span>                                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058994"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058995"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- reached the end</span><span>
</span><span id="line-263"></span><span>                                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058993"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
-&gt; [Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679059004"><span class="hs-identifier hs-var">yMinusFirstPoint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-264"></span><span>                                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058993"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
-&gt; [Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058988"><span class="hs-identifier hs-var">processRepeatedPoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679059004"><span class="hs-identifier hs-var">yMinusFirstPoint</span></a></span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
-&gt; [Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058994"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                </span><span class="hs-comment">-- if we have Lefts, just pass them through</span><span>
</span><span id="line-266"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
</span><a href="#local-6989586621679058993"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Either (a, a) [(a, a)]
-&gt; [Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]] -&gt; [Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058988"><span class="hs-identifier hs-var">processRepeatedPoints</span></a></span><span> </span><span class="annot"><span class="annottext">[Either (a, a) [(a, a)]]
</span><a href="#local-6989586621679058994"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="annot"><span class="hs-comment">{-| Return a sequence of (Left) Impulse Probablity mass (equivalent to the
     integral of the Heaviside function at that point) or (Right) a sequence
     of Time and Probability Density. The sequence is monotonically increasing in Time.
-}</span></span><span>
</span><span id="line-272"></span><span id="local-6989586621679058424"><span class="annot"><a href="PWPs.IRVs.html#asDiscretePDF"><span class="hs-identifier hs-type">asDiscretePDF</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-type">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058424"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span></span><span>
</span><span id="line-277"></span><span id="asDiscretePDF"><span class="annot"><span class="annottext">asDiscretePDF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; Int -&gt; [Either (a, a) [(a, a)]]
</span><a href="PWPs.IRVs.html#asDiscretePDF"><span class="hs-identifier hs-var hs-var">asDiscretePDF</span></a></span></span><span> </span><span id="local-6989586621679059038"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059038"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679059039"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679059039"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679059039"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Either (a, a) [(a, a)]]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid number of points&quot;</span></span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; a -&gt; [Either (a, a) [(a, a)]]
forall a b.
(Ord a, Enum a, Eq a, Fractional a, Num a, Displayable a b) =&gt;
Pieces a b -&gt; a -&gt; [Either (a, a) [(a, a)]]
</span><a href="PWPs.Piecewise.html#displayPolyDeltaIntervals"><span class="hs-identifier hs-var">displayPolyDeltaIntervals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059038"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059040"><span class="hs-identifier hs-var">spacing</span></a></span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621679059041"><span class="annot"><span class="annottext">width :: a
</span><a href="#local-6989586621679059041"><span class="hs-identifier hs-var hs-var">width</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; (a, a)
forall a. (Eq a, Fractional a) =&gt; IRV a -&gt; (a, a)
</span><a href="PWPs.IRVs.html#support"><span class="hs-identifier hs-var">support</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059038"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; (a, a)
forall a. (Eq a, Fractional a) =&gt; IRV a -&gt; (a, a)
</span><a href="PWPs.IRVs.html#support"><span class="hs-identifier hs-var">support</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059038"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621679059040"><span class="annot"><span class="annottext">spacing :: a
</span><a href="#local-6989586621679059040"><span class="hs-identifier hs-var hs-var">spacing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059041"><span class="hs-identifier hs-var">width</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Prelude.fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679059039"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-284"></span><span>
</span><span id="line-285"></span><span id="local-6989586621679058429"><span class="annot"><a href="PWPs.IRVs.html#firstToFinish"><span class="hs-identifier hs-type">firstToFinish</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058429"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-290"></span><span id="firstToFinish"><span class="annot"><span class="annottext">firstToFinish :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; IRV a -&gt; IRV a
</span><a href="PWPs.IRVs.html#firstToFinish"><span class="hs-identifier hs-var hs-var">firstToFinish</span></a></span></span><span> </span><span id="local-6989586621679059066"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059066"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679059067"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059067"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; IRV a
forall a. DistP a -&gt; IRV a
</span><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059068"><span class="hs-identifier hs-var">cdfOfx</span></a></span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a -&gt; DistP a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059070"><span class="hs-identifier hs-var">cdfOfy</span></a></span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a -&gt; DistP a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059068"><span class="hs-identifier hs-var">cdfOfx</span></a></span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a -&gt; DistP a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059070"><span class="hs-identifier hs-var">cdfOfy</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621679059068"><span class="annot"><span class="annottext">cdfOfx :: DistP a
</span><a href="#local-6989586621679059068"><span class="hs-identifier hs-var hs-var">cdfOfx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059066"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-293"></span><span>    </span><span id="local-6989586621679059070"><span class="annot"><span class="annottext">cdfOfy :: DistP a
</span><a href="#local-6989586621679059070"><span class="hs-identifier hs-var hs-var">cdfOfy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059067"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="annot"><span class="hs-comment">{-| Compute the first-to-finsh of a list of IRVs by multiplying inverse CDFs then inverting
If there is nothing finish the result is bottom
-}</span></span><span>
</span><span id="line-298"></span><span id="local-6989586621679058433"><span class="annot"><a href="PWPs.IRVs.html#multiFtF"><span class="hs-identifier hs-type">multiFtF</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058433"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058433"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-302"></span><span id="multiFtF"><span class="annot"><span class="annottext">multiFtF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
[IRV a] -&gt; IRV a
</span><a href="PWPs.IRVs.html#multiFtF"><span class="hs-identifier hs-var hs-var">multiFtF</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IRV a
forall a. (Ord a, Num a) =&gt; IRV a
</span><a href="PWPs.IRVs.html#bottom"><span class="hs-identifier hs-var">bottom</span></a></span><span>
</span><span id="line-303"></span><span class="annot"><a href="PWPs.IRVs.html#multiFtF"><span class="hs-identifier hs-var">multiFtF</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679059093"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059093"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059093"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-304"></span><span class="hs-comment">-- now know we have at least two, so head and tail are safe</span><span>
</span><span id="line-305"></span><span class="annot"><a href="PWPs.IRVs.html#multiFtF"><span class="hs-identifier hs-var">multiFtF</span></a></span><span> </span><span id="local-6989586621679059094"><span class="annot"><span class="annottext">[IRV a]
</span><a href="#local-6989586621679059094"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; IRV a
forall a. DistP a -&gt; IRV a
</span><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; IRV a) -&gt; DistP a -&gt; IRV a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a
forall {a}. Pieces a (Poly a) -&gt; Pieces a (Poly a)
</span><a href="#local-6989586621679059095"><span class="hs-identifier hs-var">invert</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; DistP a) -&gt; DistP a -&gt; DistP a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; DistP a -&gt; DistP a) -&gt; DistP a -&gt; [DistP a] -&gt; DistP a
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a -&gt; DistP a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(*)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DistP a] -&gt; DistP a
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[DistP a]
</span><a href="#local-6989586621679059097"><span class="hs-identifier hs-var">icdfs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DistP a] -&gt; [DistP a]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[DistP a]
</span><a href="#local-6989586621679059097"><span class="hs-identifier hs-var">icdfs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>    </span><span id="local-6989586621679059095"><span class="annot"><span class="annottext">invert :: Pieces a (Poly a) -&gt; Pieces a (Poly a)
</span><a href="#local-6989586621679059095"><span class="hs-identifier hs-var hs-var">invert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Poly a -&gt; Poly a -&gt; Poly a)
-&gt; Poly a -&gt; Pieces a (Poly a) -&gt; Pieces a (Poly a)
forall b a. (b -&gt; b -&gt; b) -&gt; b -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#applyObject"><span class="hs-identifier hs-var">applyObject</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Poly a
forall a. a -&gt; Poly a
</span><a href="Numeric.Polynomial.Simple.html#constant"><span class="hs-identifier hs-var">Poly.constant</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621679059097"><span class="annot"><span class="annottext">icdfs :: [DistP a]
</span><a href="#local-6989586621679059097"><span class="hs-identifier hs-var hs-var">icdfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IRV a -&gt; DistP a) -&gt; [IRV a] -&gt; [DistP a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistP a -&gt; DistP a
forall {a}. Pieces a (Poly a) -&gt; Pieces a (Poly a)
</span><a href="#local-6989586621679059095"><span class="hs-identifier hs-var">invert</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; DistP a) -&gt; (IRV a -&gt; DistP a) -&gt; IRV a -&gt; DistP a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[IRV a]
</span><a href="#local-6989586621679059094"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span id="local-6989586621679059103"><span class="annot"><a href="PWPs.IRVs.html#allToFinish"><span class="hs-identifier hs-type">allToFinish</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059103"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-315"></span><span id="allToFinish"><span class="annot"><span class="annottext">allToFinish :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; IRV a -&gt; IRV a
</span><a href="PWPs.IRVs.html#allToFinish"><span class="hs-identifier hs-var hs-var">allToFinish</span></a></span></span><span> </span><span id="local-6989586621679059125"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059125"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679059126"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059126"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; IRV a
forall a. DistP a -&gt; IRV a
</span><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059125"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a -&gt; DistP a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059126"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><span class="hs-comment">-- | Compute the last-to-finsh of a list of IRVs: if we have nothing to wait for the result is top</span></span><span>
</span><span id="line-318"></span><span id="local-6989586621679059127"><span class="annot"><a href="PWPs.IRVs.html#multiAtF"><span class="hs-identifier hs-type">multiAtF</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679059127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679059127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679059127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679059127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679059127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059127"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679059127"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-322"></span><span id="multiAtF"><span class="annot"><span class="annottext">multiAtF :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
[IRV a] -&gt; IRV a
</span><a href="PWPs.IRVs.html#multiAtF"><span class="hs-identifier hs-var hs-var">multiAtF</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IRV a
forall a. (Ord a, Num a) =&gt; IRV a
</span><a href="PWPs.IRVs.html#top"><span class="hs-identifier hs-var">top</span></a></span><span>
</span><span id="line-323"></span><span class="annot"><a href="PWPs.IRVs.html#multiAtF"><span class="hs-identifier hs-var">multiAtF</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679059150"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059150"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059150"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-324"></span><span class="hs-comment">-- now know we have at least two, so head and tail are safe</span><span>
</span><span id="line-325"></span><span class="annot"><a href="PWPs.IRVs.html#multiAtF"><span class="hs-identifier hs-var">multiAtF</span></a></span><span> </span><span id="local-6989586621679059151"><span class="annot"><span class="annottext">[IRV a]
</span><a href="#local-6989586621679059151"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; IRV a
forall a. DistP a -&gt; IRV a
</span><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; IRV a) -&gt; DistP a -&gt; IRV a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; DistP a -&gt; DistP a) -&gt; DistP a -&gt; [DistP a] -&gt; DistP a
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a -&gt; DistP a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(*)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DistP a] -&gt; DistP a
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[DistP a]
</span><a href="#local-6989586621679059152"><span class="hs-identifier hs-var">cdfs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DistP a] -&gt; [DistP a]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[DistP a]
</span><a href="#local-6989586621679059152"><span class="hs-identifier hs-var">cdfs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679059152"><span class="annot"><span class="annottext">cdfs :: [DistP a]
</span><a href="#local-6989586621679059152"><span class="hs-identifier hs-var hs-var">cdfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IRV a -&gt; DistP a) -&gt; [IRV a] -&gt; [DistP a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">[IRV a]
</span><a href="#local-6989586621679059151"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="annot"><span class="hs-comment">{-|
    The probability is for choosing the left branch.
    We can do this on either PDFs or CDFs; if we have CDFs deliver a CDF,
    if we have both PDFs or one of each, deliver a PDF.
-}</span></span><span>
</span><span id="line-334"></span><span id="local-6989586621679058442"><span class="annot"><a href="PWPs.IRVs.html#probChoice"><span class="hs-identifier hs-type">probChoice</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-type">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058442"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-340"></span><span id="probChoice"><span class="annot"><span class="annottext">probChoice :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
a -&gt; IRV a -&gt; IRV a -&gt; IRV a
</span><a href="PWPs.IRVs.html#probChoice"><span class="hs-identifier hs-var hs-var">probChoice</span></a></span></span><span> </span><span id="local-6989586621679059202"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059202"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679059203"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059203"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679059204"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059204"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059202"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059202"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IRV a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid probability value&quot;</span></span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059203"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059204"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-344"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-type">CDF</span></a></span><span> </span><span id="local-6989586621679059206"><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059206"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-type">CDF</span></a></span><span> </span><span id="local-6989586621679059207"><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059207"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; IRV a
forall a. DistP a -&gt; IRV a
</span><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-var">CDF</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059202"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; DistP a -&gt; DistP a
forall a b.
(Eq a, Num a, Evaluable a b) =&gt;
a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-var">&gt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059206"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a -&gt; DistP a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059202"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; DistP a -&gt; DistP a
forall a b.
(Eq a, Num a, Evaluable a b) =&gt;
a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-var">&gt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059207"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>            </span><span class="annot"><span class="annottext">(IRV a, IRV a)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059202"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; DistD a -&gt; DistD a
forall a b.
(Eq a, Num a, Evaluable a b) =&gt;
a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-var">&gt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059203"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; DistD a -&gt; DistD a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059202"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; DistD a -&gt; DistD a
forall a b.
(Eq a, Num a, Evaluable a b) =&gt;
a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-var">&gt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059204"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span id="local-6989586621679058448"><span class="annot"><a href="PWPs.IRVs.html#multiWeightedChoice"><span class="hs-identifier hs-type">multiWeightedChoice</span></a></span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-type">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058448"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- If we have nothing to choose from we get nothing</span><span>
</span><span id="line-352"></span><span id="multiWeightedChoice"><span class="annot"><span class="annottext">multiWeightedChoice :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
[(a, IRV a)] -&gt; IRV a
</span><a href="PWPs.IRVs.html#multiWeightedChoice"><span class="hs-identifier hs-var hs-var">multiWeightedChoice</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IRV a
forall a. (Ord a, Num a) =&gt; IRV a
</span><a href="PWPs.IRVs.html#bottom"><span class="hs-identifier hs-var">bottom</span></a></span><span>
</span><span id="line-353"></span><span class="hs-comment">-- we'll force everything into PDFs and deliver a PDF</span><span>
</span><span id="line-354"></span><span class="annot"><a href="PWPs.IRVs.html#multiWeightedChoice"><span class="hs-identifier hs-var">multiWeightedChoice</span></a></span><span> </span><span id="local-6989586621679059234"><span class="annot"><span class="annottext">[(a, IRV a)]
</span><a href="#local-6989586621679059234"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DistD a] -&gt; DistD a
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; DistD a -&gt; DistD a) -&gt; [a] -&gt; [DistD a] -&gt; [DistD a]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; DistD a -&gt; DistD a
</span><a href="#local-6989586621679059236"><span class="hs-identifier hs-var">adjust</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059237"><span class="hs-identifier hs-var">weights</span></a></span><span> </span><span class="annot"><span class="annottext">[DistD a]
</span><a href="#local-6989586621679059238"><span class="hs-identifier hs-var">pdfs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621679059237"><span class="annot"><span class="annottext">weights :: [a]
</span><a href="#local-6989586621679059237"><span class="hs-identifier hs-var hs-var">weights</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, IRV a) -&gt; a) -&gt; [(a, IRV a)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, IRV a) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, IRV a)]
</span><a href="#local-6989586621679059234"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-comment">-- :: [a]</span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621679059238"><span class="annot"><span class="annottext">pdfs :: [DistD a]
</span><a href="#local-6989586621679059238"><span class="hs-identifier hs-var hs-var">pdfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, IRV a) -&gt; DistD a) -&gt; [(a, IRV a)] -&gt; [DistD a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">(IRV a -&gt; DistD a)
-&gt; ((a, IRV a) -&gt; IRV a) -&gt; (a, IRV a) -&gt; DistD a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, IRV a) -&gt; IRV a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, IRV a)]
</span><a href="#local-6989586621679059234"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-comment">-- :: [DistD a]</span><span>
</span><span id="line-358"></span><span>    </span><span id="local-6989586621679059236"><span class="annot"><span class="annottext">adjust :: a -&gt; DistD a -&gt; DistD a
</span><a href="#local-6989586621679059236"><span class="hs-identifier hs-var hs-var">adjust</span></a></span></span><span> </span><span id="local-6989586621679059239"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059239"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679059240"><span class="annot"><span class="annottext">DistD a
</span><a href="#local-6989586621679059240"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059239"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059237"><span class="hs-identifier hs-var">weights</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; DistD a -&gt; DistD a
forall a b.
(Eq a, Num a, Evaluable a b) =&gt;
a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-var">&gt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">DistD a
</span><a href="#local-6989586621679059240"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-keyword">infix</span><span> </span><span class="hs-number">7</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="hs-comment">-- same as *</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="annot"><span class="hs-comment">-- | To convolve, force into PDFs and then invoke piecewise convolution</span></span><span>
</span><span id="line-363"></span><span id="local-6989586621679058331"><span class="annot"><a href="PWPs.IRVs.html#%3C%2B%3E"><span class="hs-operator hs-type">(&lt;+&gt;)</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-type">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058331"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-368"></span><span id="local-6989586621679059269"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059269"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="%3C%2B%3E"><span class="annot"><span class="annottext">&lt;+&gt; :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; IRV a -&gt; IRV a
</span><a href="PWPs.IRVs.html#%3C%2B%3E"><span class="hs-operator hs-var hs-var">&lt;+&gt;</span></a></span></span><span> </span><span id="local-6989586621679059270"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059270"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059269"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; DistD a -&gt; DistD a
forall a b.
(Ord a, Num a, Enum a, Fractional a, Num b, Mergeable b,
 Evaluable a b, CompactConvolvable a b) =&gt;
Pieces a b -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3C%2B%3E"><span class="hs-operator hs-var">PWPs.Piecewise.&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059270"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="annot"><span class="hs-comment">-- | Just extract the final value of the CDF</span></span><span>
</span><span id="line-371"></span><span id="local-6989586621679058456"><span class="annot"><a href="PWPs.IRVs.html#probMass"><span class="hs-identifier hs-type">probMass</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058456"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058456"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058456"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-375"></span><span id="probMass"><span class="annot"><span class="annottext">probMass :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; a
</span><a href="PWPs.IRVs.html#probMass"><span class="hs-identifier hs-var hs-var">probMass</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; a
forall a b. (Num a, Evaluable a b) =&gt; Pieces a b -&gt; a
</span><a href="PWPs.Piecewise.html#piecesFinalValue"><span class="hs-identifier hs-var">piecesFinalValue</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; a) -&gt; (IRV a -&gt; DistP a) -&gt; IRV a -&gt; a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="annot"><span class="hs-comment">{-|
    If the two IRVs are partially ordered, return an ordering, otherwise return Nothing.
-}</span></span><span>
</span><span id="line-380"></span><span id="local-6989586621679058460"><span class="annot"><a href="PWPs.IRVs.html#compareIRVs"><span class="hs-identifier hs-type">compareIRVs</span></a></span><span>
</span><span id="line-381"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058460"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058460"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058460"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058460"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058460"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058460"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058460"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058460"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058460"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span></span><span>
</span><span id="line-385"></span><span id="compareIRVs"><span class="annot"><span class="annottext">compareIRVs :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; IRV a -&gt; Maybe Ordering
</span><a href="PWPs.IRVs.html#compareIRVs"><span class="hs-identifier hs-var hs-var">compareIRVs</span></a></span></span><span> </span><span id="local-6989586621679059313"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059313"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679059314"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059314"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; DistP a -&gt; Maybe Ordering
forall a b.
(Fractional a, Eq a, Ord a, Comparable a b, Num b, Mergeable b,
 Evaluable a b) =&gt;
Pieces a b -&gt; Pieces a b -&gt; Maybe Ordering
</span><a href="PWPs.Piecewise.html#comparePW"><span class="hs-identifier hs-var">comparePW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059313"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059314"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><span class="hs-comment">-- | return the first and last basepoints for which the value is significant</span></span><span>
</span><span id="line-388"></span><span id="local-6989586621679058419"><span class="annot"><a href="PWPs.IRVs.html#support"><span class="hs-identifier hs-type">support</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058419"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058419"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058419"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679058419"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679058419"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-389"></span><span id="support"><span class="annot"><span class="annottext">support :: forall a. (Eq a, Fractional a) =&gt; IRV a -&gt; (a, a)
</span><a href="PWPs.IRVs.html#support"><span class="hs-identifier hs-var hs-var">support</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-type">PDF</span></a></span><span> </span><span id="local-6989586621679059324"><span class="annot"><span class="annottext">DistD a
</span><a href="#local-6989586621679059324"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; (a, a)
forall b a. (Mergeable b, Eq b) =&gt; Pieces a b -&gt; (a, a)
</span><a href="PWPs.Piecewise.html#piecewiseSupport"><span class="hs-identifier hs-var">piecewiseSupport</span></a></span><span> </span><span class="annot"><span class="annottext">DistD a
</span><a href="#local-6989586621679059324"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-390"></span><span class="annot"><a href="PWPs.IRVs.html#support"><span class="hs-identifier hs-var">support</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#CDF"><span class="hs-identifier hs-type">CDF</span></a></span><span> </span><span id="local-6989586621679059326"><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059326"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; (a, a)
forall b a. (Mergeable b, Eq b) =&gt; Pieces a b -&gt; (a, a)
</span><a href="PWPs.Piecewise.html#piecewiseSupport"><span class="hs-identifier hs-var">piecewiseSupport</span></a></span><span> </span><span class="annot"><span class="annottext">DistP a
</span><a href="#local-6989586621679059326"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="annot"><span class="hs-comment">{-|
Given an ordered list of probabiity values, return the time at which each value is reached;
if it is never reached, return Nothing in that position.
Where there is a step up in the CDF that includes the centile probability, we report the time
for which the probability is exceeded.
Centiles are not computed exactly, but to a given precision, currently set to 1/1000th of the
support of the IRV.
-}</span></span><span>
</span><span id="line-400"></span><span id="local-6989586621679058469"><span class="annot"><a href="PWPs.IRVs.html#centiles"><span class="hs-identifier hs-type">centiles</span></a></span><span>
</span><span id="line-401"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-402"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-403"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-404"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-405"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-406"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Numeric.Polynomial.Simple.html#Poly"><span class="hs-identifier hs-type">Poly</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679058469"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-412"></span><span id="centiles"><span class="annot"><span class="annottext">centiles :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a, Evaluable a (Poly a),
 Integrable (DistD a) (DistP a)) =&gt;
[a] -&gt; IRV a -&gt; [Maybe a]
</span><a href="PWPs.IRVs.html#centiles"><span class="hs-identifier hs-var hs-var">centiles</span></a></span></span><span> </span><span id="local-6989586621679059376"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059376"><span class="hs-identifier hs-var">probabilities</span></a></span></span><span> </span><span id="local-6989586621679059377"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059377"><span class="hs-identifier hs-var">dQ</span></a></span></span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059376"><span class="hs-identifier hs-var">probabilities</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Maybe a]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty probability list&quot;</span></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; Bool
</span><a href="PWPs.Piecewise.html#monotonic"><span class="hs-identifier hs-var">monotonic</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059376"><span class="hs-identifier hs-var">probabilities</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Maybe a]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probabilities not monotonic&quot;</span></span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; a
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059376"><span class="hs-identifier hs-var">probabilities</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Maybe a]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probability exceeds one&quot;</span></span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [Piece a (Poly a)] -&gt; [Maybe a]
</span><a href="#local-6989586621679059378"><span class="hs-identifier hs-var">findCentiles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; a
</span><a href="PWPs.IRVs.html#probMass"><span class="hs-identifier hs-var">probMass</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059377"><span class="hs-identifier hs-var">dQ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059376"><span class="hs-identifier hs-var">probabilities</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DistP a -&gt; [Piece a (Poly a)]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">(DistP a -&gt; [Piece a (Poly a)]) -&gt; DistP a -&gt; [Piece a (Poly a)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistP a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a)) =&gt;
IRV a -&gt; DistP a
</span><a href="PWPs.IRVs.html#makeCDF"><span class="hs-identifier hs-var">makeCDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059377"><span class="hs-identifier hs-var">dQ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-comment">-- need to specify the precision with which we report centiles</span><span>
</span><span id="line-419"></span><span>    </span><span id="local-6989586621679059381"><span class="annot"><span class="annottext">precisionFraction :: a
</span><a href="#local-6989586621679059381"><span class="hs-identifier hs-var hs-var">precisionFraction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1000</span></span><span> </span><span class="hs-comment">-- arbitrary parameter!</span><span>
</span><span id="line-420"></span><span>    </span><span id="local-6989586621679059382"><span class="annot"><span class="annottext">eps :: a
</span><a href="#local-6989586621679059382"><span class="hs-identifier hs-var hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; (a, a)
forall a. (Eq a, Fractional a) =&gt; IRV a -&gt; (a, a)
</span><a href="PWPs.IRVs.html#support"><span class="hs-identifier hs-var">support</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059377"><span class="hs-identifier hs-var">dQ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">(a, a) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; (a, a)
forall a. (Eq a, Fractional a) =&gt; IRV a -&gt; (a, a)
</span><a href="PWPs.IRVs.html#support"><span class="hs-identifier hs-var">support</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059377"><span class="hs-identifier hs-var">dQ</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059381"><span class="hs-identifier hs-var">precisionFraction</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-comment">-- findCentiles :: a' -&gt; [a'] -&gt; [Piece a' (PolyHeaviside a')] -&gt; [Maybe a']</span><span>
</span><span id="line-422"></span><span>    </span><span class="hs-comment">-- consume the list of probabilities and build the list of centiles</span><span>
</span><span id="line-423"></span><span>    </span><span id="local-6989586621679059378"><span class="annot"><span class="annottext">findCentiles :: a -&gt; [a] -&gt; [Piece a (Poly a)] -&gt; [Maybe a]
</span><a href="#local-6989586621679059378"><span class="hs-identifier hs-var hs-var">findCentiles</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Piece a (Poly a)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- stop when we have run out of centiles to evaluate</span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><a href="#local-6989586621679059378"><span class="hs-identifier hs-var">findCentiles</span></a></span><span> </span><span id="local-6989586621679059383"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059383"><span class="hs-identifier hs-var">maxProb</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679059384"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059384"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679059385"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059385"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059386"><span class="annot"><span class="annottext">y :: [Piece a (Poly a)]
</span><a href="#local-6989586621679059386"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">[</span><span id="local-6989586621679059387"><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059387"><span class="hs-identifier hs-var">final</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-425"></span><span>        </span><span class="hs-comment">-- if we have only one piece its object must be constant, so report its basepoint as the root,</span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-comment">-- unless we are beyond the tangible mass, in whioch case report Nothing</span><span>
</span><span id="line-427"></span><span>        </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059384"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059383"><span class="hs-identifier hs-var">maxProb</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a (Poly a) -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059387"><span class="hs-identifier hs-var">final</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>            </span><span class="annot"><span class="annottext">Maybe a -&gt; [Maybe a] -&gt; [Maybe a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [Piece a (Poly a)] -&gt; [Maybe a]
</span><a href="#local-6989586621679059378"><span class="hs-identifier hs-var">findCentiles</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059383"><span class="hs-identifier hs-var">maxProb</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059385"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a (Poly a)]
</span><a href="#local-6989586621679059386"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-comment">-- hereon we must have at least two pieces, so we can ask whether the value is in the range of the current interval,</span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><a href="#local-6989586621679059378"><span class="hs-identifier hs-var">findCentiles</span></a></span><span> </span><span id="local-6989586621679059389"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059389"><span class="hs-identifier hs-var">maxProb</span></a></span></span><span> </span><span id="local-6989586621679059390"><span class="annot"><span class="annottext">cs :: [a]
</span><a href="#local-6989586621679059390"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679059391"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059391"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679059392"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059392"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679059393"><span class="annot"><span class="annottext">remaining :: [Piece a (Poly a)]
</span><a href="#local-6989586621679059393"><span class="hs-identifier hs-var">remaining</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679059394"><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059394"><span class="hs-identifier hs-var">first</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679059395"><span class="annot"><span class="annottext">rest :: [Piece a (Poly a)]
</span><a href="#local-6989586621679059395"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679059396"><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059396"><span class="hs-identifier hs-var">second</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a (Poly a)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059391"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059389"><span class="hs-identifier hs-var">maxProb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; [Maybe a] -&gt; [Maybe a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [Piece a (Poly a)] -&gt; [Maybe a]
</span><a href="#local-6989586621679059378"><span class="hs-identifier hs-var">findCentiles</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059389"><span class="hs-identifier hs-var">maxProb</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059392"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a (Poly a)]
</span><a href="#local-6989586621679059393"><span class="hs-identifier hs-var">remaining</span></a></span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-comment">-- if the value is in the range of the current interval,</span><span>
</span><span id="line-433"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059397"><span class="hs-identifier hs-var">firstValue</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059391"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059391"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059398"><span class="hs-identifier hs-var">secondValue</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-434"></span><span>            </span><span class="hs-comment">-- find the precise root, and carry on to the next centile</span><span>
</span><span id="line-435"></span><span>            </span><span class="annot"><span class="annottext">a -&gt; a -&gt; (a, a) -&gt; Poly a -&gt; Maybe a
forall a.
(Ord a, Num a, Eq a, Fractional a) =&gt;
a -&gt; a -&gt; (a, a) -&gt; Poly a -&gt; Maybe a
</span><a href="Numeric.Polynomial.Simple.html#root"><span class="hs-identifier hs-var">Poly.root</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059382"><span class="hs-identifier hs-var">eps</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059391"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a (Poly a) -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059394"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Piece a (Poly a) -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059396"><span class="hs-identifier hs-var">second</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a (Poly a) -&gt; Poly a
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059394"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>                </span><span class="annot"><span class="annottext">Maybe a -&gt; [Maybe a] -&gt; [Maybe a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [Piece a (Poly a)] -&gt; [Maybe a]
</span><a href="#local-6989586621679059378"><span class="hs-identifier hs-var">findCentiles</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059389"><span class="hs-identifier hs-var">maxProb</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059392"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a (Poly a)]
</span><a href="#local-6989586621679059393"><span class="hs-identifier hs-var">remaining</span></a></span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-comment">-- otherwise no further centiles can be in this piece, so move on to the next piece</span><span>
</span><span id="line-438"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [Piece a (Poly a)] -&gt; [Maybe a]
</span><a href="#local-6989586621679059378"><span class="hs-identifier hs-var">findCentiles</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059389"><span class="hs-identifier hs-var">maxProb</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679059390"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a (Poly a)]
</span><a href="#local-6989586621679059395"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-439"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-440"></span><span>        </span><span id="local-6989586621679059397"><span class="annot"><span class="annottext">firstValue :: a
</span><a href="#local-6989586621679059397"><span class="hs-identifier hs-var hs-var">firstValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Poly a -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a (Poly a) -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059394"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a (Poly a) -&gt; Poly a
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059394"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>        </span><span id="local-6989586621679059398"><span class="annot"><span class="annottext">secondValue :: a
</span><a href="#local-6989586621679059398"><span class="hs-identifier hs-var hs-var">secondValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Poly a -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a (Poly a) -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059396"><span class="hs-identifier hs-var">second</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a (Poly a) -&gt; Poly a
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a (Poly a)
</span><a href="#local-6989586621679059394"><span class="hs-identifier hs-var">first</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>    </span><span class="annot"><a href="#local-6989586621679059378"><span class="hs-identifier hs-var">findCentiles</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Piece a (Poly a)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Maybe a]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected centile case&quot;</span></span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span class="hs-keyword">data</span><span> </span><span id="Moments"><span class="annot"><a href="PWPs.IRVs.html#Moments"><span class="hs-identifier hs-var">Moments</span></a></span></span><span> </span><span id="local-6989586621679058479"><span class="annot"><a href="#local-6989586621679058479"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Moments"><span class="annot"><a href="PWPs.IRVs.html#Moments"><span class="hs-identifier hs-var">Moments</span></a></span></span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="tangibleMass"><span class="annot"><span class="annottext">forall a. Moments a -&gt; a
</span><a href="PWPs.IRVs.html#tangibleMass"><span class="hs-identifier hs-var hs-var">tangibleMass</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679058479"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="mean"><span class="annot"><span class="annottext">forall a. Moments a -&gt; a
</span><a href="PWPs.IRVs.html#mean"><span class="hs-identifier hs-var hs-var">mean</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679058479"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="variance"><span class="annot"><span class="annottext">forall a. Moments a -&gt; a
</span><a href="PWPs.IRVs.html#variance"><span class="hs-identifier hs-var hs-var">variance</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679058479"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="skew"><span class="annot"><span class="annottext">forall a. Moments a -&gt; a
</span><a href="PWPs.IRVs.html#skew"><span class="hs-identifier hs-var hs-var">skew</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679058479"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="kurtosis"><span class="annot"><span class="annottext">forall a. Moments a -&gt; a
</span><a href="PWPs.IRVs.html#kurtosis"><span class="hs-identifier hs-var hs-var">kurtosis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679058479"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679059409"><span id="local-6989586621679059416"><span class="annot"><span class="annottext">Moments a -&gt; Moments a -&gt; Bool
(Moments a -&gt; Moments a -&gt; Bool)
-&gt; (Moments a -&gt; Moments a -&gt; Bool) -&gt; Eq (Moments a)
forall a. Eq a =&gt; Moments a -&gt; Moments a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; Moments a -&gt; Moments a -&gt; Bool
== :: Moments a -&gt; Moments a -&gt; Bool
$c/= :: forall a. Eq a =&gt; Moments a -&gt; Moments a -&gt; Bool
/= :: Moments a -&gt; Moments a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679059421"><span id="local-6989586621679059429"><span id="local-6989586621679059433"><span class="annot"><span class="annottext">Int -&gt; Moments a -&gt; ShowS
[Moments a] -&gt; ShowS
Moments a -&gt; String
(Int -&gt; Moments a -&gt; ShowS)
-&gt; (Moments a -&gt; String)
-&gt; ([Moments a] -&gt; ShowS)
-&gt; Show (Moments a)
forall a. Show a =&gt; Int -&gt; Moments a -&gt; ShowS
forall a. Show a =&gt; [Moments a] -&gt; ShowS
forall a. Show a =&gt; Moments a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; Moments a -&gt; ShowS
showsPrec :: Int -&gt; Moments a -&gt; ShowS
$cshow :: forall a. Show a =&gt; Moments a -&gt; String
show :: Moments a -&gt; String
$cshowList :: forall a. Show a =&gt; [Moments a] -&gt; ShowS
showList :: [Moments a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>
</span><span id="line-453"></span><span class="annot"><span class="hs-comment">-- | Compute the first five moments of a given distribution</span></span><span>
</span><span id="line-454"></span><span class="annot"><a href="PWPs.IRVs.html#moments"><span class="hs-identifier hs-type">moments</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679058490"><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-456"></span><span>     </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-457"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-458"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-459"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-460"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-461"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-type">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-467"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#Moments"><span class="hs-identifier hs-type">Moments</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-468"></span><span id="moments"><span class="annot"><span class="annottext">moments :: forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Integrable (DistD a) (DistP a), Differentiable (DistP a) (DistD a),
 Evaluable a (DistD a), Evaluable a (DistP a)) =&gt;
IRV a -&gt; Moments a
</span><a href="PWPs.IRVs.html#moments"><span class="hs-identifier hs-var hs-var">moments</span></a></span></span><span> </span><span id="local-6989586621679059513"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059513"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-469"></span><span>    </span><span class="annot"><a href="PWPs.IRVs.html#Moments"><span class="hs-identifier hs-type">Moments</span></a></span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tangibleMass :: a
</span><a href="PWPs.IRVs.html#tangibleMass"><span class="hs-identifier hs-var">tangibleMass</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059514"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-471"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mean :: a
</span><a href="PWPs.IRVs.html#mean"><span class="hs-identifier hs-var">mean</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059515"><span class="hs-identifier hs-var">mu</span></a></span><span>
</span><span id="line-472"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">variance :: a
</span><a href="PWPs.IRVs.html#variance"><span class="hs-identifier hs-var">variance</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">skew :: a
</span><a href="PWPs.IRVs.html#skew"><span class="hs-identifier hs-var">skew</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059517"><span class="hs-identifier hs-var">gamma</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">kurtosis :: a
</span><a href="PWPs.IRVs.html#kurtosis"><span class="hs-identifier hs-var">kurtosis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059518"><span class="hs-identifier hs-var">kappa</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-comment">-- Compute the definite integral of x^nf(x)dx</span><span>
</span><span id="line-478"></span><span>    </span><span id="local-6989586621679059519"><span class="annot"><span class="annottext">xNIntegral :: Int -&gt; IRV a -&gt; a
</span><a href="#local-6989586621679059519"><span class="hs-identifier hs-var hs-var">xNIntegral</span></a></span></span><span> </span><span id="local-6989586621679059520"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679059520"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679059521"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059521"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistP a -&gt; a
forall a b. (Num a, Evaluable a b) =&gt; Pieces a b -&gt; a
</span><a href="PWPs.Piecewise.html#piecesFinalValue"><span class="hs-identifier hs-var">piecesFinalValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IRV a -&gt; DistP a
</span><a href="#local-6989586621679059522"><span class="hs-identifier hs-var">integralOfxToTheNtimesFx</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679059520"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059521"><span class="hs-identifier hs-var">g</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-480"></span><span>        </span><span class="annot"><a href="#local-6989586621679059522"><span class="hs-identifier hs-type">integralOfxToTheNtimesFx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-481"></span><span>        </span><span id="local-6989586621679059522"><span class="annot"><span class="annottext">integralOfxToTheNtimesFx :: Int -&gt; IRV a -&gt; DistP a
</span><a href="#local-6989586621679059522"><span class="hs-identifier hs-var hs-var">integralOfxToTheNtimesFx</span></a></span></span><span> </span><span id="local-6989586621679059523"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679059523"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span id="local-6989586621679059524"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059524"><span class="hs-identifier hs-var">f'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; DistP a
forall a b c.
(Num a, Eq a, Ord a, StepIntegrable a b c, Evaluable a c) =&gt;
Pieces a b -&gt; Pieces a c
</span><a href="PWPs.Piecewise.html#integratePieces"><span class="hs-identifier hs-var">integratePieces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PolyDelta a -&gt; PolyDelta a -&gt; PolyDelta a)
-&gt; PolyDelta a -&gt; DistD a -&gt; DistD a
forall b a. (b -&gt; b -&gt; b) -&gt; b -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#applyObject"><span class="hs-identifier hs-var">applyObject</span></a></span><span> </span><span class="annot"><span class="annottext">PolyDelta a -&gt; PolyDelta a -&gt; PolyDelta a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(*)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Poly a -&gt; PolyDelta a
forall a. Poly a -&gt; PolyDelta a
</span><a href="PWPs.PolyDeltas.html#Pd"><span class="hs-identifier hs-var">Pd</span></a></span><span> </span><span class="annot"><span class="annottext">(Poly a -&gt; PolyDelta a) -&gt; Poly a -&gt; PolyDelta a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; a -&gt; Poly a
forall a. (Eq a, Num a) =&gt; Int -&gt; a -&gt; Poly a
</span><a href="Numeric.Polynomial.Simple.html#monomial"><span class="hs-identifier hs-var">Poly.monomial</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679059523"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DistD a -&gt; DistD a) -&gt; DistD a -&gt; DistD a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059524"><span class="hs-identifier hs-var">f'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>    </span><span id="local-6989586621679059514"><span class="annot"><span class="annottext">tau :: a
</span><a href="#local-6989586621679059514"><span class="hs-identifier hs-var hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IRV a -&gt; a
</span><a href="#local-6989586621679059519"><span class="hs-identifier hs-var">xNIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059513"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-comment">-- catch case of bottom, otherwise scale back up to a proper distribution</span><span>
</span><span id="line-484"></span><span>    </span><span id="local-6989586621679059526"><span class="annot"><span class="annottext">fHat :: IRV a
</span><a href="#local-6989586621679059526"><span class="hs-identifier hs-var hs-var">fHat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059514"><span class="hs-identifier hs-var">tau</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059513"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; IRV a
forall a. DistD a -&gt; IRV a
</span><a href="PWPs.IRVs.html#PDF"><span class="hs-identifier hs-var">PDF</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059514"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; DistD a -&gt; DistD a
forall a b.
(Eq a, Num a, Evaluable a b) =&gt;
a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-var">&gt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059513"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>    </span><span id="local-6989586621679059515"><span class="annot"><span class="annottext">mu :: a
</span><a href="#local-6989586621679059515"><span class="hs-identifier hs-var hs-var">mu</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IRV a -&gt; a
</span><a href="#local-6989586621679059519"><span class="hs-identifier hs-var">xNIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059526"><span class="hs-identifier hs-var">fHat</span></a></span><span>
</span><span id="line-486"></span><span>    </span><span id="local-6989586621679059527"><span class="annot"><span class="annottext">muSq :: a
</span><a href="#local-6989586621679059527"><span class="hs-identifier hs-var hs-var">muSq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059515"><span class="hs-identifier hs-var">mu</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059515"><span class="hs-identifier hs-var">mu</span></a></span><span>
</span><span id="line-487"></span><span>    </span><span id="local-6989586621679059516"><span class="annot"><span class="annottext">sigsq :: a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var hs-var">sigsq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IRV a -&gt; a
</span><a href="#local-6989586621679059519"><span class="hs-identifier hs-var">xNIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059526"><span class="hs-identifier hs-var">fHat</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059527"><span class="hs-identifier hs-var">muSq</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-comment">{-sqRoot :: a -&gt; a
    sqRoot x =
        let
            y :: Double
            y = toRational x
        in fromRational . toRational . sqrt y -}</span><span>
</span><span id="line-494"></span><span>    </span><span id="local-6989586621679059528"><span class="annot"><span class="annottext">sigma :: a
</span><a href="#local-6989586621679059528"><span class="hs-identifier hs-var hs-var">sigma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
(Fractional a, Num a, Ord a) =&gt; a -&gt; a
</span><a href="#local-6989586621679059529"><span class="hs-identifier hs-var">squareRoot</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-comment">-- if the variance is zero there can be no skewness</span><span>
</span><span id="line-496"></span><span>    </span><span id="local-6989586621679059517"><span class="annot"><span class="annottext">gamma :: a
</span><a href="#local-6989586621679059517"><span class="hs-identifier hs-var hs-var">gamma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-498"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-499"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; IRV a -&gt; a
</span><a href="#local-6989586621679059519"><span class="hs-identifier hs-var">xNIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059526"><span class="hs-identifier hs-var">fHat</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059515"><span class="hs-identifier hs-var">mu</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059515"><span class="hs-identifier hs-var">mu</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059527"><span class="hs-identifier hs-var">muSq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059528"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-comment">-- The kurtosis is bounded below by the squared skewness plus 1</span><span>
</span><span id="line-501"></span><span>    </span><span id="local-6989586621679059518"><span class="annot"><span class="annottext">kappa :: a
</span><a href="#local-6989586621679059518"><span class="hs-identifier hs-var hs-var">kappa</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-503"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span>
</span><span id="line-504"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-505"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IRV a -&gt; a
</span><a href="#local-6989586621679059519"><span class="hs-identifier hs-var">xNIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059526"><span class="hs-identifier hs-var">fHat</span></a></span><span>
</span><span id="line-506"></span><span>                    </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059515"><span class="hs-identifier hs-var">mu</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059517"><span class="hs-identifier hs-var">gamma</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059528"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span>
</span><span id="line-507"></span><span>                    </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">6</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059527"><span class="hs-identifier hs-var">muSq</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span>
</span><span id="line-508"></span><span>                    </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059527"><span class="hs-identifier hs-var">muSq</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059527"><span class="hs-identifier hs-var">muSq</span></a></span><span>
</span><span id="line-509"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>                    </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059516"><span class="hs-identifier hs-var">sigsq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>    </span><span class="hs-comment">-- use Heron's method to compute the square root</span><span>
</span><span id="line-512"></span><span>    </span><span class="annot"><a href="#local-6989586621679059529"><span class="hs-identifier hs-type">squareRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679058490"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-513"></span><span>    </span><span id="local-6989586621679059529"><span class="annot"><span class="annottext">squareRoot :: (Fractional a, Num a, Ord a) =&gt; a -&gt; a
</span><a href="#local-6989586621679059529"><span class="hs-identifier hs-var hs-var">squareRoot</span></a></span></span><span> </span><span id="local-6989586621679059552"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059552"><span class="hs-identifier hs-var">x</span></a></span></span><span>
</span><span id="line-514"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059552"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Negative square root input&quot;</span></span><span>
</span><span id="line-515"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059552"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-516"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679059553"><span class="hs-identifier hs-var">goRoot</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059554"><span class="hs-identifier hs-var">x0</span></a></span><span>
</span><span id="line-517"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-518"></span><span>        </span><span id="local-6989586621679059555"><span class="annot"><span class="annottext">precision :: a
</span><a href="#local-6989586621679059555"><span class="hs-identifier hs-var hs-var">precision</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059552"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">10000</span></span><span>
</span><span id="line-519"></span><span>        </span><span id="local-6989586621679059554"><span class="annot"><span class="annottext">x0 :: a
</span><a href="#local-6989586621679059554"><span class="hs-identifier hs-var hs-var">x0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059552"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span> </span><span class="hs-comment">-- initial guess</span><span>
</span><span id="line-520"></span><span>        </span><span id="local-6989586621679059553"><span class="annot"><span class="annottext">goRoot :: a -&gt; a
</span><a href="#local-6989586621679059553"><span class="hs-identifier hs-var hs-var">goRoot</span></a></span></span><span> </span><span id="local-6989586621679059556"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059556"><span class="hs-identifier hs-var">xi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059552"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059556"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059556"><span class="hs-identifier hs-var">xi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059555"><span class="hs-identifier hs-var">precision</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059556"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621679059553"><span class="hs-identifier hs-var">goRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059556"><span class="hs-identifier hs-var">xi</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059552"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679059556"><span class="hs-identifier hs-var">xi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span id="local-6989586621679058493"><span class="annot"><a href="PWPs.IRVs.html#complexityOfIRV"><span class="hs-identifier hs-type">complexityOfIRV</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679058493"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-524"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679058493"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-525"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679058493"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-526"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679058493"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-527"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-type">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistP"><span class="hs-identifier hs-type">DistP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058493"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.IRVs.html#DistD"><span class="hs-identifier hs-type">DistD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058493"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#ComplexityMeasureable"><span class="hs-identifier hs-type">ComplexityMeasureable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.PolyDeltas.html#PolyDelta"><span class="hs-identifier hs-type">PolyDelta</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058493"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.IRVs.html#IRV"><span class="hs-identifier hs-type">IRV</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679058493"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-531"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-532"></span><span id="complexityOfIRV"><span class="annot"><span class="annottext">complexityOfIRV :: forall a.
(Fractional a, Ord a, Num a, Enum a,
 Differentiable (DistP a) (DistD a),
 ComplexityMeasureable (PolyDelta a)) =&gt;
IRV a -&gt; Int
</span><a href="PWPs.IRVs.html#complexityOfIRV"><span class="hs-identifier hs-var hs-var">complexityOfIRV</span></a></span></span><span> </span><span id="local-6989586621679059572"><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059572"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DistD a -&gt; Int
forall b a. ComplexityMeasureable b =&gt; Pieces a b -&gt; Int
</span><a href="PWPs.Piecewise.html#piecewiseComplexity"><span class="hs-identifier hs-var">piecewiseComplexity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IRV a -&gt; DistD a
forall a.
(Fractional a, Ord a, Num a, Enum a, Eq a,
 Differentiable (DistP a) (DistD a)) =&gt;
IRV a -&gt; DistD a
</span><a href="PWPs.IRVs.html#makePDF"><span class="hs-identifier hs-var">makePDF</span></a></span><span> </span><span class="annot"><span class="annottext">IRV a
</span><a href="#local-6989586621679059572"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span></pre></body></html>