<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="annot"><span class="hs-comment">{-|
Module      : Piecewise
Description : Sequences of objects defined over contiguous intervals
Copyright   : (c) Peter Thompson, 2024
License     : BSD-2-Clause
Maintainer  : peter.thompson@pnsol.com
Stability   : experimental

We consider 'objects' (which may be polynomials or deltas) defined over numerical intervals,
assumed to be in increasing order, where we know how to combine objects
when the intervals are identical. When the intervals are not identical we construct the
overlaps so as to produce a combined object over a more complex shared set of intervals.

We assume a piecewise list is never empty.

We allow for zero-width intervals in order to accomodate delta functions. A zero-width
interval should *only* contain a delta, and *must* be followed by a non-zero interval.
A non-zero-width interval should *not* contain a delta.

When combining piecewise objects we allow that one set of intervals may finish before the other,
and assume that whatever the operation is will simply reproduce the tail of the longer sequence.
-}</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html"><span class="hs-identifier">PWPs.Piecewise</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier">Pieces</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier">Piece</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier">makePieces</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#mergePieces"><span class="hs-identifier">mergePieces</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#zero"><span class="hs-identifier">zero</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator">(&gt;&lt;)</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#%3C%2B%3E"><span class="hs-operator">(&lt;+&gt;)</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#integratePieces"><span class="hs-identifier">integratePieces</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#differentiatePieces"><span class="hs-identifier">differentiatePieces</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#piecesFinalValue"><span class="hs-identifier">piecesFinalValue</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#monotonic"><span class="hs-identifier">monotonic</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#comparePW"><span class="hs-identifier">comparePW</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#piecewiseSupport"><span class="hs-identifier">piecewiseSupport</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#applyObject"><span class="hs-identifier">applyObject</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#displayPolyDeltaIntervals"><span class="hs-identifier">displayPolyDeltaIntervals</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#piecewiseComplexity"><span class="hs-identifier">piecewiseComplexity</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html"><span class="hs-identifier">PWPs.PiecewiseClasses</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">data</span><span> </span><span id="Piece"><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-var">Piece</span></a></span></span><span> </span><span id="local-6989586621679055730"><span class="annot"><a href="#local-6989586621679055730"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679055731"><span class="annot"><a href="#local-6989586621679055731"><span class="hs-identifier hs-type">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Piece"><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-var">Piece</span></a></span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="basepoint"><span class="annot"><span class="annottext">forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var hs-var">basepoint</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679055730"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="object"><span class="annot"><span class="annottext">forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var hs-var">object</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679055731"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679055978"><span id="local-6989586621679055982"><span class="annot"><span class="annottext">Piece a o -&gt; Piece a o -&gt; Bool
(Piece a o -&gt; Piece a o -&gt; Bool)
-&gt; (Piece a o -&gt; Piece a o -&gt; Bool) -&gt; Eq (Piece a o)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall a o. (Eq a, Eq o) =&gt; Piece a o -&gt; Piece a o -&gt; Bool
$c== :: forall a o. (Eq a, Eq o) =&gt; Piece a o -&gt; Piece a o -&gt; Bool
== :: Piece a o -&gt; Piece a o -&gt; Bool
$c/= :: forall a o. (Eq a, Eq o) =&gt; Piece a o -&gt; Piece a o -&gt; Bool
/= :: Piece a o -&gt; Piece a o -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679055989"><span id="local-6989586621679055995"><span id="local-6989586621679055999"><span class="annot"><span class="annottext">Int -&gt; Piece a o -&gt; ShowS
[Piece a o] -&gt; ShowS
Piece a o -&gt; String
(Int -&gt; Piece a o -&gt; ShowS)
-&gt; (Piece a o -&gt; String)
-&gt; ([Piece a o] -&gt; ShowS)
-&gt; Show (Piece a o)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall a o. (Show a, Show o) =&gt; Int -&gt; Piece a o -&gt; ShowS
forall a o. (Show a, Show o) =&gt; [Piece a o] -&gt; ShowS
forall a o. (Show a, Show o) =&gt; Piece a o -&gt; String
$cshowsPrec :: forall a o. (Show a, Show o) =&gt; Int -&gt; Piece a o -&gt; ShowS
showsPrec :: Int -&gt; Piece a o -&gt; ShowS
$cshow :: forall a o. (Show a, Show o) =&gt; Piece a o -&gt; String
show :: Piece a o -&gt; String
$cshowList :: forall a o. (Show a, Show o) =&gt; [Piece a o] -&gt; ShowS
showList :: [Piece a o] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679055754"><span id="local-6989586621679056005"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055754"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-comment">-- fmap :: (o -&gt; b) -&gt; Piece a o -&gt; Piece a b</span><span>
</span><span id="line-57"></span><span>    </span><span id="local-6989586621679056009"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; Piece a a -&gt; Piece a b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679056010"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679056010"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679056011"><span class="annot"><span class="annottext">Piece a a
</span><a href="#local-6989586621679056011"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Piece a a
</span><a href="#local-6989586621679056011"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">{</span><span class="annot"><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679056010"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679056011"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span id="local-6989586621679055757"><span id="local-6989586621679055758"><span class="annot"><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-type">makePiece</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055757"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055758"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055757"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055758"><span class="hs-identifier hs-type">o</span></a></span></span></span><span> </span><span class="hs-comment">-- useful to have a tuple that we can have a list of to map over</span><span>
</span><span id="line-60"></span><span id="makePiece"><span class="annot"><span class="annottext">makePiece :: forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var hs-var">makePiece</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679056013"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056013"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056014"><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679056014"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">basepoint :: a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056013"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">object :: o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679056014"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-keyword">newtype</span><span> </span><span id="Pieces"><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span></span><span> </span><span id="local-6989586621679055761"><span class="annot"><a href="#local-6989586621679055761"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679055762"><span class="annot"><a href="#local-6989586621679055762"><span class="hs-identifier hs-type">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Pieces"><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span></span><span> </span><span class="hs-special">{</span><span id="getPieces"><span class="annot"><span class="annottext">forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var hs-var">getPieces</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055761"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055762"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">]</span><span class="hs-special">}</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679056020"><span id="local-6989586621679056026"><span class="annot"><span class="annottext">Pieces a o -&gt; Pieces a o -&gt; Bool
(Pieces a o -&gt; Pieces a o -&gt; Bool)
-&gt; (Pieces a o -&gt; Pieces a o -&gt; Bool) -&gt; Eq (Pieces a o)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall a o. (Eq a, Eq o) =&gt; Pieces a o -&gt; Pieces a o -&gt; Bool
$c== :: forall a o. (Eq a, Eq o) =&gt; Pieces a o -&gt; Pieces a o -&gt; Bool
== :: Pieces a o -&gt; Pieces a o -&gt; Bool
$c/= :: forall a o. (Eq a, Eq o) =&gt; Pieces a o -&gt; Pieces a o -&gt; Bool
/= :: Pieces a o -&gt; Pieces a o -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056035"><span id="local-6989586621679056041"><span id="local-6989586621679056045"><span class="annot"><span class="annottext">Int -&gt; Pieces a o -&gt; ShowS
[Pieces a o] -&gt; ShowS
Pieces a o -&gt; String
(Int -&gt; Pieces a o -&gt; ShowS)
-&gt; (Pieces a o -&gt; String)
-&gt; ([Pieces a o] -&gt; ShowS)
-&gt; Show (Pieces a o)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall a o. (Show a, Show o) =&gt; Int -&gt; Pieces a o -&gt; ShowS
forall a o. (Show a, Show o) =&gt; [Pieces a o] -&gt; ShowS
forall a o. (Show a, Show o) =&gt; Pieces a o -&gt; String
$cshowsPrec :: forall a o. (Show a, Show o) =&gt; Int -&gt; Pieces a o -&gt; ShowS
showsPrec :: Int -&gt; Pieces a o -&gt; ShowS
$cshow :: forall a o. (Show a, Show o) =&gt; Pieces a o -&gt; String
show :: Pieces a o -&gt; String
$cshowList :: forall a o. (Show a, Show o) =&gt; [Pieces a o] -&gt; ShowS
showList :: [Pieces a o] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679055780"><span id="local-6989586621679056049"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055780"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-65"></span><span>    </span><span id="local-6989586621679056053"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; Pieces a a -&gt; Pieces a b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679056054"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679056054"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; Pieces a b
forall a o. [Piece a o] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span><span> </span><span class="annot"><span class="annottext">([Piece a b] -&gt; Pieces a b)
-&gt; (Pieces a a -&gt; [Piece a b]) -&gt; Pieces a a -&gt; Pieces a b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Piece a a -&gt; Piece a b) -&gt; [Piece a a] -&gt; [Piece a b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Piece a a -&gt; Piece a b
forall a b. (a -&gt; b) -&gt; Piece a a -&gt; Piece a b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679056054"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Piece a a] -&gt; [Piece a b])
-&gt; (Pieces a a -&gt; [Piece a a]) -&gt; Pieces a a -&gt; [Piece a b]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Pieces a a -&gt; [Piece a a]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="annot"><span class="hs-comment">{-|
    We run through a set of pieces, merging intervals whose objects are declared mergeable
-}</span></span><span>
</span><span id="line-70"></span><span id="local-6989586621679055788"><span id="local-6989586621679055790"><span class="annot"><a href="PWPs.Piecewise.html#mergePieces"><span class="hs-identifier hs-type">mergePieces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055788"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055790"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055788"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055790"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055788"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-71"></span><span id="mergePieces"><span class="annot"><span class="annottext">mergePieces :: forall b a. Mergeable b =&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#mergePieces"><span class="hs-identifier hs-var hs-var">mergePieces</span></a></span></span><span> </span><span id="local-6989586621679056058"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056058"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; Pieces a b
forall a o. [Piece a o] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; [Piece a b]
forall b a. Mergeable b =&gt; [Piece a b] -&gt; [Piece a b]
</span><a href="#local-6989586621679056059"><span class="hs-identifier hs-var">doMerge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056058"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621679055793"><span id="local-6989586621679055794"><span class="annot"><a href="#local-6989586621679056059"><span class="hs-identifier hs-type">doMerge</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055793"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055794"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055793"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055794"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055793"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-74"></span><span>    </span><span id="local-6989586621679056059"><span class="annot"><span class="annottext">doMerge :: forall b a. Mergeable b =&gt; [Piece a b] -&gt; [Piece a b]
</span><a href="#local-6989586621679056059"><span class="hs-identifier hs-var hs-var">doMerge</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- can occur when we have merged the last two pieces</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="#local-6989586621679056059"><span class="hs-identifier hs-var">doMerge</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679056064"><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056064"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056064"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- stop when there's nothing left to merge</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="#local-6989586621679056059"><span class="hs-identifier hs-var">doMerge</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679056065"><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056065"><span class="hs-identifier hs-var">x0</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056066"><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056066"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056067"><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056067"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; Maybe b
forall a. Mergeable a =&gt; a -&gt; a -&gt; Maybe a
</span><a href="PWPs.PiecewiseClasses.html#mergeObject"><span class="hs-identifier hs-var">mergeObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b -&gt; b
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056065"><span class="hs-identifier hs-var">x0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b -&gt; b
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056066"><span class="hs-identifier hs-var">x1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-77"></span><span>        </span><span class="annot"><span class="annottext">Maybe b
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056065"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; [Piece a b] -&gt; [Piece a b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; [Piece a b]
forall b a. Mergeable b =&gt; [Piece a b] -&gt; [Piece a b]
</span><a href="#local-6989586621679056059"><span class="hs-identifier hs-var">doMerge</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056066"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; [Piece a b] -&gt; [Piece a b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056067"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- can't merge so just move on</span><span>
</span><span id="line-78"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679056069"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056069"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; [Piece a b]
forall b a. Mergeable b =&gt; [Piece a b] -&gt; [Piece a b]
</span><a href="#local-6989586621679056059"><span class="hs-identifier hs-var">doMerge</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">basepoint :: a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056065"><span class="hs-identifier hs-var">x0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">object :: b
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056069"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; [Piece a b] -&gt; [Piece a b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056067"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- extend interval through second basepoint</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span class="annot"><span class="hs-comment">{-|
    We apply a binary operation on primitive objects to a pair of piecewise objects by first:
    aligning the pieces and pairing their respective objects, then;
    applying the binary operation to the contained object pairs.
    Finally we check whether any successive objects are identical and, if so, merge their respective intervals.
-}</span></span><span>
</span><span id="line-86"></span><span id="local-6989586621679055798"><span id="local-6989586621679055799"><span id="local-6989586621679055800"><span id="local-6989586621679055801"><span class="annot"><a href="PWPs.Piecewise.html#combinePieces"><span class="hs-identifier hs-type">combinePieces</span></a></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055798"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055798"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055798"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055799"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055800"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055801"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055799"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055800"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055801"><span class="hs-identifier hs-type">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055798"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055799"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055798"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055800"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055798"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055801"><span class="hs-identifier hs-type">d</span></a></span></span></span></span></span><span>
</span><span id="line-92"></span><span id="combinePieces"><span class="annot"><span class="annottext">combinePieces :: forall a b c d.
(Num a, Eq a, Ord a, Mergeable b, Mergeable c, Mergeable d) =&gt;
(b -&gt; c -&gt; d) -&gt; Pieces a b -&gt; Pieces a c -&gt; Pieces a d
</span><a href="PWPs.Piecewise.html#combinePieces"><span class="hs-identifier hs-var hs-var">combinePieces</span></a></span></span><span> </span><span id="local-6989586621679056084"><span class="annot"><span class="annottext">b -&gt; c -&gt; d
</span><a href="#local-6989586621679056084"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679056085"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056085"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679056086"><span class="annot"><span class="annottext">Pieces a c
</span><a href="#local-6989586621679056086"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pieces a d -&gt; Pieces a d
forall b a. Mergeable b =&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#mergePieces"><span class="hs-identifier hs-var">mergePieces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((b, c) -&gt; d) -&gt; Pieces a (b, c) -&gt; Pieces a d
forall a b. (a -&gt; b) -&gt; Pieces a a -&gt; Pieces a b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(b -&gt; c -&gt; d) -&gt; (b, c) -&gt; d
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; c -&gt; d
</span><a href="#local-6989586621679056084"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pieces a b -&gt; Pieces a c -&gt; Pieces a (b, c)
forall a b c.
(Num a, Eq a, Ord a, Mergeable b, Mergeable c) =&gt;
Pieces a b -&gt; Pieces a c -&gt; Pieces a (b, c)
</span><a href="PWPs.Piecewise.html#alignPieces"><span class="hs-identifier hs-var">alignPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056085"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a c
</span><a href="#local-6989586621679056086"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><span class="hs-comment">{-|
    We align two piecewise objects by splitting the intervals of one or the other to obtain a consistent set,
    returning a single list containing pairs of the corresponding objects.
    Both lists must initally contain at least one element. Each step either adds an element to one or other list,
    or removes an element from both (generating an element of the output list).
    The process terminates when removing an element from both lists leaves them empty.
    Different alignment cases between the basepoints of the two lists determine how the input lists are transformed,
    and when an element of the output list is produced (for brevity, cases with x and y swapped are omitted).

    Schematically, x = [(bx0,Ox0),(bx1,Ox1),...] y = [(bx0,Oy0),(by1,Oy1),...

    (1) Initial interval underhangs
        bx0 ----Ox0---- bx1 --Ox1-- bx2             -&gt; bx0 ----Ox0---- bx1 --Ox1-- bx2
                             by0 --Oy0--- by1       -&gt; bx0 -------O-------- by0 --Oy0--- by1

    (2) Initial basepoints align, but next points do not
        bx0 --Ox0-- bx1 ---Ox1--- bx2 --            -&gt; bx0 --Ox0-- bx1 ---Ox1--- bx2 --
        by0 ------Oy0------ by1 ----Oy1----by2 --   -&gt; by0 --Oy0-- bx1-Oy0-by1 ----Oy1----by2 --

    (3) Initial and next basepoints align
        bx0 ----Ox0---- bx1 --Ox1-- bx2 --          -&gt; bx1 --Ox1-- bx2 --       } Terminate when
        by0 ----Oy0---- by1 ----Oy1----by2 --       -&gt; by1 ----Oy1----by2 --    } both empty
                 \|/
        bx0 -(Ox0,Oy0): recursive case

    (4) Final interval(s) overhangs
        bx0 -----Ox0----- bx1                       -&gt; bx0 -----Ox0----- bx1
        by0 -Oy0                                    -&gt; by0 -----Oy0----- bx1
-}</span></span><span>
</span><span id="line-123"></span><span id="local-6989586621679055809"><span id="local-6989586621679055810"><span id="local-6989586621679055811"><span class="annot"><a href="PWPs.Piecewise.html#alignPieces"><span class="hs-identifier hs-type">alignPieces</span></a></span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055809"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055809"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055809"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055810"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055811"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055809"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055810"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055809"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055811"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055809"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055810"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055811"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-128"></span><span id="alignPieces"><span class="annot"><span class="annottext">alignPieces :: forall a b c.
(Num a, Eq a, Ord a, Mergeable b, Mergeable c) =&gt;
Pieces a b -&gt; Pieces a c -&gt; Pieces a (b, c)
</span><a href="PWPs.Piecewise.html#alignPieces"><span class="hs-identifier hs-var hs-var">alignPieces</span></a></span></span><span> </span><span id="local-6989586621679056099"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056099"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span id="local-6989586621679056100"><span class="annot"><span class="annottext">Pieces a c
</span><a href="#local-6989586621679056100"><span class="hs-identifier hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a (b, c)] -&gt; Pieces a (b, c)
forall a o. [Piece a o] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; [Piece a c] -&gt; [Piece a (b, c)]
forall a' b' c'.
(Num a', Eq a', Ord a', Mergeable b', Mergeable c') =&gt;
[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
</span><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056099"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pieces a c -&gt; [Piece a c]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a c
</span><a href="#local-6989586621679056100"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679055815"><span id="local-6989586621679055816"><span id="local-6989586621679055817"><span class="annot"><a href="#local-6989586621679056101"><span class="hs-identifier hs-type">doAlign</span></a></span><span>
</span><span id="line-131"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055815"><span class="hs-identifier hs-type">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055815"><span class="hs-identifier hs-type">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055815"><span class="hs-identifier hs-type">a'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055816"><span class="hs-identifier hs-type">b'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055817"><span class="hs-identifier hs-type">c'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055815"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055816"><span class="hs-identifier hs-type">b'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055815"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055817"><span class="hs-identifier hs-type">c'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-134"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055815"><span class="hs-identifier hs-type">a'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055816"><span class="hs-identifier hs-type">b'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055817"><span class="hs-identifier hs-type">c'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span></span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621679056101"><span class="annot"><span class="annottext">doAlign :: forall a' b' c'.
(Num a', Eq a', Ord a', Mergeable b', Mergeable c') =&gt;
[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
</span><a href="#local-6989586621679056101"><span class="hs-identifier hs-var hs-var">doAlign</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Piece a' (b', c')]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty piece list&quot;</span></span><span> </span><span class="hs-comment">-- lists should never be empty</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Piece a' (b', c')]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty piece list&quot;</span></span><span> </span><span class="hs-comment">-- lists should never be empty</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">-- both lists are non-empty</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span id="local-6989586621679056161"><span class="annot"><span class="annottext">x :: [Piece a' b']
</span><a href="#local-6989586621679056161"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679056162"><span class="annot"><span class="annottext">x0 :: Piece a' b'
</span><a href="#local-6989586621679056162"><span class="hs-identifier hs-var">x0</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">basepoint :: forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679056163"><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056163"><span class="hs-identifier hs-var">bx0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">object :: forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679056164"><span class="annot"><span class="annottext">b'
</span><a href="#local-6989586621679056164"><span class="hs-identifier hs-var">ox0</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056165"><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056165"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679056166"><span class="annot"><span class="annottext">y :: [Piece a' c']
</span><a href="#local-6989586621679056166"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679056167"><span class="annot"><span class="annottext">y0 :: Piece a' c'
</span><a href="#local-6989586621679056167"><span class="hs-identifier hs-var">y0</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">basepoint :: forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679056168"><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056168"><span class="hs-identifier hs-var">by0</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">object :: forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679056169"><span class="annot"><span class="annottext">c'
</span><a href="#local-6989586621679056169"><span class="hs-identifier hs-var">oy0</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056170"><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056170"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056163"><span class="hs-identifier hs-var">bx0</span></a></span><span> </span><span class="annot"><span class="annottext">a' -&gt; a' -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056168"><span class="hs-identifier hs-var">by0</span></a></span><span> </span><span class="hs-comment">-- case (1)</span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>            </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
forall a' b' c'.
(Num a', Eq a', Ord a', Mergeable b', Mergeable c') =&gt;
[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
</span><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056161"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a', c') -&gt; Piece a' c'
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056163"><span class="hs-identifier hs-var">bx0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c'
forall a. Mergeable a =&gt; a
</span><a href="PWPs.PiecewiseClasses.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Piece a' c' -&gt; [Piece a' c'] -&gt; [Piece a' c']
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056166"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056163"><span class="hs-identifier hs-var">bx0</span></a></span><span> </span><span class="annot"><span class="annottext">a' -&gt; a' -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056168"><span class="hs-identifier hs-var">by0</span></a></span><span> </span><span class="hs-comment">-- case (1')</span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>            </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
forall a' b' c'.
(Num a', Eq a', Ord a', Mergeable b', Mergeable c') =&gt;
[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
</span><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a', b') -&gt; Piece a' b'
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056168"><span class="hs-identifier hs-var">by0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b'
forall a. Mergeable a =&gt; a
</span><a href="PWPs.PiecewiseClasses.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Piece a' b' -&gt; [Piece a' b'] -&gt; [Piece a' b']
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056161"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056166"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Piece a' c'] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056170"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056165"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-comment">-- case (3) -- terminating case</span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-glyph">=</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(a', (b', c')) -&gt; Piece a' (b', c')
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056163"><span class="hs-identifier hs-var">bx0</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b'
</span><a href="#local-6989586621679056164"><span class="hs-identifier hs-var">ox0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c'
</span><a href="#local-6989586621679056169"><span class="hs-identifier hs-var">oy0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Piece a' c'] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056170"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="hs-comment">-- case (4)</span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-glyph">=</span><span>
</span><span id="line-151"></span><span>            </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
forall a' b' c'.
(Num a', Eq a', Ord a', Mergeable b', Mergeable c') =&gt;
[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
</span><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056161"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Piece a' c'
</span><a href="#local-6989586621679056167"><span class="hs-identifier hs-var">y0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a', c') -&gt; Piece a' c'
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a' b' -&gt; a'
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; Piece a' b'
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056165"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c'
</span><a href="#local-6989586621679056169"><span class="hs-identifier hs-var">oy0</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056165"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-comment">-- case (4')</span><span>
</span><span id="line-153"></span><span>            </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>            </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
forall a' b' c'.
(Num a', Eq a', Ord a', Mergeable b', Mergeable c') =&gt;
[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
</span><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Piece a' b'
</span><a href="#local-6989586621679056162"><span class="hs-identifier hs-var">x0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a', b') -&gt; Piece a' b'
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a' c' -&gt; a'
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a' c'] -&gt; Piece a' c'
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056170"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b'
</span><a href="#local-6989586621679056164"><span class="hs-identifier hs-var">ox0</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056166"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-comment">-- basepoints align, next points exist</span><span>
</span><span id="line-156"></span><span>            </span><span class="hs-glyph">=</span><span>
</span><span id="line-157"></span><span>            </span><span class="hs-keyword">let</span><span>
</span><span id="line-158"></span><span>                </span><span id="local-6989586621679056178"><span class="annot"><span class="annottext">x1 :: Piece a' b'
</span><a href="#local-6989586621679056178"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; Piece a' b'
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056165"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-159"></span><span>                </span><span id="local-6989586621679056181"><span class="annot"><span class="annottext">y1 :: Piece a' c'
</span><a href="#local-6989586621679056181"><span class="hs-identifier hs-var hs-var">y1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a' c'] -&gt; Piece a' c'
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056170"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-160"></span><span>                </span><span id="local-6989586621679056182"><span class="annot"><span class="annottext">bx1 :: a'
</span><a href="#local-6989586621679056182"><span class="hs-identifier hs-var hs-var">bx1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Piece a' b' -&gt; a'
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a' b'
</span><a href="#local-6989586621679056178"><span class="hs-identifier hs-var">x1</span></a></span><span>
</span><span id="line-161"></span><span>                </span><span id="local-6989586621679056183"><span class="annot"><span class="annottext">by1 :: a'
</span><a href="#local-6989586621679056183"><span class="hs-identifier hs-var hs-var">by1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Piece a' c' -&gt; a'
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a' c'
</span><a href="#local-6989586621679056181"><span class="hs-identifier hs-var">y1</span></a></span><span>
</span><span id="line-162"></span><span>            </span><span class="hs-keyword">in</span><span>
</span><span id="line-163"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a' -&gt; a' -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056182"><span class="hs-identifier hs-var">bx1</span></a></span><span> </span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056183"><span class="hs-identifier hs-var">by1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-164"></span><span>                    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
forall a' b' c'.
(Num a', Eq a', Ord a', Mergeable b', Mergeable c') =&gt;
[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
</span><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056161"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a' c'
</span><a href="#local-6989586621679056167"><span class="hs-identifier hs-var">y0</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a' c' -&gt; [Piece a' c'] -&gt; [Piece a' c']
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(a', c') -&gt; Piece a' c'
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056182"><span class="hs-identifier hs-var">bx1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c'
</span><a href="#local-6989586621679056169"><span class="hs-identifier hs-var">oy0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Piece a' c' -&gt; [Piece a' c'] -&gt; [Piece a' c']
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056170"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- case (2)</span><span>
</span><span id="line-165"></span><span>                    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
forall a' b' c'.
(Num a', Eq a', Ord a', Mergeable b', Mergeable c') =&gt;
[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
</span><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a' b'
</span><a href="#local-6989586621679056162"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a' b' -&gt; [Piece a' b'] -&gt; [Piece a' b']
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(a', b') -&gt; Piece a' b'
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056183"><span class="hs-identifier hs-var">by1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b'
</span><a href="#local-6989586621679056164"><span class="hs-identifier hs-var">ox0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Piece a' b' -&gt; [Piece a' b'] -&gt; [Piece a' b']
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056165"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056166"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-comment">-- case (2')</span><span>
</span><span id="line-166"></span><span>                    </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a', (b', c')) -&gt; Piece a' (b', c')
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a'
</span><a href="#local-6989586621679056163"><span class="hs-identifier hs-var">bx0</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b'
</span><a href="#local-6989586621679056164"><span class="hs-identifier hs-var">ox0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c'
</span><a href="#local-6989586621679056169"><span class="hs-identifier hs-var">oy0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Piece a' (b', c') -&gt; [Piece a' (b', c')] -&gt; [Piece a' (b', c')]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
forall a' b' c'.
(Num a', Eq a', Ord a', Mergeable b', Mergeable c') =&gt;
[Piece a' b'] -&gt; [Piece a' c'] -&gt; [Piece a' (b', c')]
</span><a href="#local-6989586621679056101"><span class="hs-identifier hs-var">doAlign</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a' b']
</span><a href="#local-6989586621679056165"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a' c']
</span><a href="#local-6989586621679056170"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="hs-comment">-- case (3)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><span class="hs-comment">-- | Check that a list of values is monotonic (not strict to allow deltas)</span></span><span>
</span><span id="line-169"></span><span id="local-6989586621679055828"><span class="annot"><a href="PWPs.Piecewise.html#monotonic"><span class="hs-identifier hs-type">monotonic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055828"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679055828"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-170"></span><span id="monotonic"><span class="annot"><span class="annottext">monotonic :: forall a. Ord a =&gt; [a] -&gt; Bool
</span><a href="PWPs.Piecewise.html#monotonic"><span class="hs-identifier hs-var hs-var">monotonic</span></a></span></span><span> </span><span id="local-6989586621679056190"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679056190"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(&lt;=)</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679056190"><span class="hs-identifier hs-var">ys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679056190"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span id="local-6989586621679055835"><span id="local-6989586621679055836"><span class="annot"><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-type">makePieces</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055835"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055835"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055835"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055835"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055836"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055835"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055836"><span class="hs-identifier hs-type">o</span></a></span></span></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- check the basepoints are in order</span><span>
</span><span id="line-174"></span><span id="makePieces"><span class="annot"><span class="annottext">makePieces :: forall a o. (Num a, Eq a, Ord a) =&gt; [(a, o)] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#makePieces"><span class="hs-identifier hs-var hs-var">makePieces</span></a></span></span><span> </span><span id="local-6989586621679056211"><span class="annot"><span class="annottext">[(a, o)]
</span><a href="#local-6989586621679056211"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(a, o)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(a, o)]
</span><a href="#local-6989586621679056211"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Pieces a o
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Provided list was empty&quot;</span></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(a, o)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(a, o)]
</span><a href="#local-6989586621679056211"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a o] -&gt; Pieces a o
forall a o. [Piece a o] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(a, o) -&gt; Piece a o
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(a, o)] -&gt; (a, o)
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[(a, o)]
</span><a href="#local-6989586621679056211"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- deal with the single element list case</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a] -&gt; Bool
forall a. Ord a =&gt; [a] -&gt; Bool
</span><a href="PWPs.Piecewise.html#monotonic"><span class="hs-identifier hs-var">monotonic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, o) -&gt; a) -&gt; [(a, o)] -&gt; [a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, o) -&gt; a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(a, o)]
</span><a href="#local-6989586621679056211"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Pieces a o
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Basepoints were not in order&quot;</span></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a o] -&gt; Pieces a o
forall a o. [Piece a o] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, o) -&gt; Piece a o) -&gt; [(a, o)] -&gt; [Piece a o]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, o) -&gt; Piece a o
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, o)]
</span><a href="#local-6989586621679056211"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679055845"><span id="local-6989586621679055846"><span id="local-6989586621679056222"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055845"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055845"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055845"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055846"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055846"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055845"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055846"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679056238"><span class="annot"><span class="annottext">+ :: Pieces a b -&gt; Pieces a b -&gt; Pieces a b
</span><a href="#local-6989586621679056238"><span class="hs-operator hs-var hs-var hs-var">(+)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b -&gt; b) -&gt; Pieces a b -&gt; Pieces a b -&gt; Pieces a b
forall a b c d.
(Num a, Eq a, Ord a, Mergeable b, Mergeable c, Mergeable d) =&gt;
(b -&gt; c -&gt; d) -&gt; Pieces a b -&gt; Pieces a c -&gt; Pieces a d
</span><a href="PWPs.Piecewise.html#combinePieces"><span class="hs-identifier hs-var">combinePieces</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679056247"><span class="annot"><span class="annottext">* :: Pieces a b -&gt; Pieces a b -&gt; Pieces a b
</span><a href="#local-6989586621679056247"><span class="hs-operator hs-var hs-var hs-var">(*)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b -&gt; b) -&gt; Pieces a b -&gt; Pieces a b -&gt; Pieces a b
forall a b c d.
(Num a, Eq a, Ord a, Mergeable b, Mergeable c, Mergeable d) =&gt;
(b -&gt; c -&gt; d) -&gt; Pieces a b -&gt; Pieces a c -&gt; Pieces a d
</span><a href="PWPs.Piecewise.html#combinePieces"><span class="hs-identifier hs-var">combinePieces</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(*)</span></span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679056251"><span class="annot"><span class="annottext">negate :: Pieces a b -&gt; Pieces a b
</span><span class="hs-identifier hs-var hs-var hs-var">negate</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; Pieces a b -&gt; Pieces a b
forall a b. (a -&gt; b) -&gt; Pieces a a -&gt; Pieces a b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; b
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621679056254"><span class="annot"><span class="annottext">abs :: Pieces a b -&gt; Pieces a b
</span><a href="#local-6989586621679056254"><span class="hs-identifier hs-var hs-var hs-var">abs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pieces a b -&gt; Pieces a b
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621679056259"><span class="annot"><span class="annottext">signum :: Pieces a b -&gt; Pieces a b
</span><a href="#local-6989586621679056259"><span class="hs-identifier hs-var hs-var hs-var">signum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pieces a b -&gt; Pieces a b
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-186"></span><span>    </span><span id="local-6989586621679056263"><span class="annot"><span class="annottext">fromInteger :: Integer -&gt; Pieces a b
</span><span class="hs-identifier hs-var hs-var hs-var">fromInteger</span></span></span><span> </span><span id="local-6989586621679056264"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679056264"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; Pieces a b
forall a o. [Piece a o] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">basepoint :: a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679055845"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">object :: b
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; b
forall a. Num a =&gt; Integer -&gt; a
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679056264"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">}</span><span class="hs-special">]</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="annot"><a href="PWPs.Piecewise.html#integratePieces"><span class="hs-identifier hs-type">integratePieces</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679055849"><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679055850"><span class="annot"><a href="#local-6989586621679055850"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679055851"><span class="annot"><a href="#local-6989586621679055851"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-190"></span><span>     </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#StepIntegrable"><span class="hs-identifier hs-type">StepIntegrable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055850"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055851"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055851"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055850"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055851"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-193"></span><span id="integratePieces"><span class="annot"><span class="annottext">integratePieces :: forall a b c.
(Num a, Eq a, Ord a, StepIntegrable a b c, Evaluable a c) =&gt;
Pieces a b -&gt; Pieces a c
</span><a href="PWPs.Piecewise.html#integratePieces"><span class="hs-identifier hs-var hs-var">integratePieces</span></a></span></span><span> </span><span id="local-6989586621679056275"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056275"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a c] -&gt; Pieces a c
forall a o. [Piece a o] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; [(a, a, b)] -&gt; [Piece a c]
</span><a href="#local-6989586621679056276"><span class="hs-identifier hs-var">goInt</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; [(a, a, b)]
forall a o. Num a =&gt; [Piece a o] -&gt; [(a, a, o)]
</span><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var">disaggregate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056275"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>    </span><span class="annot"><a href="#local-6989586621679056276"><span class="hs-identifier hs-type">goInt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055850"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055849"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055851"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679056276"><span class="annot"><span class="annottext">goInt :: a -&gt; [(a, a, b)] -&gt; [Piece a c]
</span><a href="#local-6989586621679056276"><span class="hs-identifier hs-var hs-var">goInt</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- stop when the list of pieces is empty</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-comment">{-
       We evaluate each integrated object at the initial and final points of the interval.
       We receive the integrated value from the end of the previous interval, and adjust the integrated object so
       that its initial value matches this.
       We add the new object to the ouput list and pass on the received integated value plus the evaluated integral
       at the end of the interval.
    -}</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><a href="#local-6989586621679056276"><span class="hs-identifier hs-var">goInt</span></a></span><span> </span><span id="local-6989586621679056278"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056278"><span class="hs-identifier hs-var">previousIntegral</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679056279"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056279"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056280"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056280"><span class="hs-identifier hs-var">lp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056281"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056281"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056282"><span class="annot"><span class="annottext">[(a, a, b)]
</span><a href="#local-6989586621679056282"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either a c
forall a b c. StepIntegrable a b c =&gt; b -&gt; Either a c
</span><a href="PWPs.PiecewiseClasses.html#integrateStep"><span class="hs-identifier hs-var">integrateStep</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056281"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-205"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679056284"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679056284"><span class="hs-identifier hs-var">integratedPoly</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, c) -&gt; Piece a c
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056279"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; c -&gt; c
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; b
</span><a href="PWPs.PiecewiseClasses.html#boost"><span class="hs-identifier hs-var">boost</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056286"><span class="hs-identifier hs-var">offset</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679056284"><span class="hs-identifier hs-var">integratedPoly</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Piece a c -&gt; [Piece a c] -&gt; [Piece a c]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [(a, a, b)] -&gt; [Piece a c]
</span><a href="#local-6989586621679056276"><span class="hs-identifier hs-var">goInt</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056287"><span class="hs-identifier hs-var">newIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, b)]
</span><a href="#local-6989586621679056282"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-206"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-207"></span><span>            </span><span id="local-6989586621679056289"><span class="annot"><span class="annottext">basepointValue :: a
</span><a href="#local-6989586621679056289"><span class="hs-identifier hs-var hs-var">basepointValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; c -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056279"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679056284"><span class="hs-identifier hs-var">integratedPoly</span></a></span><span> </span><span class="hs-comment">-- the integral at the start of the current interval</span><span>
</span><span id="line-208"></span><span>            </span><span id="local-6989586621679056292"><span class="annot"><span class="annottext">finalValue :: a
</span><a href="#local-6989586621679056292"><span class="hs-identifier hs-var hs-var">finalValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; c -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056280"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679056284"><span class="hs-identifier hs-var">integratedPoly</span></a></span><span> </span><span class="hs-comment">-- the integral at the end of the current interval</span><span>
</span><span id="line-209"></span><span>            </span><span id="local-6989586621679056286"><span class="annot"><span class="annottext">offset :: a
</span><a href="#local-6989586621679056286"><span class="hs-identifier hs-var hs-var">offset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056278"><span class="hs-identifier hs-var">previousIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056289"><span class="hs-identifier hs-var">basepointValue</span></a></span><span>
</span><span id="line-210"></span><span>            </span><span id="local-6989586621679056287"><span class="annot"><span class="annottext">newIntegral :: a
</span><a href="#local-6989586621679056287"><span class="hs-identifier hs-var hs-var">newIntegral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056292"><span class="hs-identifier hs-var">finalValue</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056286"><span class="hs-identifier hs-var">offset</span></a></span><span>
</span><span id="line-211"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679056295"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056295"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; [(a, a, b)] -&gt; [Piece a c]
</span><a href="#local-6989586621679056276"><span class="hs-identifier hs-var">goInt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056278"><span class="hs-identifier hs-var">previousIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056295"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, a, b)]
</span><a href="#local-6989586621679056282"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621679055870"><span id="local-6989586621679055871"><span id="local-6989586621679055872"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055870"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055870"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055870"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#StepIntegrable"><span class="hs-identifier hs-type">StepIntegrable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055870"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055871"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055872"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055872"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055870"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055872"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-type">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055870"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055871"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055870"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055872"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621679056310"><span class="annot"><span class="annottext">integrate :: Pieces a b -&gt; Pieces a c
</span><a href="#local-6989586621679056310"><span class="hs-identifier hs-var hs-var hs-var">integrate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pieces a b -&gt; Pieces a c
forall a b c.
(Num a, Eq a, Ord a, StepIntegrable a b c, Evaluable a c) =&gt;
Pieces a b -&gt; Pieces a c
</span><a href="PWPs.Piecewise.html#integratePieces"><span class="hs-identifier hs-var">integratePieces</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="annot"><span class="hs-comment">{-|
For piecewise differentiation, we can differentate each piece separately, but we must first check for discontinuities
between the pieces, which need to be turned into additional pieces with delta functions corresponding to the size of
the jumps.
-}</span></span><span>
</span><span id="line-224"></span><span class="annot"><a href="PWPs.Piecewise.html#differentiatePieces"><span class="hs-identifier hs-type">differentiatePieces</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679055873"><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679055874"><span class="annot"><a href="#local-6989586621679055874"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679055875"><span class="annot"><a href="#local-6989586621679055875"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-226"></span><span>     </span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#StepDifferentiable"><span class="hs-identifier hs-type">StepDifferentiable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055874"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055875"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055874"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055875"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055874"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055875"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-229"></span><span id="differentiatePieces"><span class="annot"><span class="annottext">differentiatePieces :: forall a b c.
(Num a, Eq a, Ord a, StepDifferentiable a b c, Evaluable a b,
 Mergeable c) =&gt;
Pieces a b -&gt; Pieces a c
</span><a href="PWPs.Piecewise.html#differentiatePieces"><span class="hs-identifier hs-var hs-var">differentiatePieces</span></a></span></span><span> </span><span id="local-6989586621679056325"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056325"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pieces a c -&gt; Pieces a c
forall b a. Mergeable b =&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#mergePieces"><span class="hs-identifier hs-var">mergePieces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a c] -&gt; Pieces a c
forall a o. [Piece a o] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; [(a, a, b)] -&gt; [Piece a c]
</span><a href="#local-6989586621679056326"><span class="hs-identifier hs-var">goDiff</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; [(a, a, b)]
forall a o. Num a =&gt; [Piece a o] -&gt; [(a, a, o)]
</span><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var">disaggregate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056325"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><a href="#local-6989586621679056326"><span class="hs-identifier hs-type">goDiff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055874"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055873"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055875"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621679056326"><span class="annot"><span class="annottext">goDiff :: a -&gt; [(a, a, b)] -&gt; [Piece a c]
</span><a href="#local-6989586621679056326"><span class="hs-identifier hs-var hs-var">goDiff</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- stop when the list of pieces is empty</span><span>
</span><span id="line-233"></span><span>    </span><span class="annot"><a href="#local-6989586621679056326"><span class="hs-identifier hs-var">goDiff</span></a></span><span> </span><span id="local-6989586621679056327"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056327"><span class="hs-identifier hs-var">previousValue</span></a></span></span><span> </span><span id="local-6989586621679056328"><span class="annot"><span class="annottext">x :: [(a, a, b)]
</span><a href="#local-6989586621679056328"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679056329"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056329"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056330"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056330"><span class="hs-identifier hs-var">lp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056331"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056331"><span class="hs-identifier hs-var">x0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056332"><span class="annot"><span class="annottext">[(a, a, b)]
</span><a href="#local-6989586621679056332"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056333"><span class="hs-identifier hs-var">jump</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span> </span><span class="hs-comment">-- pieces join without a discontinuity</span><span>
</span><span id="line-235"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- simply differentiate this piece and move on</span><span>
</span><span id="line-236"></span><span>                </span><span class="annot"><span class="annottext">(a, c) -&gt; Piece a c
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056329"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; c
forall a b c. StepDifferentiable a b c =&gt; (a, b) -&gt; c
</span><a href="PWPs.PiecewiseClasses.html#differentiateStep"><span class="hs-identifier hs-var">differentiateStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056333"><span class="hs-identifier hs-var">jump</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056331"><span class="hs-identifier hs-var">x0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Piece a c -&gt; [Piece a c] -&gt; [Piece a c]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [(a, a, b)] -&gt; [Piece a c]
</span><a href="#local-6989586621679056326"><span class="hs-identifier hs-var">goDiff</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056335"><span class="hs-identifier hs-var">finalValue</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, b)]
</span><a href="#local-6989586621679056332"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- insert extra zero-width piece containing a delta and try this piece again with the boosted value</span><span>
</span><span id="line-238"></span><span>                </span><span class="annot"><span class="annottext">(a, c) -&gt; Piece a c
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056329"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; c
forall a b c. StepDifferentiable a b c =&gt; (a, b) -&gt; c
</span><a href="PWPs.PiecewiseClasses.html#differentiateStep"><span class="hs-identifier hs-var">differentiateStep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056333"><span class="hs-identifier hs-var">jump</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056331"><span class="hs-identifier hs-var">x0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Piece a c -&gt; [Piece a c] -&gt; [Piece a c]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [(a, a, b)] -&gt; [Piece a c]
</span><a href="#local-6989586621679056326"><span class="hs-identifier hs-var">goDiff</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056336"><span class="hs-identifier hs-var">newValue</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, b)]
</span><a href="#local-6989586621679056328"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-239"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-240"></span><span>        </span><span id="local-6989586621679056336"><span class="annot"><span class="annottext">newValue :: a
</span><a href="#local-6989586621679056336"><span class="hs-identifier hs-var hs-var">newValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056329"><span class="hs-identifier hs-var">fp</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056331"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="hs-comment">-- value at the start of the interval</span><span>
</span><span id="line-241"></span><span>        </span><span id="local-6989586621679056335"><span class="annot"><span class="annottext">finalValue :: a
</span><a href="#local-6989586621679056335"><span class="hs-identifier hs-var hs-var">finalValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056330"><span class="hs-identifier hs-var">lp</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056331"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="hs-comment">-- value at the end of the interval</span><span>
</span><span id="line-242"></span><span>        </span><span id="local-6989586621679056333"><span class="annot"><span class="annottext">jump :: a
</span><a href="#local-6989586621679056333"><span class="hs-identifier hs-var hs-var">jump</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056336"><span class="hs-identifier hs-var">newValue</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056327"><span class="hs-identifier hs-var">previousValue</span></a></span><span> </span><span class="hs-comment">-- difference between the end of the previous interval and the start of this one</span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-245"></span><span>    </span><span id="local-6989586621679055889"><span id="local-6989586621679055890"><span id="local-6989586621679055891"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055889"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055889"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055889"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#StepDifferentiable"><span class="hs-identifier hs-type">StepDifferentiable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055889"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055890"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055891"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055891"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055889"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055890"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-type">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055889"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055890"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055889"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055891"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621679056355"><span class="annot"><span class="annottext">differentiate :: Pieces a b -&gt; Pieces a c
</span><a href="#local-6989586621679056355"><span class="hs-identifier hs-var hs-var hs-var">differentiate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pieces a b -&gt; Pieces a c
forall a b c.
(Num a, Eq a, Ord a, StepDifferentiable a b c, Evaluable a b,
 Mergeable c) =&gt;
Pieces a b -&gt; Pieces a c
</span><a href="PWPs.Piecewise.html#differentiatePieces"><span class="hs-identifier hs-var">differentiatePieces</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="annot"><span class="hs-comment">{-|
To evaluate a piecewise object at a point we need to find the interval the point is in,
(i.e. find i s.t. basepoint(i) &lt;= p &lt; basepoint(i+1)) and then evaluate the corresponding object.
Our point may be beyond the last basepoint, in which case we take the final value,
or it may be before the first basepoint, in which case we evaluate the presumed zero object (to 0).
-}</span></span><span>
</span><span id="line-256"></span><span id="local-6989586621679055892"><span id="local-6989586621679055893"><span class="annot"><a href="PWPs.Piecewise.html#evaluateAtApoint"><span class="hs-identifier hs-type">evaluateAtApoint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055892"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055892"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055892"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055893"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055892"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055892"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055893"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055892"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-257"></span><span id="evaluateAtApoint"><span class="annot"><span class="annottext">evaluateAtApoint :: forall a b. (Num a, Ord a, Evaluable a b) =&gt; a -&gt; Pieces a b -&gt; a
</span><a href="PWPs.Piecewise.html#evaluateAtApoint"><span class="hs-identifier hs-var hs-var">evaluateAtApoint</span></a></span></span><span> </span><span id="local-6989586621679056371"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056371"><span class="hs-identifier hs-var">point</span></a></span></span><span> </span><span id="local-6989586621679056372"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056372"><span class="hs-keyword hs-var">as</span></a></span></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056373"><span class="hs-identifier hs-var">pas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty piece list&quot;</span></span><span>
</span><span id="line-259"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056371"><span class="hs-identifier hs-var">point</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; Piece a b
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056373"><span class="hs-identifier hs-var">pas</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span>
</span><span id="line-260"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; [Piece a b] -&gt; a
forall {b}. Evaluable a b =&gt; a -&gt; [Piece a b] -&gt; a
</span><a href="#local-6989586621679056374"><span class="hs-identifier hs-var">goEval</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056371"><span class="hs-identifier hs-var">point</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056373"><span class="hs-identifier hs-var">pas</span></a></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621679056373"><span class="annot"><span class="annottext">pas :: [Piece a b]
</span><a href="#local-6989586621679056373"><span class="hs-identifier hs-var hs-var">pas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056372"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span id="local-6989586621679056374"><span class="annot"><span class="annottext">goEval :: a -&gt; [Piece a b] -&gt; a
</span><a href="#local-6989586621679056374"><span class="hs-identifier hs-var hs-var">goEval</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty piece list&quot;</span></span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="#local-6989586621679056374"><span class="hs-identifier hs-var">goEval</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Piece a b
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; Piece a b
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056373"><span class="hs-identifier hs-var">pas</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b -&gt; b
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; Piece a b
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056373"><span class="hs-identifier hs-var">pas</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="#local-6989586621679056374"><span class="hs-identifier hs-var">goEval</span></a></span><span> </span><span id="local-6989586621679056388"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056388"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679056389"><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056389"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056390"><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056390"><span class="hs-identifier hs-var">x2</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056391"><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056391"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056389"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056388"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056388"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056390"><span class="hs-identifier hs-var">x2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056388"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b -&gt; b
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056389"><span class="hs-identifier hs-var">x1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a -&gt; [Piece a b] -&gt; a
</span><a href="#local-6989586621679056374"><span class="hs-identifier hs-var">goEval</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056388"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056390"><span class="hs-identifier hs-var">x2</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; [Piece a b] -&gt; [Piece a b]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056391"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><span class="hs-comment">-- | Find the value of the ultimate object at the last basepoint</span></span><span>
</span><span id="line-271"></span><span id="local-6989586621679055897"><span id="local-6989586621679055898"><span class="annot"><a href="PWPs.Piecewise.html#piecesFinalValue"><span class="hs-identifier hs-type">piecesFinalValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055897"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055897"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055898"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055897"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055898"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055897"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-272"></span><span id="piecesFinalValue"><span class="annot"><span class="annottext">piecesFinalValue :: forall a b. (Num a, Evaluable a b) =&gt; Pieces a b -&gt; a
</span><a href="PWPs.Piecewise.html#piecesFinalValue"><span class="hs-identifier hs-var hs-var">piecesFinalValue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty piece list&quot;</span></span><span>
</span><span id="line-273"></span><span class="annot"><a href="PWPs.Piecewise.html#piecesFinalValue"><span class="hs-identifier hs-var">piecesFinalValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span id="local-6989586621679056401"><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056401"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; a
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; Piece a b
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056401"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a b -&gt; b
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; Piece a b
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056401"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679055903"><span id="local-6989586621679055904"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055903"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055903"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055904"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055903"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055903"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055904"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-276"></span><span>    </span><span id="local-6989586621679056414"><span class="annot"><span class="annottext">evaluate :: a -&gt; Pieces a b -&gt; a
</span><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-var hs-var hs-var">evaluate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Pieces a b -&gt; a
forall a b. (Num a, Ord a, Evaluable a b) =&gt; a -&gt; Pieces a b -&gt; a
</span><a href="PWPs.Piecewise.html#evaluateAtApoint"><span class="hs-identifier hs-var">evaluateAtApoint</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span id="local-6989586621679056417"><span class="annot"><span class="annottext">boost :: a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.PiecewiseClasses.html#boost"><span class="hs-identifier hs-var hs-var hs-var">boost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; Pieces a b -&gt; Pieces a b
forall a b. (a -&gt; b) -&gt; Pieces a a -&gt; Pieces a b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((b -&gt; b) -&gt; Pieces a b -&gt; Pieces a b)
-&gt; (a -&gt; b -&gt; b) -&gt; a -&gt; Pieces a b -&gt; Pieces a b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; b
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; b
</span><a href="PWPs.PiecewiseClasses.html#boost"><span class="hs-identifier hs-var">boost</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span id="local-6989586621679056421"><span class="annot"><span class="annottext">scale :: a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="#local-6989586621679056421"><span class="hs-identifier hs-var hs-var hs-var">scale</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Pieces a b -&gt; Pieces a b
forall a b.
(Eq a, Num a, Evaluable a b) =&gt;
a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-var">(&gt;&lt;)</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><span class="hs-comment">{-|
Piecwise convolution requires convolving the pieces pairwise and then summing the results,
i.e. convolve every piece with every other piece and combine the results.
-}</span></span><span>
</span><span id="line-284"></span><span id="local-6989586621679055907"><span id="local-6989586621679055908"><span class="annot"><a href="PWPs.Piecewise.html#%3C%2B%3E"><span class="hs-operator hs-type">(&lt;+&gt;)</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055907"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-286"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055907"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-287"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679055907"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-288"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679055907"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-289"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055908"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-290"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055908"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-291"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055907"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055908"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-292"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#CompactConvolvable"><span class="hs-identifier hs-type">CompactConvolvable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055907"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055908"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-293"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055907"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055908"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055907"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055908"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055907"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055908"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span class="hs-keyword">infix</span><span> </span><span class="hs-number">7</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span>
</span><span id="line-299"></span><span id="%3C%2B%3E"><span class="annot"><span class="annottext">&lt;+&gt; :: forall a b.
(Ord a, Num a, Enum a, Fractional a, Num b, Mergeable b,
 Evaluable a b, CompactConvolvable a b) =&gt;
Pieces a b -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3C%2B%3E"><span class="hs-operator hs-var hs-var">(&lt;+&gt;)</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Pieces a b
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty piece list&quot;</span></span><span>
</span><span id="line-300"></span><span class="annot"><a href="PWPs.Piecewise.html#%3C%2B%3E"><span class="hs-operator hs-var">(&lt;+&gt;)</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Pieces a b
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty piece list&quot;</span></span><span>
</span><span id="line-301"></span><span class="annot"><a href="PWPs.Piecewise.html#%3C%2B%3E"><span class="hs-operator hs-var">(&lt;+&gt;)</span></a></span><span> </span><span id="local-6989586621679056439"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056439"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621679056440"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056440"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pieces a b] -&gt; Pieces a b
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Piece a b] -&gt; Pieces a b
forall a o. [Piece a o] -&gt; Pieces a o
</span><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-var">Pieces</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, b) -&gt; Piece a b) -&gt; [(a, b)] -&gt; [Piece a b]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, b) -&gt; Piece a b
forall a o. (a, o) -&gt; Piece a o
</span><a href="PWPs.Piecewise.html#makePiece"><span class="hs-identifier hs-var">makePiece</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, a, b) -&gt; (a, a, b) -&gt; [(a, b)]
forall a b.
CompactConvolvable a b =&gt;
(a, a, b) -&gt; (a, a, b) -&gt; [(a, b)]
</span><a href="PWPs.PiecewiseClasses.html#convolveIntervals"><span class="hs-identifier hs-var">convolveIntervals</span></a></span><span> </span><span class="annot"><span class="annottext">(a, a, b)
</span><a href="#local-6989586621679056443"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">(a, a, b)
</span><a href="#local-6989586621679056444"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679056443"><span class="annot"><span class="annottext">(a, a, b)
</span><a href="#local-6989586621679056443"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, a, b)]
</span><a href="#local-6989586621679056445"><span class="hs-identifier hs-var">das</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679056444"><span class="annot"><span class="annottext">(a, a, b)
</span><a href="#local-6989586621679056444"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, a, b)]
</span><a href="#local-6989586621679056446"><span class="hs-identifier hs-var">dbs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-302"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-303"></span><span>    </span><span id="local-6989586621679056445"><span class="annot"><span class="annottext">das :: [(a, a, b)]
</span><a href="#local-6989586621679056445"><span class="hs-identifier hs-var hs-var">das</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; [(a, a, b)]
forall a o. Num a =&gt; [Piece a o] -&gt; [(a, a, o)]
</span><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var">disaggregate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056439"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679056446"><span class="annot"><span class="annottext">dbs :: [(a, a, b)]
</span><a href="#local-6989586621679056446"><span class="hs-identifier hs-var hs-var">dbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; [(a, a, b)]
forall a o. Num a =&gt; [Piece a o] -&gt; [(a, a, o)]
</span><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var">disaggregate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056440"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>
</span><span id="line-306"></span><span class="annot"><span class="hs-comment">-- | disaggregate takes a Pieces list and produces a list of separate bounded intervals</span></span><span>
</span><span id="line-307"></span><span id="local-6989586621679055857"><span id="local-6989586621679055858"><span class="annot"><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-type">disaggregate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055857"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PWPs.Piecewise.html#Piece"><span class="hs-identifier hs-type">Piece</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055857"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055858"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055857"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055857"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055858"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-308"></span><span id="disaggregate"><span class="annot"><span class="annottext">disaggregate :: forall a o. Num a =&gt; [Piece a o] -&gt; [(a, a, o)]
</span><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var hs-var">disaggregate</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(a, a, o)]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Empty piece list&quot;</span></span><span>
</span><span id="line-309"></span><span class="annot"><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var">disaggregate</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621679056457"><span class="annot"><span class="annottext">Piece a o
</span><a href="#local-6989586621679056457"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a o -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a o
</span><a href="#local-6989586621679056457"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Piece a o -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a o
</span><a href="#local-6989586621679056457"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Piece a o -&gt; o
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a o
</span><a href="#local-6989586621679056457"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- turn the last piece into an 'infinite' interval</span><span>
</span><span id="line-310"></span><span class="annot"><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var">disaggregate</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679056458"><span class="annot"><span class="annottext">Piece a o
</span><a href="#local-6989586621679056458"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056459"><span class="annot"><span class="annottext">xs :: [Piece a o]
</span><a href="#local-6989586621679056459"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679056460"><span class="annot"><span class="annottext">Piece a o
</span><a href="#local-6989586621679056460"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a o]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Piece a o -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a o
</span><a href="#local-6989586621679056458"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Piece a o -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a o
</span><a href="#local-6989586621679056460"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Piece a o -&gt; o
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a o
</span><a href="#local-6989586621679056458"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a, a, o) -&gt; [(a, a, o)] -&gt; [(a, a, o)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Piece a o] -&gt; [(a, a, o)]
forall a o. Num a =&gt; [Piece a o] -&gt; [(a, a, o)]
</span><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var">disaggregate</span></a></span><span> </span><span class="annot"><span class="annottext">[Piece a o]
</span><a href="#local-6989586621679056459"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span id="local-6989586621679055917"><span id="local-6989586621679055918"><span class="annot"><a href="PWPs.Piecewise.html#displayPolyDeltaIntervals"><span class="hs-identifier hs-type">displayPolyDeltaIntervals</span></a></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Displayable"><span class="hs-identifier hs-type">Displayable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055918"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055918"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055917"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span></span></span><span>
</span><span id="line-317"></span><span id="displayPolyDeltaIntervals"><span class="annot"><span class="annottext">displayPolyDeltaIntervals :: forall a b.
(Ord a, Enum a, Eq a, Fractional a, Num a, Displayable a b) =&gt;
Pieces a b -&gt; a -&gt; [Either (a, a) [(a, a)]]
</span><a href="PWPs.Piecewise.html#displayPolyDeltaIntervals"><span class="hs-identifier hs-var hs-var">displayPolyDeltaIntervals</span></a></span></span><span> </span><span id="local-6989586621679056469"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056469"><span class="hs-keyword hs-var">as</span></a></span></span><span> </span><span id="local-6989586621679056470"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056470"><span class="hs-identifier hs-var">spacing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, a, b) -&gt; Either (a, a) [(a, a)])
-&gt; [(a, a, b)] -&gt; [Either (a, a) [(a, a)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; (a, a, b) -&gt; Either (a, a) [(a, a)]
forall a b.
Displayable a b =&gt;
a -&gt; (a, a, b) -&gt; Either (a, a) [(a, a)]
</span><a href="PWPs.PiecewiseClasses.html#displayObject"><span class="hs-identifier hs-var">displayObject</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056470"><span class="hs-identifier hs-var">spacing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(a, a, b)] -&gt; [Either (a, a) [(a, a)]])
-&gt; [(a, a, b)] -&gt; [Either (a, a) [(a, a)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; [(a, a, b)]
forall a o. Num a =&gt; [Piece a o] -&gt; [(a, a, o)]
</span><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var">disaggregate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056469"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-keyword">infix</span><span> </span><span class="hs-number">7</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-type">&gt;&lt;</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="annot"><span class="hs-comment">-- | multiply by a constant piecewise</span></span><span>
</span><span id="line-322"></span><span id="local-6989586621679055905"><span id="local-6989586621679055906"><span class="annot"><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-type">(&gt;&lt;)</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055905"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055905"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055905"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055906"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055905"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055905"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055906"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055905"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055906"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-323"></span><span id="%3E%3C"><span class="annot"><span class="annottext">&gt;&lt; :: forall a b.
(Eq a, Num a, Evaluable a b) =&gt;
a -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#%3E%3C"><span class="hs-operator hs-var hs-var">(&gt;&lt;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; Pieces a b -&gt; Pieces a b
forall a b. (a -&gt; b) -&gt; Pieces a a -&gt; Pieces a b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((b -&gt; b) -&gt; Pieces a b -&gt; Pieces a b)
-&gt; (a -&gt; b -&gt; b) -&gt; a -&gt; Pieces a b -&gt; Pieces a b
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b -&gt; b
forall a b. Evaluable a b =&gt; a -&gt; b -&gt; b
</span><a href="PWPs.PiecewiseClasses.html#scale"><span class="hs-identifier hs-var">scale</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="annot"><span class="hs-comment">-- | Check whether the pieces are all comparable, and if so if all compare the same way</span></span><span>
</span><span id="line-326"></span><span id="local-6989586621679055930"><span id="local-6989586621679055931"><span class="annot"><a href="PWPs.Piecewise.html#comparePW"><span class="hs-identifier hs-type">comparePW</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679055930"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055930"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055930"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Comparable"><span class="hs-identifier hs-type">Comparable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055930"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055931"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="annot"><a href="#local-6989586621679055931"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055931"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-type">Evaluable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055930"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055931"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055930"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055931"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-329"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055930"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055931"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span></span></span><span>
</span><span id="line-331"></span><span id="comparePW"><span class="annot"><span class="annottext">comparePW :: forall a b.
(Fractional a, Eq a, Ord a, Comparable a b, Num b, Mergeable b,
 Evaluable a b) =&gt;
Pieces a b -&gt; Pieces a b -&gt; Maybe Ordering
</span><a href="PWPs.Piecewise.html#comparePW"><span class="hs-identifier hs-var hs-var">comparePW</span></a></span></span><span> </span><span id="local-6989586621679056496"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056496"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span id="local-6989586621679056497"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056497"><span class="hs-identifier hs-var">y'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Ordering -&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
forall a b.
(Fractional a, Eq a, Ord a, Comparable a b) =&gt;
Maybe Ordering -&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
</span><a href="#local-6989586621679056498"><span class="hs-identifier hs-var">goCompare</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ordering -&gt; Maybe Ordering
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(a, a, (b, b))] -&gt; Maybe Ordering)
-&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Piece a (b, b)] -&gt; [(a, a, (b, b))]
forall a o. Num a =&gt; [Piece a o] -&gt; [(a, a, o)]
</span><a href="PWPs.Piecewise.html#disaggregate"><span class="hs-identifier hs-var">disaggregate</span></a></span><span> </span><span class="annot"><span class="annottext">([Piece a (b, b)] -&gt; [(a, a, (b, b))])
-&gt; [Piece a (b, b)] -&gt; [(a, a, (b, b))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pieces a (b, b) -&gt; [Piece a (b, b)]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">(Pieces a (b, b) -&gt; [Piece a (b, b)])
-&gt; Pieces a (b, b) -&gt; [Piece a (b, b)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pieces a b -&gt; Pieces a b -&gt; Pieces a (b, b)
forall a b c.
(Num a, Eq a, Ord a, Mergeable b, Mergeable c) =&gt;
Pieces a b -&gt; Pieces a c -&gt; Pieces a (b, c)
</span><a href="PWPs.Piecewise.html#alignPieces"><span class="hs-identifier hs-var">alignPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056496"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056497"><span class="hs-identifier hs-var">y'</span></a></span><span>
</span><span id="line-332"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-333"></span><span>    </span><span id="local-6989586621679055936"><span id="local-6989586621679055937"><span class="annot"><a href="#local-6989586621679056498"><span class="hs-identifier hs-type">goCompare</span></a></span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="annot"><a href="#local-6989586621679055936"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055936"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679055936"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Comparable"><span class="hs-identifier hs-type">Comparable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055936"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055937"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055936"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055936"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055937"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055937"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span></span></span><span>
</span><span id="line-338"></span><span>    </span><span id="local-6989586621679056498"><span class="annot"><span class="annottext">goCompare :: forall a b.
(Fractional a, Eq a, Ord a, Comparable a b) =&gt;
Maybe Ordering -&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
</span><a href="#local-6989586621679056498"><span class="hs-identifier hs-var hs-var">goCompare</span></a></span></span><span> </span><span id="local-6989586621679056521"><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056521"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056521"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="hs-comment">-- when the list is exhauseted, keep the last result</span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><a href="#local-6989586621679056498"><span class="hs-identifier hs-var">goCompare</span></a></span><span> </span><span id="local-6989586621679056522"><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056522"><span class="hs-identifier hs-var">prev</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679056523"><span class="annot"><span class="annottext">(a, a, (b, b))
</span><a href="#local-6989586621679056523"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679056524"><span class="annot"><span class="annottext">[(a, a, (b, b))]
</span><a href="#local-6989586621679056524"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056522"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Ordering -&gt; Maybe Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Maybe Ordering
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Ordering -&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
forall a b.
(Fractional a, Eq a, Ord a, Comparable a b) =&gt;
Maybe Ordering -&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
</span><a href="#local-6989586621679056498"><span class="hs-identifier hs-var">goCompare</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056525"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, (b, b))]
</span><a href="#local-6989586621679056524"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-comment">-- Equality is neutral</span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056525"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Ordering -&gt; Maybe Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Ordering -&gt; Maybe Ordering
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Ordering -&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
forall a b.
(Fractional a, Eq a, Ord a, Comparable a b) =&gt;
Maybe Ordering -&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
</span><a href="#local-6989586621679056498"><span class="hs-identifier hs-var">goCompare</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056522"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, (b, b))]
</span><a href="#local-6989586621679056524"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-comment">-- Equality is neutral</span><span>
</span><span id="line-342"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056522"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Ordering -&gt; Maybe Ordering -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056525"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Ordering -&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
forall a b.
(Fractional a, Eq a, Ord a, Comparable a b) =&gt;
Maybe Ordering -&gt; [(a, a, (b, b))] -&gt; Maybe Ordering
</span><a href="#local-6989586621679056498"><span class="hs-identifier hs-var">goCompare</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Ordering
</span><a href="#local-6989586621679056525"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, a, (b, b))]
</span><a href="#local-6989586621679056524"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-comment">-- The two intervals compare the same way, so carry on</span><span>
</span><span id="line-343"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Ordering
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- The two intervals compare differently, so stop</span><span>
</span><span id="line-344"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-345"></span><span>        </span><span id="local-6989586621679056525"><span class="annot"><span class="annottext">next :: Maybe Ordering
</span><a href="#local-6989586621679056525"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, a, (b, b)) -&gt; Maybe Ordering
forall a b. Comparable a b =&gt; (a, a, (b, b)) -&gt; Maybe Ordering
</span><a href="PWPs.PiecewiseClasses.html#compareObjects"><span class="hs-identifier hs-var">compareObjects</span></a></span><span> </span><span class="annot"><span class="annottext">(a, a, (b, b))
</span><a href="#local-6989586621679056523"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="annot"><span class="hs-comment">-- | Return the aggregate interval over which the pieces are not zero</span></span><span>
</span><span id="line-348"></span><span id="local-6989586621679055943"><span id="local-6989586621679055944"><span class="annot"><a href="PWPs.Piecewise.html#piecewiseSupport"><span class="hs-identifier hs-type">piecewiseSupport</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-type">Mergeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055943"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="#local-6989586621679055943"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055944"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055943"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055944"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679055944"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-349"></span><span id="piecewiseSupport"><span class="annot"><span class="annottext">piecewiseSupport :: forall b a. (Mergeable b, Eq b) =&gt; Pieces a b -&gt; (a, a)
</span><a href="PWPs.Piecewise.html#piecewiseSupport"><span class="hs-identifier hs-var hs-var">piecewiseSupport</span></a></span></span><span> </span><span id="local-6989586621679056530"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056530"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056531"><span class="hs-identifier hs-var">start</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679056532"><span class="hs-identifier hs-var">end</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-351"></span><span>    </span><span id="local-6989586621679056533"><span class="annot"><span class="annottext">xs :: [Piece a b]
</span><a href="#local-6989586621679056533"><span class="hs-identifier hs-var hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056530"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-comment">-- reduce to a list</span><span>
</span><span id="line-352"></span><span>    </span><span id="local-6989586621679056531"><span class="annot"><span class="annottext">start :: a
</span><a href="#local-6989586621679056531"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-353"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056533"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-354"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; Piece a b
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056533"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Piece a b] -&gt; Piece a b
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Piece a b -&gt; Bool) -&gt; [Piece a b] -&gt; [Piece a b]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">dropWhile</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679056544"><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056544"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; b
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span> </span><span class="annot"><span class="annottext">Piece a b
</span><a href="#local-6989586621679056544"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">b
forall a. Mergeable a =&gt; a
</span><a href="PWPs.PiecewiseClasses.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056533"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621679056532"><span class="annot"><span class="annottext">end :: a
</span><a href="#local-6989586621679056532"><span class="hs-identifier hs-var hs-var">end</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; a
forall a o. Piece a o -&gt; a
</span><a href="PWPs.Piecewise.html#basepoint"><span class="hs-identifier hs-var">basepoint</span></a></span><span> </span><span class="annot"><span class="annottext">(Piece a b -&gt; a) -&gt; Piece a b -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b] -&gt; Piece a b
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[Piece a b]
</span><a href="#local-6989586621679056533"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="annot"><span class="hs-comment">-- | Combine a single object with every object in a set of pieces</span></span><span>
</span><span id="line-359"></span><span id="local-6989586621679055948"><span id="local-6989586621679055949"><span class="annot"><a href="PWPs.Piecewise.html#applyObject"><span class="hs-identifier hs-type">applyObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679055948"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055948"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055948"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679055948"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055949"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055948"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055949"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055948"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-360"></span><span id="applyObject"><span class="annot"><span class="annottext">applyObject :: forall b a. (b -&gt; b -&gt; b) -&gt; b -&gt; Pieces a b -&gt; Pieces a b
</span><a href="PWPs.Piecewise.html#applyObject"><span class="hs-identifier hs-var hs-var">applyObject</span></a></span></span><span> </span><span id="local-6989586621679056548"><span class="annot"><span class="annottext">b -&gt; b -&gt; b
</span><a href="#local-6989586621679056548"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679056549"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056549"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; b) -&gt; Pieces a b -&gt; Pieces a b
forall a b. (a -&gt; b) -&gt; Pieces a a -&gt; Pieces a b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; b -&gt; b
</span><a href="#local-6989586621679056548"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679056549"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span id="local-6989586621679055952"><span id="local-6989586621679055954"><span class="annot"><a href="PWPs.Piecewise.html#piecewiseComplexity"><span class="hs-identifier hs-type">piecewiseComplexity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#ComplexityMeasureable"><span class="hs-identifier hs-type">ComplexityMeasureable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055952"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PWPs.Piecewise.html#Pieces"><span class="hs-identifier hs-type">Pieces</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055954"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679055952"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span></span><span>
</span><span id="line-363"></span><span id="piecewiseComplexity"><span class="annot"><span class="annottext">piecewiseComplexity :: forall b a. ComplexityMeasureable b =&gt; Pieces a b -&gt; Int
</span><a href="PWPs.Piecewise.html#piecewiseComplexity"><span class="hs-identifier hs-var hs-var">piecewiseComplexity</span></a></span></span><span> </span><span id="local-6989586621679056554"><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056554"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Piece a b -&gt; Int) -&gt; [Piece a b] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; Int
forall a. ComplexityMeasureable a =&gt; a -&gt; Int
</span><a href="PWPs.PiecewiseClasses.html#measureComplexity"><span class="hs-identifier hs-var">measureComplexity</span></a></span><span> </span><span class="annot"><span class="annottext">(b -&gt; Int) -&gt; (Piece a b -&gt; b) -&gt; Piece a b -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Piece a b -&gt; b
forall a o. Piece a o -&gt; o
</span><a href="PWPs.Piecewise.html#object"><span class="hs-identifier hs-var">object</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Piece a b] -&gt; [Int]) -&gt; [Piece a b] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pieces a b -&gt; [Piece a b]
forall a o. Pieces a o -&gt; [Piece a o]
</span><a href="PWPs.Piecewise.html#getPieces"><span class="hs-identifier hs-var">getPieces</span></a></span><span> </span><span class="annot"><span class="annottext">Pieces a b
</span><a href="#local-6989586621679056554"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-364"></span></pre></body></html>