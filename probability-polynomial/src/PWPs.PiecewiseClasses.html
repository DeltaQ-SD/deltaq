<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">{-|
Module      : Convolutionclasses
Description : Class definition for operators with testable properties
Copyright   : (c) Peter Thompson, 2024
License     : BSD-2-Clause
Maintainer  : peter.thompson@pnsol.com
Stability   : experimental

The standard algebraic classes such as semiring do not have all the operators we need.
In particular we want integration and differentiation operators that satisfy the
Fundamental Theorem of Calculus and combine appropriately with addition and multiplication.
We also want a convolution operator that behaves correctly.
-}</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html"><span class="hs-identifier">PWPs.PiecewiseClasses</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier">Integrable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier">Differentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#StepIntegrable"><span class="hs-identifier">StepIntegrable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#StepDifferentiable"><span class="hs-identifier">StepDifferentiable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier">Evaluable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#CompactConvolvable"><span class="hs-identifier">CompactConvolvable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Comparable"><span class="hs-identifier">Comparable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier">Mergeable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#Displayable"><span class="hs-identifier">Displayable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PWPs.PiecewiseClasses.html#ComplexityMeasureable"><span class="hs-identifier">ComplexityMeasureable</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">where</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">class</span><span> </span><span id="Integrable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#Integrable"><span class="hs-identifier hs-var">Integrable</span></a></span></span><span> </span><span id="local-6989586621679072005"><span class="annot"><a href="#local-6989586621679072005"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679072006"><span class="annot"><a href="#local-6989586621679072006"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-32"></span><span>    </span><span id="integrate"><span class="annot"><a href="PWPs.PiecewiseClasses.html#integrate"><span class="hs-identifier hs-type">integrate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072005"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072006"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">class</span><span> </span><span id="StepIntegrable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#StepIntegrable"><span class="hs-identifier hs-var">StepIntegrable</span></a></span></span><span> </span><span id="local-6989586621679072008"><span class="annot"><a href="#local-6989586621679072008"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679072009"><span class="annot"><a href="#local-6989586621679072009"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679072010"><span class="annot"><a href="#local-6989586621679072010"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-34"></span><span>    </span><span id="integrateStep"><span class="annot"><a href="PWPs.PiecewiseClasses.html#integrateStep"><span class="hs-identifier hs-type">integrateStep</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072009"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679072008"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679072010"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">class</span><span> </span><span id="StepDifferentiable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#StepDifferentiable"><span class="hs-identifier hs-var">StepDifferentiable</span></a></span></span><span> </span><span id="local-6989586621679072012"><span class="annot"><a href="#local-6989586621679072012"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679072013"><span class="annot"><a href="#local-6989586621679072013"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span id="local-6989586621679072014"><span class="annot"><a href="#local-6989586621679072014"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-37"></span><span>    </span><span id="differentiateStep"><span class="annot"><a href="PWPs.PiecewiseClasses.html#differentiateStep"><span class="hs-identifier hs-type">differentiateStep</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072012"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072013"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072014"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">class</span><span> </span><span id="Differentiable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#Differentiable"><span class="hs-identifier hs-var">Differentiable</span></a></span></span><span> </span><span id="local-6989586621679072016"><span class="annot"><a href="#local-6989586621679072016"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679072017"><span class="annot"><a href="#local-6989586621679072017"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-40"></span><span>    </span><span id="differentiate"><span class="annot"><a href="PWPs.PiecewiseClasses.html#differentiate"><span class="hs-identifier hs-type">differentiate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072016"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072017"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">class</span><span> </span><span id="Evaluable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#Evaluable"><span class="hs-identifier hs-var">Evaluable</span></a></span></span><span> </span><span id="local-6989586621679072019"><span class="annot"><a href="#local-6989586621679072019"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679072020"><span class="annot"><a href="#local-6989586621679072020"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-43"></span><span>    </span><span id="evaluate"><span class="annot"><a href="PWPs.PiecewiseClasses.html#evaluate"><span class="hs-identifier hs-type">evaluate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072019"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072020"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072019"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-comment">-- evaluate b at point a</span><span>
</span><span id="line-44"></span><span>    </span><span id="boost"><span class="annot"><a href="PWPs.PiecewiseClasses.html#boost"><span class="hs-identifier hs-type">boost</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072019"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072020"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072020"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-comment">-- increment b by a</span><span>
</span><span id="line-45"></span><span>    </span><span id="scale"><span class="annot"><a href="PWPs.PiecewiseClasses.html#scale"><span class="hs-identifier hs-type">scale</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072019"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072020"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072020"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-comment">-- scale b by a</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="annot"><span class="hs-comment">{-|
    Convolution in our library is over finite intervals - this is what piecewiseness needs
-}</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">class</span><span> </span><span id="CompactConvolvable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#CompactConvolvable"><span class="hs-identifier hs-var">CompactConvolvable</span></a></span></span><span> </span><span id="local-6989586621679072024"><span class="annot"><a href="#local-6989586621679072024"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679072025"><span class="annot"><a href="#local-6989586621679072025"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>    </span><span id="convolveIntervals"><span class="annot"><a href="PWPs.PiecewiseClasses.html#convolveIntervals"><span class="hs-identifier hs-type">convolveIntervals</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072024"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072024"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072025"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072024"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072024"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072025"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072024"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072025"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- convolution</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="annot"><span class="hs-comment">{-|
    We express a partial order by comparing a pair of objects on an interval, delivering a Maybe Ordering
-}</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">class</span><span> </span><span id="Comparable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#Comparable"><span class="hs-identifier hs-var">Comparable</span></a></span></span><span> </span><span id="local-6989586621679072027"><span class="annot"><a href="#local-6989586621679072027"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679072028"><span class="annot"><a href="#local-6989586621679072028"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-57"></span><span>    </span><span id="compareObjects"><span class="annot"><a href="PWPs.PiecewiseClasses.html#compareObjects"><span class="hs-identifier hs-type">compareObjects</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072027"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072027"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072028"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072028"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ordering</span></span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="annot"><span class="hs-comment">{-|
    We want to know when two objects can be merged - this is not the same as saying they are equal
    We also define a zeroObject to be used when there aren't two objects to be merged
-}</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">class</span><span> </span><span id="Mergeable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#Mergeable"><span class="hs-identifier hs-var">Mergeable</span></a></span></span><span> </span><span id="local-6989586621679072030"><span class="annot"><a href="#local-6989586621679072030"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-64"></span><span>    </span><span id="mergeObject"><span class="annot"><a href="PWPs.PiecewiseClasses.html#mergeObject"><span class="hs-identifier hs-type">mergeObject</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072030"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679072030"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679072030"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span id="zero"><span class="annot"><a href="PWPs.PiecewiseClasses.html#zero"><span class="hs-identifier hs-type">zero</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072030"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-66"></span><span>
</span><span id="line-67"></span><span class="hs-keyword">class</span><span> </span><span id="Displayable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#Displayable"><span class="hs-identifier hs-var">Displayable</span></a></span></span><span> </span><span id="local-6989586621679072033"><span class="annot"><a href="#local-6989586621679072033"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679072034"><span class="annot"><a href="#local-6989586621679072034"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-68"></span><span>    </span><span id="displayObject"><span class="annot"><a href="PWPs.PiecewiseClasses.html#displayObject"><span class="hs-identifier hs-type">displayObject</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072033"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072033"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072033"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072034"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072033"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072033"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679072033"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679072033"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-keyword">class</span><span> </span><span id="ComplexityMeasureable"><span class="annot"><a href="PWPs.PiecewiseClasses.html#ComplexityMeasureable"><span class="hs-identifier hs-var">ComplexityMeasureable</span></a></span></span><span> </span><span id="local-6989586621679072036"><span class="annot"><a href="#local-6989586621679072036"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-71"></span><span>    </span><span id="measureComplexity"><span class="annot"><a href="PWPs.PiecewiseClasses.html#measureComplexity"><span class="hs-identifier hs-type">measureComplexity</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679072036"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><span class="hs-comment">{-|
    Laws:
    Usual stuff with +, *, -
    differentiate . integrate = id              } Fundamental theorem
    integrate . differentiate = add constant    } of calculus
    times distributes over integration and differentiation
    addition distributes over everything
    convolution is commutative and associative
    differentiate (f &lt;+&gt; g) == (differentiate f) &lt;+&gt; g == f &lt;+&gt; (differentiate g)
    integrate (f &lt;+&gt; g) == (integrate f) * (integrate g)
    operations maintain ordering, if present
-}</span></span><span>
</span><span id="line-85"></span></pre></body></html>