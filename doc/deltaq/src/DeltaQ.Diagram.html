<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">{-|
Copyright   : PLWORKZ R&amp;D, 2025
License     : BSD-3-Clause
Description : Render outcome diagrams.

Render outcome expressions as outcome diagrams.
-}</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html"><span class="hs-identifier">DeltaQ.Diagram</span></a></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Outcome diagrams</span></span><span>
</span><span id="line-13"></span><span>      </span><span class="annot"><a href="DeltaQ.Diagram.html#renderOutcomeDiagram"><span class="hs-identifier">renderOutcomeDiagram</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="DeltaQ.Class.html"><span class="hs-identifier">DeltaQ.Class</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Outcome"><span class="hs-identifier">Outcome</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html"><span class="hs-identifier">DeltaQ.Expr</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier">O</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#choices%27"><span class="hs-identifier">choices'</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#isLoc"><span class="hs-identifier">isLoc</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#isSeq"><span class="hs-identifier">isSeq</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#isVar"><span class="hs-identifier">isVar</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#loc"><span class="hs-identifier">loc</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#outcomeFromTerm"><span class="hs-identifier">outcomeFromTerm</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#termFromOutcome"><span class="hs-identifier">termFromOutcome</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#var"><span class="hs-identifier">var</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Diagrams.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">First</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Last</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Loc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">op</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">loc</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Diagrams.Backend.SVG</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Printf</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">printf</span></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="annot"><a href="DeltaQ.Diagram.html#out"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span id="out"><span class="annot"><span class="annottext">out :: O -&gt; IO ()
</span><a href="DeltaQ.Diagram.html#out"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SizeSpec V2 Double -&gt; QDiagram SVG V2 Double Any -&gt; IO ()
forall n.
SVGFloat n =&gt;
String -&gt; SizeSpec V2 n -&gt; QDiagram SVG V2 n Any -&gt; IO ()
</span><span class="hs-identifier hs-var">renderSVG</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;xoutcomes.svg&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; SizeSpec V2 Double
forall n. Num n =&gt; n -&gt; SizeSpec V2 n
</span><span class="hs-identifier hs-var">mkWidth</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">700</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><span class="annottext">(QDiagram SVG V2 Double Any -&gt; IO ())
-&gt; (O -&gt; QDiagram SVG V2 Double Any) -&gt; O -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; Diagram SVG
O -&gt; QDiagram SVG V2 Double Any
</span><a href="DeltaQ.Diagram.html#renderOutcomeDiagram"><span class="hs-identifier hs-var">renderOutcomeDiagram</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="annot"><span class="hs-comment">-- | Render an outcome expression as an outcome diagram.</span></span><span>
</span><span id="line-43"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderOutcomeDiagram"><span class="hs-identifier hs-type">renderOutcomeDiagram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diagram</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span>
</span><span id="line-44"></span><span id="renderOutcomeDiagram"><span class="annot"><span class="annottext">renderOutcomeDiagram :: O -&gt; Diagram SVG
</span><a href="DeltaQ.Diagram.html#renderOutcomeDiagram"><span class="hs-identifier hs-var hs-var">renderOutcomeDiagram</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Tile] -&gt; Diagram SVG
[Tile] -&gt; QDiagram SVG V2 Double Any
</span><a href="DeltaQ.Diagram.html#renderTiles"><span class="hs-identifier hs-var">renderTiles</span></a></span><span> </span><span class="annot"><span class="annottext">([Tile] -&gt; QDiagram SVG V2 Double Any)
-&gt; (O -&gt; [Tile]) -&gt; O -&gt; QDiagram SVG V2 Double Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; [Tile]
</span><a href="DeltaQ.Diagram.html#layout"><span class="hs-identifier hs-var">layout</span></a></span><span> </span><span class="annot"><span class="annottext">(Term String -&gt; [Tile]) -&gt; (O -&gt; Term String) -&gt; O -&gt; [Tile]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; Term String
</span><a href="DeltaQ.Expr.html#termFromOutcome"><span class="hs-identifier hs-var">termFromOutcome</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Diagram rendering
------------------------------------------------------------------------------}</span><span>
</span><span id="line-49"></span><span class="hs-keyword">type</span><span> </span><span id="X"><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-var">X</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">type</span><span> </span><span id="Y"><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-var">Y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">type</span><span> </span><span id="Prob"><span class="annot"><a href="DeltaQ.Diagram.html#Prob"><span class="hs-identifier hs-var">Prob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">type</span><span> </span><span id="Description"><span class="annot"><a href="DeltaQ.Diagram.html#Description"><span class="hs-identifier hs-var">Description</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="Op"><span class="annot"><a href="DeltaQ.Diagram.html#Op"><span class="hs-identifier hs-var">Op</span></a></span></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="OFirst"><span class="annot"><a href="DeltaQ.Diagram.html#OFirst"><span class="hs-identifier hs-var">OFirst</span></a></span></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="OLast"><span class="annot"><a href="DeltaQ.Diagram.html#OLast"><span class="hs-identifier hs-var">OLast</span></a></span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="OChoices"><span class="annot"><a href="DeltaQ.Diagram.html#OChoices"><span class="hs-identifier hs-var">OChoices</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Prob"><span class="hs-identifier hs-type">Prob</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159567"><span id="local-6989586621679159575"><span class="annot"><span class="annottext">Op -&gt; Op -&gt; Bool
(Op -&gt; Op -&gt; Bool) -&gt; (Op -&gt; Op -&gt; Bool) -&gt; Eq Op
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Op -&gt; Op -&gt; Bool
== :: Op -&gt; Op -&gt; Bool
$c/= :: Op -&gt; Op -&gt; Bool
/= :: Op -&gt; Op -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159585"><span id="local-6989586621679159589"><span id="local-6989586621679159592"><span id="local-6989586621679159596"><span id="local-6989586621679159599"><span id="local-6989586621679159602"><span id="local-6989586621679159605"><span class="annot"><span class="annottext">Eq Op
Eq Op =&gt;
(Op -&gt; Op -&gt; Ordering)
-&gt; (Op -&gt; Op -&gt; Bool)
-&gt; (Op -&gt; Op -&gt; Bool)
-&gt; (Op -&gt; Op -&gt; Bool)
-&gt; (Op -&gt; Op -&gt; Bool)
-&gt; (Op -&gt; Op -&gt; Op)
-&gt; (Op -&gt; Op -&gt; Op)
-&gt; Ord Op
Op -&gt; Op -&gt; Bool
Op -&gt; Op -&gt; Ordering
Op -&gt; Op -&gt; Op
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Op -&gt; Op -&gt; Ordering
compare :: Op -&gt; Op -&gt; Ordering
$c&lt; :: Op -&gt; Op -&gt; Bool
&lt; :: Op -&gt; Op -&gt; Bool
$c&lt;= :: Op -&gt; Op -&gt; Bool
&lt;= :: Op -&gt; Op -&gt; Bool
$c&gt; :: Op -&gt; Op -&gt; Bool
&gt; :: Op -&gt; Op -&gt; Bool
$c&gt;= :: Op -&gt; Op -&gt; Bool
&gt;= :: Op -&gt; Op -&gt; Bool
$cmax :: Op -&gt; Op -&gt; Op
max :: Op -&gt; Op -&gt; Op
$cmin :: Op -&gt; Op -&gt; Op
min :: Op -&gt; Op -&gt; Op
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159613"><span id="local-6989586621679159620"><span id="local-6989586621679159624"><span class="annot"><span class="annottext">Y -&gt; Op -&gt; ShowS
[Op] -&gt; ShowS
Op -&gt; String
(Y -&gt; Op -&gt; ShowS) -&gt; (Op -&gt; String) -&gt; ([Op] -&gt; ShowS) -&gt; Show Op
forall a.
(Y -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Y -&gt; Op -&gt; ShowS
showsPrec :: Y -&gt; Op -&gt; ShowS
$cshow :: Op -&gt; String
show :: Op -&gt; String
$cshowList :: [Op] -&gt; ShowS
showList :: [Op] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="annot"><span class="hs-comment">-- | Data attached to a 'Tile'.</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">data</span><span> </span><span id="Token"><span class="annot"><a href="DeltaQ.Diagram.html#Token"><span class="hs-identifier hs-var">Token</span></a></span></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="VarT"><span class="annot"><a href="DeltaQ.Diagram.html#VarT"><span class="hs-identifier hs-var">VarT</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Location"><span class="annot"><a href="DeltaQ.Diagram.html#Location"><span class="hs-identifier hs-var">Location</span></a></span></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Description"><span class="hs-identifier hs-type">Description</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Horizontal"><span class="annot"><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Close"><span class="annot"><a href="DeltaQ.Diagram.html#Close"><span class="hs-identifier hs-var">Close</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Description"><span class="hs-identifier hs-type">Description</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-type">Y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Open"><span class="annot"><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-var">Open</span></a></span></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-type">Y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159638"><span id="local-6989586621679159651"><span class="annot"><span class="annottext">Token -&gt; Token -&gt; Bool
(Token -&gt; Token -&gt; Bool) -&gt; (Token -&gt; Token -&gt; Bool) -&gt; Eq Token
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Token -&gt; Token -&gt; Bool
== :: Token -&gt; Token -&gt; Bool
$c/= :: Token -&gt; Token -&gt; Bool
/= :: Token -&gt; Token -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159659"><span id="local-6989586621679159671"><span id="local-6989586621679159675"><span id="local-6989586621679159678"><span id="local-6989586621679159681"><span id="local-6989586621679159684"><span id="local-6989586621679159687"><span class="annot"><span class="annottext">Eq Token
Eq Token =&gt;
(Token -&gt; Token -&gt; Ordering)
-&gt; (Token -&gt; Token -&gt; Bool)
-&gt; (Token -&gt; Token -&gt; Bool)
-&gt; (Token -&gt; Token -&gt; Bool)
-&gt; (Token -&gt; Token -&gt; Bool)
-&gt; (Token -&gt; Token -&gt; Token)
-&gt; (Token -&gt; Token -&gt; Token)
-&gt; Ord Token
Token -&gt; Token -&gt; Bool
Token -&gt; Token -&gt; Ordering
Token -&gt; Token -&gt; Token
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Token -&gt; Token -&gt; Ordering
compare :: Token -&gt; Token -&gt; Ordering
$c&lt; :: Token -&gt; Token -&gt; Bool
&lt; :: Token -&gt; Token -&gt; Bool
$c&lt;= :: Token -&gt; Token -&gt; Bool
&lt;= :: Token -&gt; Token -&gt; Bool
$c&gt; :: Token -&gt; Token -&gt; Bool
&gt; :: Token -&gt; Token -&gt; Bool
$c&gt;= :: Token -&gt; Token -&gt; Bool
&gt;= :: Token -&gt; Token -&gt; Bool
$cmax :: Token -&gt; Token -&gt; Token
max :: Token -&gt; Token -&gt; Token
$cmin :: Token -&gt; Token -&gt; Token
min :: Token -&gt; Token -&gt; Token
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159691"><span id="local-6989586621679159706"><span id="local-6989586621679159710"><span class="annot"><span class="annottext">Y -&gt; Token -&gt; ShowS
[Token] -&gt; ShowS
Token -&gt; String
(Y -&gt; Token -&gt; ShowS)
-&gt; (Token -&gt; String) -&gt; ([Token] -&gt; ShowS) -&gt; Show Token
forall a.
(Y -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Y -&gt; Token -&gt; ShowS
showsPrec :: Y -&gt; Token -&gt; ShowS
$cshow :: Token -&gt; String
show :: Token -&gt; String
$cshowList :: [Token] -&gt; ShowS
showList :: [Token] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">data</span><span> </span><span id="Tile"><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Tile"><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-type">Y</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679159715"><span id="local-6989586621679159720"><span class="annot"><span class="annottext">Tile -&gt; Tile -&gt; Bool
(Tile -&gt; Tile -&gt; Bool) -&gt; (Tile -&gt; Tile -&gt; Bool) -&gt; Eq Tile
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Tile -&gt; Tile -&gt; Bool
== :: Tile -&gt; Tile -&gt; Bool
$c/= :: Tile -&gt; Tile -&gt; Bool
/= :: Tile -&gt; Tile -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159726"><span id="local-6989586621679159731"><span id="local-6989586621679159736"><span id="local-6989586621679159740"><span id="local-6989586621679159743"><span id="local-6989586621679159746"><span id="local-6989586621679159749"><span class="annot"><span class="annottext">Eq Tile
Eq Tile =&gt;
(Tile -&gt; Tile -&gt; Ordering)
-&gt; (Tile -&gt; Tile -&gt; Bool)
-&gt; (Tile -&gt; Tile -&gt; Bool)
-&gt; (Tile -&gt; Tile -&gt; Bool)
-&gt; (Tile -&gt; Tile -&gt; Bool)
-&gt; (Tile -&gt; Tile -&gt; Tile)
-&gt; (Tile -&gt; Tile -&gt; Tile)
-&gt; Ord Tile
Tile -&gt; Tile -&gt; Bool
Tile -&gt; Tile -&gt; Ordering
Tile -&gt; Tile -&gt; Tile
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Tile -&gt; Tile -&gt; Ordering
compare :: Tile -&gt; Tile -&gt; Ordering
$c&lt; :: Tile -&gt; Tile -&gt; Bool
&lt; :: Tile -&gt; Tile -&gt; Bool
$c&lt;= :: Tile -&gt; Tile -&gt; Bool
&lt;= :: Tile -&gt; Tile -&gt; Bool
$c&gt; :: Tile -&gt; Tile -&gt; Bool
&gt; :: Tile -&gt; Tile -&gt; Bool
$c&gt;= :: Tile -&gt; Tile -&gt; Bool
&gt;= :: Tile -&gt; Tile -&gt; Bool
$cmax :: Tile -&gt; Tile -&gt; Tile
max :: Tile -&gt; Tile -&gt; Tile
$cmin :: Tile -&gt; Tile -&gt; Tile
min :: Tile -&gt; Tile -&gt; Tile
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679159752"><span id="local-6989586621679159758"><span id="local-6989586621679159762"><span class="annot"><span class="annottext">Y -&gt; Tile -&gt; ShowS
[Tile] -&gt; ShowS
Tile -&gt; String
(Y -&gt; Tile -&gt; ShowS)
-&gt; (Tile -&gt; String) -&gt; ([Tile] -&gt; ShowS) -&gt; Show Tile
forall a.
(Y -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Y -&gt; Tile -&gt; ShowS
showsPrec :: Y -&gt; Tile -&gt; ShowS
$cshow :: Tile -&gt; String
show :: Tile -&gt; String
$cshowList :: [Tile] -&gt; ShowS
showList :: [Tile] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="annot"><span class="hs-comment">-- | Render a collection of tiles.</span></span><span>
</span><span id="line-73"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderTiles"><span class="hs-identifier hs-type">renderTiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diagram</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span>
</span><span id="line-74"></span><span id="renderTiles"><span class="annot"><span class="annottext">renderTiles :: [Tile] -&gt; Diagram SVG
</span><a href="DeltaQ.Diagram.html#renderTiles"><span class="hs-identifier hs-var hs-var">renderTiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall (v :: * -&gt; *) n m b.
(Metric v, OrderedField n, Monoid' m) =&gt;
n -&gt; QDiagram b v n m -&gt; QDiagram b v n m
</span><span class="hs-identifier hs-var">frame</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span> </span><span class="annot"><span class="annottext">(QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; ([Tile] -&gt; QDiagram SVG V2 Double Any)
-&gt; [Tile]
-&gt; QDiagram SVG V2 Double Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Point V2 Double, QDiagram SVG V2 Double Any)]
-&gt; QDiagram SVG V2 Double Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, HasOrigin a, Monoid' a) =&gt;
[(Point v n, a)] -&gt; a
</span><span class="hs-identifier hs-var">position</span></span><span> </span><span class="annot"><span class="annottext">([(Point V2 Double, QDiagram SVG V2 Double Any)]
 -&gt; QDiagram SVG V2 Double Any)
-&gt; ([Tile] -&gt; [(Point V2 Double, QDiagram SVG V2 Double Any)])
-&gt; [Tile]
-&gt; QDiagram SVG V2 Double Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Tile -&gt; (Point V2 Double, QDiagram SVG V2 Double Any))
-&gt; [Tile] -&gt; [(Point V2 Double, QDiagram SVG V2 Double Any)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Tile -&gt; (Point V2 Double, QDiagram SVG V2 Double Any)
forall {n}. Num n =&gt; Tile -&gt; (P2 n, QDiagram SVG V2 Double Any)
</span><a href="#local-6989586621679159766"><span class="hs-identifier hs-var">renderTile</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-76"></span><span>    </span><span id="local-6989586621679159766"><span class="annot"><span class="annottext">renderTile :: Tile -&gt; (P2 n, QDiagram SVG V2 Double Any)
</span><a href="#local-6989586621679159766"><span class="hs-identifier hs-var hs-var">renderTile</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span> </span><span id="local-6989586621679159773"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679159773"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679159774"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679159774"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679159775"><span class="annot"><span class="annottext">Token
</span><a href="#local-6989586621679159775"><span class="hs-identifier hs-var">token</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-77"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y -&gt; n
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679159773"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n -&gt; n
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; n) -&gt; n -&gt; n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Y -&gt; n
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679159774"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Diagram SVG
</span><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="#local-6989586621679159775"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="annot"><span class="hs-comment">-- | Render a single 'Token' associated with a 'Tile'.</span></span><span>
</span><span id="line-82"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-type">renderToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diagram</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span>
</span><span id="line-83"></span><span id="renderToken"><span class="annot"><span class="annottext">renderToken :: Token -&gt; Diagram SVG
</span><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var hs-var">renderToken</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#VarT"><span class="hs-identifier hs-type">VarT</span></a></span><span> </span><span id="local-6989586621679159778"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159778"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, Eq n, Fractional n, Transformable a) =&gt;
n -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">scale</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Text n) b) =&gt;
String -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159778"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall t n.
(TrailLike t, V t ~ V2, N t ~ n, Transformable t) =&gt;
n -&gt; t
</span><span class="hs-identifier hs-var">circle</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.44</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall n a.
(InSpace V2 n a, Typeable n, Floating n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">lc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">orange</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Measure Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a n.
(N a ~ n, HasStyle a, Typeable n) =&gt;
Measure n -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">lw</span></span><span> </span><span class="annot"><span class="annottext">Measure Double
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall n a.
(InSpace V2 n a, Floating n, Typeable n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">fc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">white</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">hrule</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-87"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Location"><span class="hs-identifier hs-type">Location</span></a></span><span> </span><span id="local-6989586621679159789"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159789"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, Eq n, Fractional n, Transformable a) =&gt;
n -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">scale</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Text n) b) =&gt;
String -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679159789"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall n a.
(InSpace V2 n a, Floating n, Typeable n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">fc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">teal</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Vn (QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall t. Transformable t =&gt; Vn t -&gt; t -&gt; t
</span><span class="hs-identifier hs-var">translate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">square</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.2</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall n a.
(InSpace V2 n a, Floating n, Typeable n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">fc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">white</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">hrule</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-91"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">hrule</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-92"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span> </span><span id="local-6989586621679159794"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679159794"><span class="hs-identifier hs-var">mlocation</span></a></span></span><span> </span><span id="local-6989586621679159795"><span class="annot"><span class="annottext">[Y]
</span><a href="#local-6989586621679159795"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (String -&gt; QDiagram SVG V2 Double Any)
-&gt; Maybe String
-&gt; QDiagram SVG V2 Double Any
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Token -&gt; Diagram SVG
Token -&gt; QDiagram SVG V2 Double Any
</span><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; QDiagram SVG V2 Double Any)
-&gt; (String -&gt; Token) -&gt; String -&gt; QDiagram SVG V2 Double Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Token
</span><a href="DeltaQ.Diagram.html#Location"><span class="hs-identifier hs-var">Location</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679159794"><span class="hs-identifier hs-var">mlocation</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[QDiagram SVG V2 Double Any] -&gt; QDiagram SVG V2 Double Any
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Y -&gt; QDiagram SVG V2 Double Any)
-&gt; [Y] -&gt; [QDiagram SVG V2 Double Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall {n} {b}.
(Typeable n, RealFloat n, Renderable (Path V2 n) b) =&gt;
n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679159797"><span class="hs-identifier hs-var">renderLine</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; QDiagram SVG V2 Double Any)
-&gt; (Y -&gt; Double) -&gt; Y -&gt; QDiagram SVG V2 Double Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Y -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Y -&gt; Double) -&gt; (Y -&gt; Y) -&gt; Y -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Y]
</span><a href="#local-6989586621679159795"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">hrule</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-97"></span><span>    </span><span id="local-6989586621679159797"><span class="annot"><span class="annottext">renderLine :: n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679159797"><span class="hs-identifier hs-var hs-var">renderLine</span></a></span></span><span> </span><span id="local-6989586621679159853"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679159853"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point (V (Trail' Line V2 n)) (N (Trail' Line V2 n))]
-&gt; Trail' Line V2 n
forall t. TrailLike t =&gt; [Point (V t) (N t)] -&gt; t
</span><span class="hs-identifier hs-var">fromVertices</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679159853"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 n
-&gt; (Trail' Line V2 n -&gt; QDiagram b V2 n Any) -&gt; QDiagram b V2 n Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 n -&gt; QDiagram b V2 n Any
forall n b.
(TypeableFloat n, Renderable (Path V2 n) b) =&gt;
Trail' Line V2 n -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">strokeLine</span></span><span>
</span><span id="line-98"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span> </span><span id="local-6989586621679159856"><span class="annot"><span class="annottext">Op
</span><a href="#local-6989586621679159856"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679159857"><span class="annot"><span class="annottext">[Y]
</span><a href="#local-6989586621679159857"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, Eq n, Fractional n, Transformable a) =&gt;
n -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">scale</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Op -&gt; Diagram SVG
</span><a href="#local-6989586621679159858"><span class="hs-identifier hs-var">renderOp</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="#local-6989586621679159856"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">square</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall n a.
(InSpace V2 n a, Floating n, Typeable n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">fc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">white</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[QDiagram SVG V2 Double Any] -&gt; QDiagram SVG V2 Double Any
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double -&gt; QDiagram SVG V2 Double Any)
-&gt; [Double] -&gt; [QDiagram SVG V2 Double Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall {n} {b}.
(Typeable n, RealFloat n, Renderable (Path V2 n) b) =&gt;
n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679159859"><span class="hs-identifier hs-var">renderLine</span></a></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679159860"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[QDiagram SVG V2 Double Any] -&gt; QDiagram SVG V2 Double Any
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Op -&gt; [Double] -&gt; [QDiagram SVG V2 Double Any]
forall {b} {b}.
(Typeable b, RealFloat b, Renderable (Text b) b) =&gt;
Op -&gt; [b] -&gt; [QDiagram b V2 b Any]
</span><a href="#local-6989586621679159861"><span class="hs-identifier hs-var">renderLineAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="#local-6989586621679159856"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679159860"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">hrule</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>    </span><span id="local-6989586621679159860"><span class="annot"><span class="annottext">ys :: [Double]
</span><a href="#local-6989586621679159860"><span class="hs-identifier hs-var hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Y -&gt; Double) -&gt; [Y] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Y -&gt; Double) -&gt; (Y -&gt; Y) -&gt; Y -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Y]
</span><a href="#local-6989586621679159857"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="#local-6989586621679159858"><span class="hs-identifier hs-type">renderOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diagram</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679159858"><span class="annot"><span class="annottext">renderOp :: Op -&gt; Diagram SVG
</span><a href="#local-6989586621679159858"><span class="hs-identifier hs-var hs-var">renderOp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="DeltaQ.Diagram.html#OFirst"><span class="hs-identifier hs-var">OFirst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Text n) b) =&gt;
String -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&#8707;&quot;</span></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="#local-6989586621679159858"><span class="hs-identifier hs-var">renderOp</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="DeltaQ.Diagram.html#OLast"><span class="hs-identifier hs-var">OLast</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Text n) b) =&gt;
String -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&#8704;&quot;</span></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="#local-6989586621679159858"><span class="hs-identifier hs-var">renderOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#OChoices"><span class="hs-identifier hs-type">OChoices</span></a></span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Vn (Trail' Line V2 Double)] -&gt; Trail' Line V2 Double
forall t. TrailLike t =&gt; [Vn t] -&gt; t
</span><span class="hs-identifier hs-var">fromOffsets</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.33</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.15</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span>            </span><span class="annot"><span class="annottext">Trail' Line V2 Double
-&gt; (Trail' Line V2 Double -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 Double -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Path V2 n) b) =&gt;
Trail' Line V2 n -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">strokeLine</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Vn (QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall t. Transformable t =&gt; Vn t -&gt; t -&gt; t
</span><span class="hs-identifier hs-var">translate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-113"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Vn (Trail' Line V2 Double)] -&gt; Trail' Line V2 Double
forall t. TrailLike t =&gt; [Vn t] -&gt; t
</span><span class="hs-identifier hs-var">fromOffsets</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.33</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.2</span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.15</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span>            </span><span class="annot"><span class="annottext">Trail' Line V2 Double
-&gt; (Trail' Line V2 Double -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 Double -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Path V2 n) b) =&gt;
Trail' Line V2 n -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">strokeLine</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Vn (QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall t. Transformable t =&gt; Vn t -&gt; t -&gt; t
</span><span class="hs-identifier hs-var">translate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679159859"><span class="annot"><span class="annottext">renderLine :: n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679159859"><span class="hs-identifier hs-var hs-var">renderLine</span></a></span></span><span> </span><span id="local-6989586621679159910"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679159910"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point (V (Trail' Line V2 n)) (N (Trail' Line V2 n))]
-&gt; Trail' Line V2 n
forall t. TrailLike t =&gt; [Point (V t) (N t)] -&gt; t
</span><span class="hs-identifier hs-var">fromVertices</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679159910"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 n
-&gt; (Trail' Line V2 n -&gt; QDiagram b V2 n Any) -&gt; QDiagram b V2 n Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 n -&gt; QDiagram b V2 n Any
forall n b.
(TypeableFloat n, Renderable (Path V2 n) b) =&gt;
Trail' Line V2 n -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">strokeLine</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span>    </span><span id="local-6989586621679159861"><span class="annot"><span class="annottext">renderLineAnnotations :: Op -&gt; [b] -&gt; [QDiagram b V2 b Any]
</span><a href="#local-6989586621679159861"><span class="hs-identifier hs-var hs-var">renderLineAnnotations</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#OChoices"><span class="hs-identifier hs-type">OChoices</span></a></span><span> </span><span id="local-6989586621679159937"><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679159937"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679159938"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679159938"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-119"></span><span>        </span><span class="annot"><span class="annottext">(Rational -&gt; b -&gt; QDiagram b V2 b Any)
-&gt; [Rational] -&gt; [b] -&gt; [QDiagram b V2 b Any]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; b -&gt; QDiagram b V2 b Any
forall {n} {b}.
(Typeable n, RealFloat n, Renderable (Text n) b) =&gt;
Rational -&gt; n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679159940"><span class="hs-identifier hs-var">renderLineAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679159941"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679159938"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-120"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621679159941"><span class="annot"><span class="annottext">ps :: [Rational]
</span><a href="#local-6989586621679159941"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Rational) -&gt; [Rational] -&gt; [Rational]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">[Rational] -&gt; Rational
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679159937"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679159937"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="#local-6989586621679159861"><span class="hs-identifier hs-var">renderLineAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679159960"><span class="annot"><span class="annottext">posLineAnnotation :: p -&gt; n -&gt; P2 n
</span><a href="#local-6989586621679159960"><span class="hs-identifier hs-var hs-var">posLineAnnotation</span></a></span></span><span> </span><span id="local-6989586621679159961"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679159961"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.3</span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><a href="#local-6989586621679159960"><span class="hs-identifier hs-var">posLineAnnotation</span></a></span><span> </span><span id="local-6989586621679159962"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679159962"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679159963"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679159963"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.1</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; n -&gt; n
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679159963"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>    </span><span id="local-6989586621679159940"><span class="annot"><span class="annottext">renderLineAnnotation :: Rational -&gt; n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679159940"><span class="hs-identifier hs-var hs-var">renderLineAnnotation</span></a></span></span><span> </span><span id="local-6989586621679160031"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679160031"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679160032"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679160032"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">[(Point V2 n, QDiagram b V2 n Any)] -&gt; QDiagram b V2 n Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, HasOrigin a, Monoid' a) =&gt;
[(Point v n, a)] -&gt; a
</span><span class="hs-identifier hs-var">position</span></span><span>
</span><span id="line-128"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational -&gt; n -&gt; Point V2 n
forall {n} {p}. (Eq n, Fractional n) =&gt; p -&gt; n -&gt; P2 n
</span><a href="#local-6989586621679159960"><span class="hs-identifier hs-var">posLineAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679160031"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679160032"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n -&gt; QDiagram b V2 n Any -&gt; QDiagram b V2 n Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, Eq n, Fractional n, Transformable a) =&gt;
n -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">scale</span></span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; QDiagram b V2 n Any
forall n b.
(TypeableFloat n, Renderable (Text n) b) =&gt;
String -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; QDiagram b V2 n Any) -&gt; String -&gt; QDiagram b V2 n Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; String
</span><a href="DeltaQ.Diagram.html#showProb"><span class="hs-identifier hs-var">showProb</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679160031"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QDiagram b V2 n Any
-&gt; (QDiagram b V2 n Any -&gt; QDiagram b V2 n Any)
-&gt; QDiagram b V2 n Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double -&gt; QDiagram b V2 n Any -&gt; QDiagram b V2 n Any
forall n a.
(InSpace V2 n a, Floating n, Typeable n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">fc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">teal</span></span><span>
</span><span id="line-130"></span><span>            </span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span class="annot"><span class="hs-comment">-- | Show a probability in scientific notation with two digits of precision.</span></span><span>
</span><span id="line-133"></span><span class="annot"><a href="DeltaQ.Diagram.html#showProb"><span class="hs-identifier hs-type">showProb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-134"></span><span id="showProb"><span class="annot"><span class="annottext">showProb :: Rational -&gt; String
</span><a href="DeltaQ.Diagram.html#showProb"><span class="hs-identifier hs-var hs-var">showProb</span></a></span></span><span> </span><span id="local-6989586621679160034"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679160034"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679160034"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">0.01</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Double -&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;%.2f&quot;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679160035"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Double -&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;%.2e\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679160035"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-138"></span><span>    </span><span id="local-6989586621679160035"><span class="annot"><span class="annottext">x :: Double
</span><a href="#local-6989586621679160035"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679160034"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Diagram Layout
------------------------------------------------------------------------------}</span><span>
</span><span id="line-143"></span><span class="hs-comment">{- Note [LayoutComputation]

In order to compute the layout for an outcome diagram,
we use a data structure called 'Shrub', which is a tree with labels
on the edges (as opposed to on the leaves).
The 'Shrub' represents the data that we still need to layout,
we think of the leaves as being located to the left,
and the root to the right, like this:

 leaf
 o----
      \
       o----o----o root
      /
 o----

-}</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="annot"><span class="hs-comment">-- | Outcome-related data that we associate with an edge.</span></span><span>
</span><span id="line-162"></span><span class="hs-keyword">data</span><span> </span><span id="EdgeOutcome"><span class="annot"><a href="DeltaQ.Diagram.html#EdgeOutcome"><span class="hs-identifier hs-var">EdgeOutcome</span></a></span></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Empty"><span class="annot"><a href="DeltaQ.Diagram.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span></span><span>
</span><span id="line-164"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ No outcome is associated with this edge.</span></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Term"><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-var">Term</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Description"><span class="hs-identifier hs-type">Description</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="hs-comment">-- ^ Term with maybe a description of its ending observation location.</span></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160040"><span id="local-6989586621679160048"><span class="annot"><span class="annottext">EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
(EdgeOutcome -&gt; EdgeOutcome -&gt; Bool)
-&gt; (EdgeOutcome -&gt; EdgeOutcome -&gt; Bool) -&gt; Eq EdgeOutcome
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
== :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
$c/= :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
/= :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160055"><span id="local-6989586621679160061"><span id="local-6989586621679160066"><span id="local-6989586621679160070"><span id="local-6989586621679160073"><span id="local-6989586621679160076"><span id="local-6989586621679160079"><span class="annot"><span class="annottext">Eq EdgeOutcome
Eq EdgeOutcome =&gt;
(EdgeOutcome -&gt; EdgeOutcome -&gt; Ordering)
-&gt; (EdgeOutcome -&gt; EdgeOutcome -&gt; Bool)
-&gt; (EdgeOutcome -&gt; EdgeOutcome -&gt; Bool)
-&gt; (EdgeOutcome -&gt; EdgeOutcome -&gt; Bool)
-&gt; (EdgeOutcome -&gt; EdgeOutcome -&gt; Bool)
-&gt; (EdgeOutcome -&gt; EdgeOutcome -&gt; EdgeOutcome)
-&gt; (EdgeOutcome -&gt; EdgeOutcome -&gt; EdgeOutcome)
-&gt; Ord EdgeOutcome
EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
EdgeOutcome -&gt; EdgeOutcome -&gt; Ordering
EdgeOutcome -&gt; EdgeOutcome -&gt; EdgeOutcome
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: EdgeOutcome -&gt; EdgeOutcome -&gt; Ordering
compare :: EdgeOutcome -&gt; EdgeOutcome -&gt; Ordering
$c&lt; :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
&lt; :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
$c&lt;= :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
&lt;= :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
$c&gt; :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
&gt; :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
$c&gt;= :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
&gt;= :: EdgeOutcome -&gt; EdgeOutcome -&gt; Bool
$cmax :: EdgeOutcome -&gt; EdgeOutcome -&gt; EdgeOutcome
max :: EdgeOutcome -&gt; EdgeOutcome -&gt; EdgeOutcome
$cmin :: EdgeOutcome -&gt; EdgeOutcome -&gt; EdgeOutcome
min :: EdgeOutcome -&gt; EdgeOutcome -&gt; EdgeOutcome
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160084"><span id="local-6989586621679160091"><span id="local-6989586621679160095"><span class="annot"><span class="annottext">Y -&gt; EdgeOutcome -&gt; ShowS
[EdgeOutcome] -&gt; ShowS
EdgeOutcome -&gt; String
(Y -&gt; EdgeOutcome -&gt; ShowS)
-&gt; (EdgeOutcome -&gt; String)
-&gt; ([EdgeOutcome] -&gt; ShowS)
-&gt; Show EdgeOutcome
forall a.
(Y -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Y -&gt; EdgeOutcome -&gt; ShowS
showsPrec :: Y -&gt; EdgeOutcome -&gt; ShowS
$cshow :: EdgeOutcome -&gt; String
show :: EdgeOutcome -&gt; String
$cshowList :: [EdgeOutcome] -&gt; ShowS
showList :: [EdgeOutcome] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">type</span><span> </span><span id="EdgeData"><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-var">EdgeData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-type">Y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeOutcome"><span class="hs-identifier hs-type">EdgeOutcome</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="annot"><span class="hs-comment">-- | Layout an outcome diagram.</span></span><span>
</span><span id="line-172"></span><span class="annot"><a href="DeltaQ.Diagram.html#layout"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-173"></span><span id="layout"><span class="annot"><span class="annottext">layout :: Term String -&gt; [Tile]
</span><a href="DeltaQ.Diagram.html#layout"><span class="hs-identifier hs-var hs-var">layout</span></a></span></span><span> </span><span id="local-6989586621679160098"><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160098"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Shrub EdgeData -&gt; [Tile]
</span><a href="#local-6989586621679160099"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; [Tile]) -&gt; Shrub EdgeData -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Maybe String -&gt; EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160098"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621679160099"><span class="annot"><span class="annottext">go :: Y -&gt; Shrub EdgeData -&gt; [Tile]
</span><a href="#local-6989586621679160099"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679160103"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">x0</span></a></span></span><span> </span><span id="local-6989586621679160104"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160104"><span class="hs-identifier hs-var">s0</span></a></span></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160104"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Tile]
</span><a href="#local-6989586621679160106"><span class="hs-identifier hs-var">tiles</span></a></span><span> </span><span class="annot"><span class="annottext">[Tile] -&gt; [Tile] -&gt; [Tile]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Y -&gt; Shrub EdgeData -&gt; [Tile]
</span><a href="#local-6989586621679160099"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160108"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-178"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679160106"><span class="annot"><span class="annottext">[Tile]
</span><a href="#local-6989586621679160106"><span class="hs-identifier hs-var">tiles</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160108"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160108"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitColumn"><span class="hs-identifier hs-var">emitColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160104"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-180"></span><span>        </span><span id="local-6989586621679160107"><span class="annot"><span class="annottext">x1 :: Y
</span><a href="#local-6989586621679160107"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Tile] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Tile]
</span><a href="#local-6989586621679160106"><span class="hs-identifier hs-var">tiles</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160103"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Y
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Y
</span><span class="hs-number">1</span></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="annot"><span class="hs-comment">-- | Emit the next column, possible empty.</span></span><span>
</span><span id="line-183"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitColumn"><span class="hs-identifier hs-type">emitColumn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span id="emitColumn"><span class="annot"><span class="annottext">emitColumn :: Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitColumn"><span class="hs-identifier hs-var hs-var">emitColumn</span></a></span></span><span> </span><span id="local-6989586621679160114"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160114"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679160115"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term String -&gt; Bool) -&gt; EdgeData -&gt; Bool
forall {a}. (Term String -&gt; Bool) -&gt; (a, EdgeOutcome) -&gt; Bool
</span><a href="#local-6989586621679160117"><span class="hs-identifier hs-var">onExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Expr.html#isSeq"><span class="hs-identifier hs-var">isSeq</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#expandSeq"><span class="hs-identifier hs-var">expandSeq</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#hasIsolatedTwigs"><span class="hs-identifier hs-var">hasIsolatedTwigs</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-var">dropIsolatedTwigs</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#hasGroupClose"><span class="hs-identifier hs-var">hasGroupClose</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitGroupClose"><span class="hs-identifier hs-var">emitGroupClose</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160114"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term String -&gt; Bool) -&gt; EdgeData -&gt; Bool
forall {a}. (Term String -&gt; Bool) -&gt; (a, EdgeOutcome) -&gt; Bool
</span><a href="#local-6989586621679160117"><span class="hs-identifier hs-var">onExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var">isVertical</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitVertical"><span class="hs-identifier hs-var">emitVertical</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160114"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term String -&gt; Bool) -&gt; EdgeData -&gt; Bool
forall {a}. (Term String -&gt; Bool) -&gt; (a, EdgeOutcome) -&gt; Bool
</span><a href="#local-6989586621679160117"><span class="hs-identifier hs-var">onExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Expr.html#isLoc"><span class="hs-identifier hs-var">isLoc</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitLoc"><span class="hs-identifier hs-var">emitLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160114"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term String -&gt; Bool) -&gt; EdgeData -&gt; Bool
forall {a}. (Term String -&gt; Bool) -&gt; (a, EdgeOutcome) -&gt; Bool
</span><a href="#local-6989586621679160117"><span class="hs-identifier hs-var">onExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Expr.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitVar"><span class="hs-identifier hs-var">emitVar</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160114"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160115"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ([Tile], Shrub EdgeData)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;emitColumn: unreachable&quot;</span></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621679160117"><span class="annot"><span class="annottext">onExpr :: (Term String -&gt; Bool) -&gt; (a, EdgeOutcome) -&gt; Bool
</span><a href="#local-6989586621679160117"><span class="hs-identifier hs-var hs-var">onExpr</span></a></span></span><span> </span><span id="local-6989586621679160129"><span class="annot"><span class="annottext">Term String -&gt; Bool
</span><a href="#local-6989586621679160129"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span id="local-6989586621679160130"><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160130"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
</span><a href="#local-6989586621679160129"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160130"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><a href="#local-6989586621679160117"><span class="hs-identifier hs-var">onExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(a, EdgeOutcome)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><span class="hs-comment">-- | Check that a given 'EdgeData' contains no outcome-related data.</span></span><span>
</span><span id="line-197"></span><span class="annot"><a href="DeltaQ.Diagram.html#isEmpty"><span class="hs-identifier hs-type">isEmpty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-198"></span><span id="isEmpty"><span class="annot"><span class="annottext">isEmpty :: EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isEmpty"><span class="hs-identifier hs-var hs-var">isEmpty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-199"></span><span class="annot"><a href="DeltaQ.Diagram.html#isEmpty"><span class="hs-identifier hs-var">isEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-comment">-- | Expand all 'Seq' in the 'foliage' as a sequence of twigs.</span><span>
</span><span id="line-202"></span><span class="hs-comment">--</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- Merge observation locations that follow after a vertical term</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- into the term annotation.</span><span>
</span><span id="line-205"></span><span class="annot"><a href="DeltaQ.Diagram.html#expandSeq"><span class="hs-identifier hs-type">expandSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span>
</span><span id="line-206"></span><span id="expandSeq"><span class="annot"><span class="annottext">expandSeq :: Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#expandSeq"><span class="hs-identifier hs-var hs-var">expandSeq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Shrub EdgeData) -&gt; Shrub EdgeData -&gt; Shrub EdgeData
forall a. (a -&gt; Shrub a) -&gt; Shrub a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var">updateFoliage</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall {a}. (a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160134"><span class="hs-identifier hs-var">expand</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679160134"><span class="annot"><span class="annottext">expand :: (a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160134"><span class="hs-identifier hs-var hs-var">expand</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160135"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160135"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Seq"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span id="local-6989586621679160136"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160136"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a
-&gt; Shrub (a, EdgeOutcome)
-&gt; [Term String]
-&gt; Shrub (a, EdgeOutcome)
forall {a}.
a
-&gt; Shrub (a, EdgeOutcome)
-&gt; [Term String]
-&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160137"><span class="hs-identifier hs-var">mkBranches</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160135"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub (a, EdgeOutcome)
forall a. Shrub a
</span><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160136"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="#local-6989586621679160134"><span class="hs-identifier hs-var">expand</span></a></span><span> </span><span id="local-6989586621679160139"><span class="annot"><span class="annottext">(a, EdgeOutcome)
</span><a href="#local-6989586621679160139"><span class="hs-identifier hs-var">edge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="annot"><span class="annottext">(a, EdgeOutcome)
</span><a href="#local-6989586621679160139"><span class="hs-identifier hs-var">edge</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621679160137"><span class="annot"><span class="annottext">mkBranches :: a
-&gt; Shrub (a, EdgeOutcome)
-&gt; [Term String]
-&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160137"><span class="hs-identifier hs-var hs-var">mkBranches</span></a></span></span><span> </span><span id="local-6989586621679160140"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160140"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679160141"><span class="annot"><span class="annottext">Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160141"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160141"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="#local-6989586621679160137"><span class="hs-identifier hs-var">mkBranches</span></a></span><span> </span><span id="local-6989586621679160142"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160142"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679160143"><span class="annot"><span class="annottext">Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160143"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160144"><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160144"><span class="hs-identifier hs-var">t</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><a href="DeltaQ.Expr.html#Loc"><span class="hs-identifier hs-type">Loc</span></a></span><span> </span><span id="local-6989586621679160146"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160146"><span class="hs-identifier hs-var">description</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679160147"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160147"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var">isVertical</span></a></span><span> </span><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160144"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>            </span><span class="annot"><span class="annottext">a
-&gt; Shrub (a, EdgeOutcome)
-&gt; [Term String]
-&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160137"><span class="hs-identifier hs-var">mkBranches</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160142"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[((a, EdgeOutcome), Shrub (a, EdgeOutcome))]
-&gt; Shrub (a, EdgeOutcome)
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160142"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Maybe String -&gt; EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160144"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160146"><span class="hs-identifier hs-var">description</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160143"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160147"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><a href="#local-6989586621679160137"><span class="hs-identifier hs-var">mkBranches</span></a></span><span> </span><span id="local-6989586621679160149"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160149"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679160150"><span class="annot"><span class="annottext">Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160150"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160151"><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160151"><span class="hs-identifier hs-var">t</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679160152"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160152"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><span class="annottext">a
-&gt; Shrub (a, EdgeOutcome)
-&gt; [Term String]
-&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160137"><span class="hs-identifier hs-var">mkBranches</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160149"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[((a, EdgeOutcome), Shrub (a, EdgeOutcome))]
-&gt; Shrub (a, EdgeOutcome)
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160149"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Maybe String -&gt; EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160151"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160150"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160152"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><span class="hs-comment">-- | Emit a column with the next observation locations.</span></span><span>
</span><span id="line-219"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitLoc"><span class="hs-identifier hs-type">emitLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span id="emitLoc"><span class="annot"><span class="annottext">emitLoc :: Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitLoc"><span class="hs-identifier hs-var hs-var">emitLoc</span></a></span></span><span> </span><span id="local-6989586621679160153"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160153"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679160154"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160154"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EdgeData -&gt; [Tile]) -&gt; [EdgeData] -&gt; [Tile]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; [Tile]
</span><a href="#local-6989586621679160156"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="annot"><span class="annottext">([EdgeData] -&gt; [Tile]) -&gt; [EdgeData] -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160154"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Shrub EdgeData) -&gt; Shrub EdgeData -&gt; Shrub EdgeData
forall a. (a -&gt; Shrub a) -&gt; Shrub a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var">updateFoliage</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall {a}. (a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160157"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160154"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679160157"><span class="annot"><span class="annottext">dropit :: (a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160157"><span class="hs-identifier hs-var hs-var">dropit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160158"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160158"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Loc"><span class="hs-identifier hs-type">Loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160158"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><a href="#local-6989586621679160157"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span id="local-6989586621679160159"><span class="annot"><span class="annottext">(a, EdgeOutcome)
</span><a href="#local-6989586621679160159"><span class="hs-identifier hs-var">edge</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="annot"><span class="annottext">(a, EdgeOutcome)
</span><a href="#local-6989586621679160159"><span class="hs-identifier hs-var">edge</span></a></span><span>
</span><span id="line-225"></span><span>
</span><span id="line-226"></span><span>    </span><span id="local-6989586621679160156"><span class="annot"><span class="annottext">emit :: EdgeData -&gt; [Tile]
</span><a href="#local-6989586621679160156"><span class="hs-identifier hs-var hs-var">emit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160160"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160160"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Loc"><span class="hs-identifier hs-type">Loc</span></a></span><span> </span><span id="local-6989586621679160161"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160161"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160153"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160160"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Tile) -&gt; Token -&gt; Tile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Token
</span><a href="DeltaQ.Diagram.html#Location"><span class="hs-identifier hs-var">Location</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160161"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><a href="#local-6989586621679160156"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160162"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160162"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160153"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160162"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="annot"><span class="hs-comment">-- | Emit a column with the next named items.</span></span><span>
</span><span id="line-230"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitVar"><span class="hs-identifier hs-type">emitVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span id="emitVar"><span class="annot"><span class="annottext">emitVar :: Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitVar"><span class="hs-identifier hs-var hs-var">emitVar</span></a></span></span><span> </span><span id="local-6989586621679160163"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160163"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679160164"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160164"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EdgeData -&gt; Tile) -&gt; [EdgeData] -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Tile
</span><a href="#local-6989586621679160165"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="annot"><span class="annottext">([EdgeData] -&gt; [Tile]) -&gt; [EdgeData] -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160164"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Shrub EdgeData) -&gt; Shrub EdgeData -&gt; Shrub EdgeData
forall a. (a -&gt; Shrub a) -&gt; Shrub a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var">updateFoliage</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall {a}. (a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160166"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160164"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-234"></span><span>    </span><span id="local-6989586621679160166"><span class="annot"><span class="annottext">dropit :: (a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
</span><a href="#local-6989586621679160166"><span class="hs-identifier hs-var hs-var">dropit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160167"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160167"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160167"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><a href="#local-6989586621679160166"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span id="local-6989586621679160169"><span class="annot"><span class="annottext">(a, EdgeOutcome)
</span><a href="#local-6989586621679160169"><span class="hs-identifier hs-var">edge</span></a></span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, EdgeOutcome) -&gt; Shrub (a, EdgeOutcome)
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="annot"><span class="annottext">(a, EdgeOutcome)
</span><a href="#local-6989586621679160169"><span class="hs-identifier hs-var">edge</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621679160165"><span class="annot"><span class="annottext">emit :: EdgeData -&gt; Tile
</span><a href="#local-6989586621679160165"><span class="hs-identifier hs-var hs-var">emit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160170"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160170"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621679160171"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160171"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160163"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160170"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Token
</span><a href="DeltaQ.Diagram.html#VarT"><span class="hs-identifier hs-var">VarT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160171"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="#local-6989586621679160165"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160172"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160172"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160173"><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="#local-6989586621679160173"><span class="hs-identifier hs-var">edge</span></a></span></span><span>          </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160163"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160172"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span class="annot"><span class="hs-comment">-- | Emit a column with the next vertical items.</span></span><span>
</span><span id="line-241"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitVertical"><span class="hs-identifier hs-type">emitVertical</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span id="emitVertical"><span class="annot"><span class="annottext">emitVertical :: Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitVertical"><span class="hs-identifier hs-var hs-var">emitVertical</span></a></span></span><span> </span><span id="local-6989586621679160174"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160174"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679160175"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160175"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EdgeData -&gt; Tile) -&gt; [EdgeData] -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Tile
</span><a href="#local-6989586621679160176"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="annot"><span class="annottext">([EdgeData] -&gt; [Tile]) -&gt; [EdgeData] -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160175"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Shrub EdgeData) -&gt; Shrub EdgeData -&gt; Shrub EdgeData
forall a. (a -&gt; Shrub a) -&gt; Shrub a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var">updateFoliage</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
</span><a href="#local-6989586621679160177"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160175"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-245"></span><span>    </span><span id="local-6989586621679160177"><span class="annot"><span class="annottext">dropit :: EdgeData -&gt; Shrub EdgeData
</span><a href="#local-6989586621679160177"><span class="hs-identifier hs-var hs-var">dropit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160178"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160178"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Last"><span class="hs-identifier hs-type">Last</span></a></span><span>    </span><span id="local-6989586621679160180"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160180"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span id="local-6989586621679160181"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679160181"><span class="hs-identifier hs-var">ml</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Maybe String -&gt; [Term String] -&gt; Shrub EdgeData
</span><a href="#local-6989586621679160182"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160178"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679160181"><span class="hs-identifier hs-var">ml</span></a></span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160180"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="#local-6989586621679160177"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160183"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160183"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#First"><span class="hs-identifier hs-type">First</span></a></span><span>   </span><span id="local-6989586621679160185"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160185"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span id="local-6989586621679160186"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679160186"><span class="hs-identifier hs-var">ml</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Maybe String -&gt; [Term String] -&gt; Shrub EdgeData
</span><a href="#local-6989586621679160182"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160183"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679160186"><span class="hs-identifier hs-var">ml</span></a></span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160185"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><a href="#local-6989586621679160177"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160187"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160187"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Choices"><span class="hs-identifier hs-type">Choices</span></a></span><span> </span><span id="local-6989586621679160189"><span class="annot"><span class="annottext">[(Rational, Term String)]
</span><a href="#local-6989586621679160189"><span class="hs-identifier hs-var">wexprs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679160190"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679160190"><span class="hs-identifier hs-var">ml</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Maybe String -&gt; [Term String] -&gt; Shrub EdgeData
</span><a href="#local-6989586621679160182"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160187"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679160190"><span class="hs-identifier hs-var">ml</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Rational, Term String) -&gt; Term String)
-&gt; [(Rational, Term String)] -&gt; [Term String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Rational, Term String) -&gt; Term String
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Rational, Term String)]
</span><a href="#local-6989586621679160189"><span class="hs-identifier hs-var">wexprs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="#local-6989586621679160177"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span id="local-6989586621679160192"><span class="annot"><span class="annottext">EdgeData
</span><a href="#local-6989586621679160192"><span class="hs-identifier hs-var">edge</span></a></span></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData
</span><a href="#local-6989586621679160192"><span class="hs-identifier hs-var">edge</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621679160193"><span class="annot"><span class="annottext">mkLocation :: Maybe String -&gt; EdgeOutcome
</span><a href="#local-6989586621679160193"><span class="hs-identifier hs-var hs-var">mkLocation</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><a href="#local-6989586621679160193"><span class="hs-identifier hs-var">mkLocation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679160194"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160194"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Maybe String -&gt; EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Term String
forall v. String -&gt; Term v
</span><a href="DeltaQ.Expr.html#Loc"><span class="hs-identifier hs-var">Loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160194"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621679160182"><span class="annot"><span class="annottext">close :: Y -&gt; Maybe String -&gt; [Term String] -&gt; Shrub EdgeData
</span><a href="#local-6989586621679160182"><span class="hs-identifier hs-var hs-var">close</span></a></span></span><span> </span><span id="local-6989586621679160195"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160195"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679160196"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679160196"><span class="hs-identifier hs-var">ml</span></a></span></span><span> </span><span id="local-6989586621679160197"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160197"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-254"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160195"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; EdgeOutcome
</span><a href="#local-6989586621679160193"><span class="hs-identifier hs-var">mkLocation</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679160196"><span class="hs-identifier hs-var">ml</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EdgeData
</span><a href="#local-6989586621679160198"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
forall a. Shrub a
</span><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679160198"><span class="annot"><span class="annottext">EdgeData
</span><a href="#local-6989586621679160198"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Y -&gt; [Term String] -&gt; [EdgeData]
</span><a href="#local-6989586621679160199"><span class="hs-identifier hs-var">verticals</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160195"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160197"><span class="hs-identifier hs-var">exprs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-257"></span><span>    </span><span id="local-6989586621679160199"><span class="annot"><span class="annottext">verticals :: Y -&gt; [Term String] -&gt; [EdgeData]
</span><a href="#local-6989586621679160199"><span class="hs-identifier hs-var hs-var">verticals</span></a></span></span><span> </span><span id="local-6989586621679160201"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160201"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679160202"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160202"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">(Y -&gt; Term String -&gt; EdgeData)
-&gt; [Y] -&gt; [Term String] -&gt; [EdgeData]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679160203"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160203"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span id="local-6989586621679160204"><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160204"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160201"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Y
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160203"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Maybe String -&gt; EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-var">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679160204"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Term String] -&gt; [Y]
forall {v}. [Term v] -&gt; [Y]
</span><a href="#local-6989586621679160205"><span class="hs-identifier hs-var">distances</span></a></span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160202"><span class="hs-identifier hs-var">exprs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160202"><span class="hs-identifier hs-var">exprs</span></a></span><span> </span><span>
</span><span id="line-259"></span><span>    </span><span id="local-6989586621679160205"><span class="annot"><span class="annottext">distances :: [Term v] -&gt; [Y]
</span><a href="#local-6989586621679160205"><span class="hs-identifier hs-var hs-var">distances</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Y] -&gt; [Y]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">init</span></span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; [Y]) -&gt; ([Term v] -&gt; [Y]) -&gt; [Term v] -&gt; [Y]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Y -&gt; Y -&gt; Y) -&gt; Y -&gt; [Y] -&gt; [Y]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">scanl</span></span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Y
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">Y
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; [Y]) -&gt; ([Term v] -&gt; [Y]) -&gt; [Term v] -&gt; [Y]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Y) -&gt; [Term v] -&gt; [Y]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Y
forall v. Term v -&gt; Y
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>    </span><span id="local-6989586621679160176"><span class="annot"><span class="annottext">emit :: EdgeData -&gt; Tile
</span><a href="#local-6989586621679160176"><span class="hs-identifier hs-var hs-var">emit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160213"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160213"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Last"><span class="hs-identifier hs-type">Last</span></a></span><span>    </span><span id="local-6989586621679160214"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160214"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160174"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160213"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Tile) -&gt; Token -&gt; Tile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op -&gt; [Y] -&gt; Token
</span><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-var">Open</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="DeltaQ.Diagram.html#OLast"><span class="hs-identifier hs-var">OLast</span></a></span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; Token) -&gt; [Y] -&gt; Token
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term String] -&gt; [Y]
forall {v}. [Term v] -&gt; [Y]
</span><a href="#local-6989586621679160205"><span class="hs-identifier hs-var">distances</span></a></span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160214"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="#local-6989586621679160176"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160215"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160215"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#First"><span class="hs-identifier hs-type">First</span></a></span><span>   </span><span id="local-6989586621679160216"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160216"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160174"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160215"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Tile) -&gt; Token -&gt; Tile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op -&gt; [Y] -&gt; Token
</span><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-var">Open</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="DeltaQ.Diagram.html#OFirst"><span class="hs-identifier hs-var">OFirst</span></a></span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; Token) -&gt; [Y] -&gt; Token
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term String] -&gt; [Y]
forall {v}. [Term v] -&gt; [Y]
</span><a href="#local-6989586621679160205"><span class="hs-identifier hs-var">distances</span></a></span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160216"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="#local-6989586621679160176"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160217"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160217"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Choices"><span class="hs-identifier hs-type">Choices</span></a></span><span> </span><span id="local-6989586621679160218"><span class="annot"><span class="annottext">[(Rational, Term String)]
</span><a href="#local-6989586621679160218"><span class="hs-identifier hs-var">wexprs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-266"></span><span>        </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160174"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160217"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Tile) -&gt; Token -&gt; Tile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op -&gt; [Y] -&gt; Token
</span><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-var">Open</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Rational] -&gt; Op
</span><a href="DeltaQ.Diagram.html#OChoices"><span class="hs-identifier hs-var">OChoices</span></a></span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679160219"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; Token) -&gt; [Y] -&gt; Token
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term String] -&gt; [Y]
forall {v}. [Term v] -&gt; [Y]
</span><a href="#local-6989586621679160205"><span class="hs-identifier hs-var">distances</span></a></span><span> </span><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160220"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160219"><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679160219"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160220"><span class="annot"><span class="annottext">[Term String]
</span><a href="#local-6989586621679160220"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Rational, Term String)] -&gt; ([Rational], [Term String])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(Rational, Term String)]
</span><a href="#local-6989586621679160218"><span class="hs-identifier hs-var">wexprs</span></a></span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><a href="#local-6989586621679160176"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160222"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160222"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160174"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160222"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="annot"><span class="hs-comment">-- | Outcomes that open a new vertical.</span></span><span>
</span><span id="line-271"></span><span id="local-6989586621679160223"><span class="annot"><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-type">isVertical</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679160223"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-272"></span><span id="isVertical"><span class="annot"><span class="annottext">isVertical :: forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var hs-var">isVertical</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Last"><span class="hs-identifier hs-type">Last</span></a></span><span>    </span><span class="annot"><span class="annottext">[Term v]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-273"></span><span class="annot"><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var">isVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#First"><span class="hs-identifier hs-type">First</span></a></span><span>   </span><span class="annot"><span class="annottext">[Term v]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-274"></span><span class="annot"><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var">isVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Choices"><span class="hs-identifier hs-type">Choices</span></a></span><span> </span><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-275"></span><span class="annot"><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var">isVertical</span></a></span><span> </span><span class="annot"><span class="annottext">Term v
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-276"></span><span>
</span><span id="line-277"></span><span class="hs-comment">-- | Maximal number of outcomes that are shown vertically.</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- Parallel operations are shown vertically, but also 'Choices'.</span><span>
</span><span id="line-279"></span><span id="local-6989586621679159180"><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-type">maxVertical</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159180"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-280"></span><span id="maxVertical"><span class="annot"><span class="annottext">maxVertical :: forall v. Term v -&gt; Y
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var hs-var">maxVertical</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Seq"><span class="hs-identifier hs-type">Seq</span></a></span><span>   </span><span id="local-6989586621679160232"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679160232"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Y] -&gt; Y
forall a. Ord a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; Y) -&gt; [Y] -&gt; Y
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Y) -&gt; [Term v] -&gt; [Y]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Y
forall v. Term v -&gt; Y
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679160232"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-281"></span><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Last"><span class="hs-identifier hs-type">Last</span></a></span><span>  </span><span id="local-6989586621679160234"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679160234"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Y] -&gt; Y
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; Y) -&gt; [Y] -&gt; Y
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Y) -&gt; [Term v] -&gt; [Y]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Y
forall v. Term v -&gt; Y
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679160234"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-282"></span><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#First"><span class="hs-identifier hs-type">First</span></a></span><span> </span><span id="local-6989586621679160235"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679160235"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Y] -&gt; Y
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; Y) -&gt; [Y] -&gt; Y
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Y) -&gt; [Term v] -&gt; [Y]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Y
forall v. Term v -&gt; Y
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679160235"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-283"></span><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Choices"><span class="hs-identifier hs-type">Choices</span></a></span><span> </span><span id="local-6989586621679160236"><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><a href="#local-6989586621679160236"><span class="hs-identifier hs-var">wts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Y] -&gt; Y
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; Y) -&gt; [Y] -&gt; Y
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Rational, Term v) -&gt; Y) -&gt; [(Rational, Term v)] -&gt; [Y]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term v -&gt; Y
forall v. Term v -&gt; Y
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Y)
-&gt; ((Rational, Term v) -&gt; Term v) -&gt; (Rational, Term v) -&gt; Y
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Rational, Term v) -&gt; Term v
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><a href="#local-6989586621679160236"><span class="hs-identifier hs-var">wts</span></a></span><span>
</span><span id="line-284"></span><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">Term v
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Y
</span><span class="hs-number">1</span></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">-- | Check whether there is a group of silent foliage that should</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- be closed.</span><span>
</span><span id="line-289"></span><span class="annot"><a href="DeltaQ.Diagram.html#hasGroupClose"><span class="hs-identifier hs-type">hasGroupClose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-290"></span><span id="hasGroupClose"><span class="annot"><span class="annottext">hasGroupClose :: Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#hasGroupClose"><span class="hs-identifier hs-var hs-var">hasGroupClose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; Bool) -&gt; [Shrub EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="#local-6989586621679160237"><span class="hs-identifier hs-var">isGroupClose</span></a></span><span> </span><span class="annot"><span class="annottext">([Shrub EdgeData] -&gt; Bool)
-&gt; (Shrub EdgeData -&gt; [Shrub EdgeData]) -&gt; Shrub EdgeData -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [Shrub EdgeData]
forall a. Shrub a -&gt; [Shrub a]
</span><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var">foliageBushes</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-292"></span><span>    </span><span id="local-6989586621679160237"><span class="annot"><span class="annottext">isGroupClose :: Shrub EdgeData -&gt; Bool
</span><a href="#local-6989586621679160237"><span class="hs-identifier hs-var hs-var">isGroupClose</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160243"><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160243"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-293"></span><span>        </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Y
forall a. [a] -&gt; Y
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Y
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160243"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Y
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isEmpty"><span class="hs-identifier hs-var">isEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData) -&gt; EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; [EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub EdgeData) -&gt; EdgeData
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160243"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | Check whether there are any foliage edges that</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- have no expressions and no siblings.</span><span>
</span><span id="line-297"></span><span class="annot"><a href="DeltaQ.Diagram.html#hasIsolatedTwigs"><span class="hs-identifier hs-type">hasIsolatedTwigs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-298"></span><span id="hasIsolatedTwigs"><span class="annot"><span class="annottext">hasIsolatedTwigs :: Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#hasIsolatedTwigs"><span class="hs-identifier hs-var hs-var">hasIsolatedTwigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; Bool) -&gt; [Shrub EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-var">isIsolatedTwig</span></a></span><span> </span><span class="annot"><span class="annottext">([Shrub EdgeData] -&gt; Bool)
-&gt; (Shrub EdgeData -&gt; [Shrub EdgeData]) -&gt; Shrub EdgeData -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [Shrub EdgeData]
forall a. Shrub a -&gt; [Shrub a]
</span><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var">foliageBushes</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="hs-comment">-- | 'foliageBushes' returns the collection of all subtrees</span><span>
</span><span id="line-301"></span><span class="hs-comment">-- that consist only of foliage. (These trees have height 1).</span><span>
</span><span id="line-302"></span><span class="hs-comment">--</span><span>
</span><span id="line-303"></span><span class="hs-comment">-- Trees where the immediate children of a root contain both</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- foliage and non-foliage are not returned here!</span><span>
</span><span id="line-305"></span><span id="local-6989586621679159186"><span class="annot"><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-type">foliageBushes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159186"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159186"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-306"></span><span id="foliageBushes"><span class="annot"><span class="annottext">foliageBushes :: forall a. Shrub a -&gt; [Shrub a]
</span><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var hs-var">foliageBushes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-307"></span><span class="annot"><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var">foliageBushes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160251"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160251"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Shrub a -&gt; Bool) -&gt; [Shrub a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Shrub a -&gt; Bool
forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; Shrub a) -&gt; [(a, Shrub a)] -&gt; [Shrub a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; Shrub a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160251"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160251"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [Shrub a]) -&gt; [(a, Shrub a)] -&gt; [Shrub a]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shrub a -&gt; [Shrub a]
forall a. Shrub a -&gt; [Shrub a]
</span><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var">foliageBushes</span></a></span><span> </span><span class="annot"><span class="annottext">(Shrub a -&gt; [Shrub a])
-&gt; ((a, Shrub a) -&gt; Shrub a) -&gt; (a, Shrub a) -&gt; [Shrub a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; Shrub a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160251"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-310"></span><span>
</span><span id="line-311"></span><span class="hs-comment">-- | Emit a column that closes all groups that can be closed</span><span>
</span><span id="line-312"></span><span class="hs-comment">-- at the moment.</span><span>
</span><span id="line-313"></span><span class="hs-comment">--</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- Special case: If the next-higher branch is an observation</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- location with a label, we merge that location into the close.</span><span>
</span><span id="line-316"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitGroupClose"><span class="hs-identifier hs-type">emitGroupClose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span id="emitGroupClose"><span class="annot"><span class="annottext">emitGroupClose :: Y -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitGroupClose"><span class="hs-identifier hs-var hs-var">emitGroupClose</span></a></span></span><span> </span><span id="local-6989586621679160252"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160252"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679160253"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160253"><span class="hs-identifier hs-var">shrub</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="#local-6989586621679160254"><span class="hs-identifier hs-var">goBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160253"><span class="hs-identifier hs-var">shrub</span></a></span><span>
</span><span id="line-318"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-319"></span><span>    </span><span id="local-6989586621679160254"><span class="annot"><span class="annottext">goBranch :: Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="#local-6989586621679160254"><span class="hs-identifier hs-var hs-var">goBranch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span class="annot"><a href="#local-6989586621679160254"><span class="hs-identifier hs-var">goBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160257"><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160257"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Tile]] -&gt; [Tile]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[Tile]]
</span><a href="#local-6989586621679160259"><span class="hs-identifier hs-var">tiless</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160260"><span class="hs-identifier hs-var">edges</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160259"><span class="annot"><span class="annottext">[[Tile]]
</span><a href="#local-6989586621679160259"><span class="hs-identifier hs-var">tiless</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160260"><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160260"><span class="hs-identifier hs-var">edges</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[([Tile], (EdgeData, Shrub EdgeData))]
-&gt; ([[Tile]], [(EdgeData, Shrub EdgeData)])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([([Tile], (EdgeData, Shrub EdgeData))]
 -&gt; ([[Tile]], [(EdgeData, Shrub EdgeData)]))
-&gt; [([Tile], (EdgeData, Shrub EdgeData))]
-&gt; ([[Tile]], [(EdgeData, Shrub EdgeData)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData)
 -&gt; ([Tile], (EdgeData, Shrub EdgeData)))
-&gt; [(EdgeData, Shrub EdgeData)]
-&gt; [([Tile], (EdgeData, Shrub EdgeData))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EdgeData
 -&gt; Shrub EdgeData -&gt; ([Tile], (EdgeData, Shrub EdgeData)))
-&gt; (EdgeData, Shrub EdgeData)
-&gt; ([Tile], (EdgeData, Shrub EdgeData))
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData -&gt; ([Tile], (EdgeData, Shrub EdgeData))
</span><a href="#local-6989586621679160262"><span class="hs-identifier hs-var">goEdge</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160257"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>    </span><span id="local-6989586621679160262"><span class="annot"><span class="annottext">goEdge :: EdgeData -&gt; Shrub EdgeData -&gt; ([Tile], (EdgeData, Shrub EdgeData))
</span><a href="#local-6989586621679160262"><span class="hs-identifier hs-var hs-var">goEdge</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160263"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160263"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160264"><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="#local-6989586621679160264"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-324"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160252"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160263"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160263"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="#local-6989586621679160264"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><a href="#local-6989586621679160262"><span class="hs-identifier hs-var">goEdge</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160265"><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160265"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160266"><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="#local-6989586621679160266"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160267"><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160267"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Bool
forall {a}. [(EdgeData, Shrub a)] -&gt; Bool
</span><a href="#local-6989586621679160268"><span class="hs-identifier hs-var">isGroupClose</span></a></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160267"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-329"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160252"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160265"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Tile) -&gt; Token -&gt; Tile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; [Y] -&gt; Token
</span><a href="DeltaQ.Diagram.html#Close"><span class="hs-identifier hs-var">Close</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679160269"><span class="hs-identifier hs-var">mlocation</span></a></span><span> </span><span class="annot"><span class="annottext">([Y] -&gt; Token) -&gt; [Y] -&gt; Token
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Y -&gt; Y) -&gt; [Y] -&gt; [Y]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Y
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">subtract</span></span><span> </span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160265"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Y]
</span><a href="#local-6989586621679160271"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-330"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160265"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
forall a. Shrub a
</span><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-333"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160272"><span class="annot"><span class="annottext">[Tile]
</span><a href="#local-6989586621679160272"><span class="hs-identifier hs-var">tiles</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160273"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160273"><span class="hs-identifier hs-var">branch'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="#local-6989586621679160254"><span class="hs-identifier hs-var">goBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160267"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>            </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Tile]
</span><a href="#local-6989586621679160272"><span class="hs-identifier hs-var">tiles</span></a></span><span>
</span><span id="line-335"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y
</span><a href="#local-6989586621679160265"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="#local-6989586621679160266"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679160273"><span class="hs-identifier hs-var">branch'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-338"></span><span>        </span><span id="local-6989586621679160269"><span class="annot"><span class="annottext">mlocation :: Maybe String
</span><a href="#local-6989586621679160269"><span class="hs-identifier hs-var hs-var">mlocation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="#local-6989586621679160266"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-339"></span><span>            </span><span class="annot"><a href="DeltaQ.Diagram.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Loc"><span class="hs-identifier hs-type">Loc</span></a></span><span> </span><span id="local-6989586621679160274"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160274"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679160274"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-340"></span><span>            </span><span class="annot"><span class="annottext">EdgeOutcome
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621679160271"><span class="annot"><span class="annottext">ys :: [Y]
</span><a href="#local-6989586621679160271"><span class="hs-identifier hs-var hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData) -&gt; Y)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; [Y]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EdgeData -&gt; Y
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Y)
-&gt; ((EdgeData, Shrub EdgeData) -&gt; EdgeData)
-&gt; (EdgeData, Shrub EdgeData)
-&gt; Y
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub EdgeData) -&gt; EdgeData
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160267"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621679160268"><span class="annot"><span class="annottext">isGroupClose :: [(EdgeData, Shrub a)] -&gt; Bool
</span><a href="#local-6989586621679160268"><span class="hs-identifier hs-var hs-var">isGroupClose</span></a></span></span><span> </span><span id="local-6989586621679160280"><span class="annot"><span class="annottext">[(EdgeData, Shrub a)]
</span><a href="#local-6989586621679160280"><span class="hs-identifier hs-var">ts</span></a></span></span><span>
</span><span id="line-344"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Shrub a -&gt; Bool) -&gt; [Shrub a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Shrub a -&gt; Bool
forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EdgeData, Shrub a) -&gt; Shrub a)
-&gt; [(EdgeData, Shrub a)] -&gt; [Shrub a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub a) -&gt; Shrub a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub a)]
</span><a href="#local-6989586621679160280"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isEmpty"><span class="hs-identifier hs-var">isEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EdgeData, Shrub a) -&gt; EdgeData)
-&gt; [(EdgeData, Shrub a)] -&gt; [EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub a) -&gt; EdgeData
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub a)]
</span><a href="#local-6989586621679160280"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub a)] -&gt; Y
forall a. [a] -&gt; Y
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Y
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub a)]
</span><a href="#local-6989586621679160280"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Y -&gt; Y -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Y
</span><span class="hs-number">1</span></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="annot"><span class="hs-comment">-- | Drop all foliage edges that have no expressions and have no siblings.</span></span><span>
</span><span id="line-347"></span><span class="annot"><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-type">dropIsolatedTwigs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span>
</span><span id="line-348"></span><span id="dropIsolatedTwigs"><span class="annot"><span class="annottext">dropIsolatedTwigs :: Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-var hs-var">dropIsolatedTwigs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-349"></span><span class="annot"><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-var">dropIsolatedTwigs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160281"><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160281"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-var">isIsolatedTwig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160281"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">([(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[EdgeData] -&gt; [Shrub EdgeData] -&gt; [(EdgeData, Shrub EdgeData)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[EdgeData]
</span><a href="#local-6989586621679160282"><span class="hs-identifier hs-var">labels</span></a></span><span> </span><span class="annot"><span class="annottext">([Shrub EdgeData] -&gt; [(EdgeData, Shrub EdgeData)])
-&gt; [Shrub EdgeData] -&gt; [(EdgeData, Shrub EdgeData)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; Shrub EdgeData)
-&gt; [Shrub EdgeData] -&gt; [Shrub EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-var">dropIsolatedTwigs</span></a></span><span> </span><span class="annot"><span class="annottext">[Shrub EdgeData]
</span><a href="#local-6989586621679160283"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621679160282"><span class="annot"><span class="annottext">labels :: [EdgeData]
</span><a href="#local-6989586621679160282"><span class="hs-identifier hs-var hs-var">labels</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData) -&gt; EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; [EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub EdgeData) -&gt; EdgeData
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160281"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621679160283"><span class="annot"><span class="annottext">children :: [Shrub EdgeData]
</span><a href="#local-6989586621679160283"><span class="hs-identifier hs-var hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData) -&gt; Shrub EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; [Shrub EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub EdgeData) -&gt; Shrub EdgeData
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679160281"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-355"></span><span>
</span><span id="line-356"></span><span class="annot"><span class="hs-comment">-- | Check whether a 'Shrub' is a twig without expression.</span></span><span>
</span><span id="line-357"></span><span class="annot"><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-type">isIsolatedTwig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-358"></span><span id="isIsolatedTwig"><span class="annot"><span class="annottext">isIsolatedTwig :: Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-var hs-var">isIsolatedTwig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Y
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">EdgeOutcome
</span><a href="DeltaQ.Diagram.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-359"></span><span class="annot"><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-var">isIsolatedTwig</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Shrub
    data structure
------------------------------------------------------------------------------}</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- | A 'Shrub' is a rooted tree that has labels (only) on the edges</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- (as opposed to on the leaves).</span><span>
</span><span id="line-367"></span><span class="hs-keyword">newtype</span><span> </span><span id="Shrub"><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-var">Shrub</span></a></span></span><span> </span><span id="local-6989586621679159167"><span class="annot"><a href="#local-6989586621679159167"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Branch"><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unBranch"><span class="annot"><span class="annottext">forall a. Shrub a -&gt; [(a, Shrub a)]
</span><a href="DeltaQ.Diagram.html#unBranch"><span class="hs-identifier hs-var hs-var">unBranch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679159167"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159167"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160287"><span id="local-6989586621679160292"><span class="annot"><span class="annottext">Shrub a -&gt; Shrub a -&gt; Bool
(Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool) -&gt; Eq (Shrub a)
forall a. Eq a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
== :: Shrub a -&gt; Shrub a -&gt; Bool
$c/= :: forall a. Eq a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
/= :: Shrub a -&gt; Shrub a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160306"><span id="local-6989586621679160311"><span id="local-6989586621679160316"><span id="local-6989586621679160321"><span id="local-6989586621679160326"><span id="local-6989586621679160331"><span id="local-6989586621679160336"><span class="annot"><span class="annottext">Eq (Shrub a)
Eq (Shrub a) =&gt;
(Shrub a -&gt; Shrub a -&gt; Ordering)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Shrub a)
-&gt; (Shrub a -&gt; Shrub a -&gt; Shrub a)
-&gt; Ord (Shrub a)
Shrub a -&gt; Shrub a -&gt; Bool
Shrub a -&gt; Shrub a -&gt; Ordering
Shrub a -&gt; Shrub a -&gt; Shrub a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (Shrub a)
forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Ordering
forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Shrub a
$ccompare :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Ordering
compare :: Shrub a -&gt; Shrub a -&gt; Ordering
$c&lt; :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
&lt; :: Shrub a -&gt; Shrub a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
&lt;= :: Shrub a -&gt; Shrub a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
&gt; :: Shrub a -&gt; Shrub a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
&gt;= :: Shrub a -&gt; Shrub a -&gt; Bool
$cmax :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Shrub a
max :: Shrub a -&gt; Shrub a -&gt; Shrub a
$cmin :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Shrub a
min :: Shrub a -&gt; Shrub a -&gt; Shrub a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160353"><span id="local-6989586621679160358"><span id="local-6989586621679160362"><span class="annot"><span class="annottext">Y -&gt; Shrub a -&gt; ShowS
[Shrub a] -&gt; ShowS
Shrub a -&gt; String
(Y -&gt; Shrub a -&gt; ShowS)
-&gt; (Shrub a -&gt; String) -&gt; ([Shrub a] -&gt; ShowS) -&gt; Show (Shrub a)
forall a. Show a =&gt; Y -&gt; Shrub a -&gt; ShowS
forall a. Show a =&gt; [Shrub a] -&gt; ShowS
forall a. Show a =&gt; Shrub a -&gt; String
forall a.
(Y -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Y -&gt; Shrub a -&gt; ShowS
showsPrec :: Y -&gt; Shrub a -&gt; ShowS
$cshow :: forall a. Show a =&gt; Shrub a -&gt; String
show :: Shrub a -&gt; String
$cshowList :: forall a. Show a =&gt; [Shrub a] -&gt; ShowS
showList :: [Shrub a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679160368"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621679160373"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; Shrub a -&gt; Shrub b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679160374"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679160374"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160375"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160375"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(b, Shrub b)] -&gt; Shrub b
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679160374"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160376"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Shrub a -&gt; Shrub b
forall a b. (a -&gt; b) -&gt; Shrub a -&gt; Shrub b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679160374"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub a
</span><a href="#local-6989586621679160377"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160376"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160376"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160377"><span class="annot"><span class="annottext">Shrub a
</span><a href="#local-6989586621679160377"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160375"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="annot"><span class="hs-comment">-- | Test whether a 'Shrub' is an isolated root.</span></span><span>
</span><span id="line-374"></span><span id="local-6989586621679159154"><span class="annot"><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-type">isRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159154"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-375"></span><span id="isRoot"><span class="annot"><span class="annottext">isRoot :: forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var hs-var">isRoot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-376"></span><span class="annot"><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span class="annot"><span class="hs-comment">-- | The 'Shrub' that is an isolated root.</span></span><span>
</span><span id="line-379"></span><span id="local-6989586621679159166"><span class="annot"><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-type">root</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159166"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-380"></span><span id="root"><span class="annot"><span class="annottext">root :: forall a. Shrub a
</span><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="annot"><span class="hs-comment">-- | Test whether a 'Shrub' is a single edge.</span></span><span>
</span><span id="line-383"></span><span id="local-6989586621679160378"><span class="annot"><a href="DeltaQ.Diagram.html#isTwig"><span class="hs-identifier hs-type">isTwig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679160378"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-384"></span><span id="isTwig"><span class="annot"><span class="annottext">isTwig :: forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isTwig"><span class="hs-identifier hs-var hs-var">isTwig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679160380"><span class="annot"><span class="annottext">Shrub a
</span><a href="#local-6989586621679160380"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shrub a -&gt; Bool
forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub a
</span><a href="#local-6989586621679160380"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-385"></span><span class="annot"><a href="DeltaQ.Diagram.html#isTwig"><span class="hs-identifier hs-var">isTwig</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="annot"><span class="hs-comment">-- | Construct a 'Shrub' with a single edge.</span></span><span>
</span><span id="line-388"></span><span id="local-6989586621679159152"><span class="annot"><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-type">twig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679159152"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159152"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-389"></span><span id="twig"><span class="annot"><span class="annottext">twig :: forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var hs-var">twig</span></a></span></span><span> </span><span id="local-6989586621679160381"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160381"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160381"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub a
forall a. Shrub a
</span><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="hs-comment">-- | The 'foliage' of a 'Shrub' is the collection of</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- edges that end in a leaf.</span><span>
</span><span id="line-393"></span><span class="hs-comment">--</span><span>
</span><span id="line-394"></span><span class="hs-comment">-- This function returns the labels of the foliage of the given 'Shrub'.</span><span>
</span><span id="line-395"></span><span id="local-6989586621679159160"><span class="annot"><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-type">foliage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159160"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679159160"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-396"></span><span id="foliage"><span class="annot"><span class="annottext">foliage :: forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var hs-var">foliage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-397"></span><span class="annot"><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160383"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160383"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [a]) -&gt; [(a, Shrub a)] -&gt; [a]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; [a]
forall {a}. (a, Shrub a) -&gt; [a]
</span><a href="#local-6989586621679160384"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160383"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-398"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-399"></span><span>    </span><span id="local-6989586621679160384"><span class="annot"><span class="annottext">go :: (a, Shrub a) -&gt; [a]
</span><a href="#local-6989586621679160384"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160386"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160386"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160386"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-400"></span><span>    </span><span class="annot"><a href="#local-6989586621679160384"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160387"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160387"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [a]) -&gt; [(a, Shrub a)] -&gt; [a]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; [a]
</span><a href="#local-6989586621679160384"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160387"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-401"></span><span>
</span><span id="line-402"></span><span class="hs-comment">-- | Replace the foliage by news 'Shrub's.</span><span>
</span><span id="line-403"></span><span class="hs-comment">--</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- Each edge in the foliage is replaced by the new 'Shrub'</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- whose root is attached to the end of the edge that is not a leaf.</span><span>
</span><span id="line-406"></span><span class="hs-comment">--</span><span>
</span><span id="line-407"></span><span class="hs-comment">-- Special cases:</span><span>
</span><span id="line-408"></span><span class="hs-comment">--</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- * If the new 'Shrub' is 'root', the foliage edge will be removed.</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- * If the new 'Shrub' is a 'twig', the foliage edge will get a new label.</span><span>
</span><span id="line-411"></span><span id="local-6989586621679159163"><span class="annot"><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-type">updateFoliage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679159163"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159163"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159163"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679159163"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-412"></span><span id="updateFoliage"><span class="annot"><span class="annottext">updateFoliage :: forall a. (a -&gt; Shrub a) -&gt; Shrub a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var hs-var">updateFoliage</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Shrub a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-413"></span><span class="annot"><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var">updateFoliage</span></a></span><span> </span><span id="local-6989586621679160389"><span class="annot"><span class="annottext">a -&gt; Shrub a
</span><a href="#local-6989586621679160389"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160390"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160390"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">([(a, Shrub a)] -&gt; Shrub a) -&gt; [(a, Shrub a)] -&gt; Shrub a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [(a, Shrub a)])
-&gt; [(a, Shrub a)] -&gt; [(a, Shrub a)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; [(a, Shrub a)]
</span><a href="#local-6989586621679160391"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160390"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-415"></span><span>    </span><span id="local-6989586621679160391"><span class="annot"><span class="annottext">update :: (a, Shrub a) -&gt; [(a, Shrub a)]
</span><a href="#local-6989586621679160391"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160393"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160393"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shrub a -&gt; [(a, Shrub a)]
forall a. Shrub a -&gt; [(a, Shrub a)]
</span><a href="DeltaQ.Diagram.html#unBranch"><span class="hs-identifier hs-var">unBranch</span></a></span><span> </span><span class="annot"><span class="annottext">(Shrub a -&gt; [(a, Shrub a)]) -&gt; Shrub a -&gt; [(a, Shrub a)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Shrub a
</span><a href="#local-6989586621679160389"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160393"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="annot"><a href="#local-6989586621679160391"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679160394"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160394"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679160395"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160395"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679160394"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">([(a, Shrub a)] -&gt; Shrub a) -&gt; [(a, Shrub a)] -&gt; Shrub a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [(a, Shrub a)])
-&gt; [(a, Shrub a)] -&gt; [(a, Shrub a)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; [(a, Shrub a)]
</span><a href="#local-6989586621679160391"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679160395"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-417"></span><span>
</span><span id="line-418"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Example expressions
------------------------------------------------------------------------------}</span><span>
</span><span id="line-421"></span><span class="annot"><a href="DeltaQ.Diagram.html#example1"><span class="hs-identifier hs-type">example1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-422"></span><span id="example1"><span class="annot"><span class="annottext">example1 :: O
</span><a href="DeltaQ.Diagram.html#example1"><span class="hs-identifier hs-var hs-var">example1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-423"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AZ&quot;</span></span><span>
</span><span id="line-424"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%2F%5C."><span class="hs-operator hs-var">./\.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AB&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BZ&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BC&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CZ&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span class="annot"><a href="DeltaQ.Diagram.html#example2"><span class="hs-identifier hs-type">example2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-427"></span><span id="example2"><span class="annot"><span class="annottext">example2 :: O
</span><a href="DeltaQ.Diagram.html#example2"><span class="hs-identifier hs-var hs-var">example2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-428"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AB&quot;</span></span><span>
</span><span id="line-429"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BX&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BC&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CX&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;XY&quot;</span></span><span>
</span><span id="line-431"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;YZ&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;YQ&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;QZ&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>
</span><span id="line-433"></span><span class="annot"><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-type">exampleS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-434"></span><span id="exampleS"><span class="annot"><span class="annottext">exampleS :: O
</span><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-var hs-var">exampleS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;S1&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;S2&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;S3&quot;</span></span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span class="annot"><a href="DeltaQ.Diagram.html#example3"><span class="hs-identifier hs-type">example3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-437"></span><span id="example3"><span class="annot"><span class="annottext">example3 :: O
</span><a href="DeltaQ.Diagram.html#example3"><span class="hs-identifier hs-var hs-var">example3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">O
</span><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-var">exampleS</span></a></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">O
</span><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-var">exampleS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="annot"><span class="annottext">O
</span><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-var">exampleS</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">O
</span><a href="DeltaQ.Diagram.html#example1"><span class="hs-identifier hs-var">example1</span></a></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ZQ&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="annot"><a href="DeltaQ.Diagram.html#exampleCache"><span class="hs-identifier hs-type">exampleCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-443"></span><span id="exampleCache"><span class="annot"><span class="annottext">exampleCache :: O
</span><a href="DeltaQ.Diagram.html#exampleCache"><span class="hs-identifier hs-var hs-var">exampleCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#loc"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;read&quot;</span></span><span>
</span><span id="line-445"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">[(Rational, O)] -&gt; O
</span><a href="DeltaQ.Expr.html#choices%27"><span class="hs-identifier hs-var">choices'</span></a></span><span>
</span><span id="line-446"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">95</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c-hit&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#loc"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hit&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c-miss&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#loc"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;miss&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">O
</span><a href="#local-6989586621679160404"><span class="hs-identifier hs-var">net</span></a></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="annot"><span class="annottext">O
</span><a href="#local-6989586621679160405"><span class="hs-identifier hs-var">timeout</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#loc"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-449"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#loc"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;return&quot;</span></span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-451"></span><span>    </span><span id="local-6989586621679160404"><span class="annot"><span class="annottext">net :: O
</span><a href="#local-6989586621679160404"><span class="hs-identifier hs-var hs-var">net</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;net&quot;</span></span><span>
</span><span id="line-452"></span><span>        </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#loc"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mread&quot;</span></span><span>
</span><span id="line-453"></span><span>        </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span>
</span><span id="line-454"></span><span>        </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#loc"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mreturn&quot;</span></span><span>
</span><span id="line-455"></span><span>        </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;net&quot;</span></span><span>
</span><span id="line-456"></span><span>    </span><span id="local-6989586621679160405"><span class="annot"><span class="annottext">timeout :: O
</span><a href="#local-6989586621679160405"><span class="hs-identifier hs-var hs-var">timeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;t-out&quot;</span></span><span>
</span><span id="line-457"></span></pre></body></html>