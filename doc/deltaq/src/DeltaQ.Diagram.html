<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">{-|
Copyright   : PLWORKZ R&amp;D, 2025
License     : BSD-3-Clause
Description : Render outcome diagrams.

Render outcome expressions as outcome diagrams.
-}</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html"><span class="hs-identifier">DeltaQ.Diagram</span></a></span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Outcome diagrams</span></span><span>
</span><span id="line-13"></span><span>      </span><span class="annot"><a href="DeltaQ.Diagram.html#renderOutcomeDiagram"><span class="hs-identifier">renderOutcomeDiagram</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="DeltaQ.Class.html"><span class="hs-identifier">DeltaQ.Class</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Outcome"><span class="hs-identifier">Outcome</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html"><span class="hs-identifier">DeltaQ.Expr</span></a></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier">O</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier">Term</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#choices%27"><span class="hs-identifier">choices'</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#isSeq"><span class="hs-identifier">isSeq</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#isVar"><span class="hs-identifier">isVar</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#outcomeFromTerm"><span class="hs-identifier">outcomeFromTerm</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#termFromOutcome"><span class="hs-identifier">termFromOutcome</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#var"><span class="hs-identifier">var</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Diagrams.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">First</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Last</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">op</span></span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Diagrams.Backend.SVG</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Printf</span></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">printf</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="annot"><a href="DeltaQ.Diagram.html#out"><span class="hs-identifier hs-type">out</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span id="out"><span class="annot"><span class="annottext">out :: O -&gt; IO ()
</span><a href="DeltaQ.Diagram.html#out"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SizeSpec V2 Double -&gt; QDiagram SVG V2 Double Any -&gt; IO ()
forall n.
SVGFloat n =&gt;
String -&gt; SizeSpec V2 n -&gt; QDiagram SVG V2 n Any -&gt; IO ()
</span><span class="hs-identifier hs-var">renderSVG</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;xoutcomes.svg&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; SizeSpec V2 Double
forall n. Num n =&gt; n -&gt; SizeSpec V2 n
</span><span class="hs-identifier hs-var">mkWidth</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">700</span></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="annottext">(QDiagram SVG V2 Double Any -&gt; IO ())
-&gt; (O -&gt; QDiagram SVG V2 Double Any) -&gt; O -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; Diagram SVG
O -&gt; QDiagram SVG V2 Double Any
</span><a href="DeltaQ.Diagram.html#renderOutcomeDiagram"><span class="hs-identifier hs-var">renderOutcomeDiagram</span></a></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="annot"><span class="hs-comment">-- | Render an outcome expression as an outcome diagram.</span></span><span>
</span><span id="line-41"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderOutcomeDiagram"><span class="hs-identifier hs-type">renderOutcomeDiagram</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diagram</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span>
</span><span id="line-42"></span><span id="renderOutcomeDiagram"><span class="annot"><span class="annottext">renderOutcomeDiagram :: O -&gt; Diagram SVG
</span><a href="DeltaQ.Diagram.html#renderOutcomeDiagram"><span class="hs-identifier hs-var hs-var">renderOutcomeDiagram</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Tile] -&gt; Diagram SVG
[Tile] -&gt; QDiagram SVG V2 Double Any
</span><a href="DeltaQ.Diagram.html#renderTiles"><span class="hs-identifier hs-var">renderTiles</span></a></span><span> </span><span class="annot"><span class="annottext">([Tile] -&gt; QDiagram SVG V2 Double Any)
-&gt; (O -&gt; [Tile]) -&gt; O -&gt; QDiagram SVG V2 Double Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; [Tile]
</span><a href="DeltaQ.Diagram.html#layout"><span class="hs-identifier hs-var">layout</span></a></span><span> </span><span class="annot"><span class="annottext">(Term String -&gt; [Tile]) -&gt; (O -&gt; Term String) -&gt; O -&gt; [Tile]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; Term String
</span><a href="DeltaQ.Expr.html#termFromOutcome"><span class="hs-identifier hs-var">termFromOutcome</span></a></span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Diagram rendering
------------------------------------------------------------------------------}</span><span>
</span><span id="line-47"></span><span class="hs-keyword">type</span><span> </span><span id="X"><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-var">X</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">type</span><span> </span><span id="Y"><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-var">Y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">type</span><span> </span><span id="Prob"><span class="annot"><a href="DeltaQ.Diagram.html#Prob"><span class="hs-identifier hs-var">Prob</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-keyword">data</span><span> </span><span id="Op"><span class="annot"><a href="DeltaQ.Diagram.html#Op"><span class="hs-identifier hs-var">Op</span></a></span></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="OFirst"><span class="annot"><a href="DeltaQ.Diagram.html#OFirst"><span class="hs-identifier hs-var">OFirst</span></a></span></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="OLast"><span class="annot"><a href="DeltaQ.Diagram.html#OLast"><span class="hs-identifier hs-var">OLast</span></a></span></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="OChoices"><span class="annot"><a href="DeltaQ.Diagram.html#OChoices"><span class="hs-identifier hs-var">OChoices</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Prob"><span class="hs-identifier hs-type">Prob</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158187"><span id="local-6989586621679158195"><span class="annot"><span class="annottext">Op -&gt; Op -&gt; Bool
(Op -&gt; Op -&gt; Bool) -&gt; (Op -&gt; Op -&gt; Bool) -&gt; Eq Op
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Op -&gt; Op -&gt; Bool
== :: Op -&gt; Op -&gt; Bool
$c/= :: Op -&gt; Op -&gt; Bool
/= :: Op -&gt; Op -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158205"><span id="local-6989586621679158209"><span id="local-6989586621679158212"><span id="local-6989586621679158216"><span id="local-6989586621679158219"><span id="local-6989586621679158222"><span id="local-6989586621679158225"><span class="annot"><span class="annottext">Eq Op
Eq Op =&gt;
(Op -&gt; Op -&gt; Ordering)
-&gt; (Op -&gt; Op -&gt; Bool)
-&gt; (Op -&gt; Op -&gt; Bool)
-&gt; (Op -&gt; Op -&gt; Bool)
-&gt; (Op -&gt; Op -&gt; Bool)
-&gt; (Op -&gt; Op -&gt; Op)
-&gt; (Op -&gt; Op -&gt; Op)
-&gt; Ord Op
Op -&gt; Op -&gt; Bool
Op -&gt; Op -&gt; Ordering
Op -&gt; Op -&gt; Op
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Op -&gt; Op -&gt; Ordering
compare :: Op -&gt; Op -&gt; Ordering
$c&lt; :: Op -&gt; Op -&gt; Bool
&lt; :: Op -&gt; Op -&gt; Bool
$c&lt;= :: Op -&gt; Op -&gt; Bool
&lt;= :: Op -&gt; Op -&gt; Bool
$c&gt; :: Op -&gt; Op -&gt; Bool
&gt; :: Op -&gt; Op -&gt; Bool
$c&gt;= :: Op -&gt; Op -&gt; Bool
&gt;= :: Op -&gt; Op -&gt; Bool
$cmax :: Op -&gt; Op -&gt; Op
max :: Op -&gt; Op -&gt; Op
$cmin :: Op -&gt; Op -&gt; Op
min :: Op -&gt; Op -&gt; Op
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158233"><span id="local-6989586621679158239"><span id="local-6989586621679158243"><span class="annot"><span class="annottext">Int -&gt; Op -&gt; ShowS
[Op] -&gt; ShowS
Op -&gt; String
(Int -&gt; Op -&gt; ShowS)
-&gt; (Op -&gt; String) -&gt; ([Op] -&gt; ShowS) -&gt; Show Op
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Op -&gt; ShowS
showsPrec :: Int -&gt; Op -&gt; ShowS
$cshow :: Op -&gt; String
show :: Op -&gt; String
$cshowList :: [Op] -&gt; ShowS
showList :: [Op] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span>
</span><span id="line-57"></span><span class="annot"><span class="hs-comment">-- | Data attached to a 'Tile'.</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">data</span><span> </span><span id="Token"><span class="annot"><a href="DeltaQ.Diagram.html#Token"><span class="hs-identifier hs-var">Token</span></a></span></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="VarT"><span class="annot"><a href="DeltaQ.Diagram.html#VarT"><span class="hs-identifier hs-var">VarT</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Horizontal"><span class="annot"><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Close"><span class="annot"><a href="DeltaQ.Diagram.html#Close"><span class="hs-identifier hs-var">Close</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-type">Y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Open"><span class="annot"><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-var">Open</span></a></span></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-type">Y</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158256"><span id="local-6989586621679158266"><span class="annot"><span class="annottext">Token -&gt; Token -&gt; Bool
(Token -&gt; Token -&gt; Bool) -&gt; (Token -&gt; Token -&gt; Bool) -&gt; Eq Token
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Token -&gt; Token -&gt; Bool
== :: Token -&gt; Token -&gt; Bool
$c/= :: Token -&gt; Token -&gt; Bool
/= :: Token -&gt; Token -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158274"><span id="local-6989586621679158281"><span id="local-6989586621679158285"><span id="local-6989586621679158288"><span id="local-6989586621679158291"><span id="local-6989586621679158294"><span id="local-6989586621679158297"><span class="annot"><span class="annottext">Eq Token
Eq Token =&gt;
(Token -&gt; Token -&gt; Ordering)
-&gt; (Token -&gt; Token -&gt; Bool)
-&gt; (Token -&gt; Token -&gt; Bool)
-&gt; (Token -&gt; Token -&gt; Bool)
-&gt; (Token -&gt; Token -&gt; Bool)
-&gt; (Token -&gt; Token -&gt; Token)
-&gt; (Token -&gt; Token -&gt; Token)
-&gt; Ord Token
Token -&gt; Token -&gt; Bool
Token -&gt; Token -&gt; Ordering
Token -&gt; Token -&gt; Token
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Token -&gt; Token -&gt; Ordering
compare :: Token -&gt; Token -&gt; Ordering
$c&lt; :: Token -&gt; Token -&gt; Bool
&lt; :: Token -&gt; Token -&gt; Bool
$c&lt;= :: Token -&gt; Token -&gt; Bool
&lt;= :: Token -&gt; Token -&gt; Bool
$c&gt; :: Token -&gt; Token -&gt; Bool
&gt; :: Token -&gt; Token -&gt; Bool
$c&gt;= :: Token -&gt; Token -&gt; Bool
&gt;= :: Token -&gt; Token -&gt; Bool
$cmax :: Token -&gt; Token -&gt; Token
max :: Token -&gt; Token -&gt; Token
$cmin :: Token -&gt; Token -&gt; Token
min :: Token -&gt; Token -&gt; Token
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158301"><span id="local-6989586621679158312"><span id="local-6989586621679158316"><span class="annot"><span class="annottext">Int -&gt; Token -&gt; ShowS
[Token] -&gt; ShowS
Token -&gt; String
(Int -&gt; Token -&gt; ShowS)
-&gt; (Token -&gt; String) -&gt; ([Token] -&gt; ShowS) -&gt; Show Token
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Token -&gt; ShowS
showsPrec :: Int -&gt; Token -&gt; ShowS
$cshow :: Token -&gt; String
show :: Token -&gt; String
$cshowList :: [Token] -&gt; ShowS
showList :: [Token] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-keyword">data</span><span> </span><span id="Tile"><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Tile"><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-type">Y</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158321"><span id="local-6989586621679158326"><span class="annot"><span class="annottext">Tile -&gt; Tile -&gt; Bool
(Tile -&gt; Tile -&gt; Bool) -&gt; (Tile -&gt; Tile -&gt; Bool) -&gt; Eq Tile
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Tile -&gt; Tile -&gt; Bool
== :: Tile -&gt; Tile -&gt; Bool
$c/= :: Tile -&gt; Tile -&gt; Bool
/= :: Tile -&gt; Tile -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158332"><span id="local-6989586621679158337"><span id="local-6989586621679158342"><span id="local-6989586621679158346"><span id="local-6989586621679158349"><span id="local-6989586621679158352"><span id="local-6989586621679158355"><span class="annot"><span class="annottext">Eq Tile
Eq Tile =&gt;
(Tile -&gt; Tile -&gt; Ordering)
-&gt; (Tile -&gt; Tile -&gt; Bool)
-&gt; (Tile -&gt; Tile -&gt; Bool)
-&gt; (Tile -&gt; Tile -&gt; Bool)
-&gt; (Tile -&gt; Tile -&gt; Bool)
-&gt; (Tile -&gt; Tile -&gt; Tile)
-&gt; (Tile -&gt; Tile -&gt; Tile)
-&gt; Ord Tile
Tile -&gt; Tile -&gt; Bool
Tile -&gt; Tile -&gt; Ordering
Tile -&gt; Tile -&gt; Tile
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Tile -&gt; Tile -&gt; Ordering
compare :: Tile -&gt; Tile -&gt; Ordering
$c&lt; :: Tile -&gt; Tile -&gt; Bool
&lt; :: Tile -&gt; Tile -&gt; Bool
$c&lt;= :: Tile -&gt; Tile -&gt; Bool
&lt;= :: Tile -&gt; Tile -&gt; Bool
$c&gt; :: Tile -&gt; Tile -&gt; Bool
&gt; :: Tile -&gt; Tile -&gt; Bool
$c&gt;= :: Tile -&gt; Tile -&gt; Bool
&gt;= :: Tile -&gt; Tile -&gt; Bool
$cmax :: Tile -&gt; Tile -&gt; Tile
max :: Tile -&gt; Tile -&gt; Tile
$cmin :: Tile -&gt; Tile -&gt; Tile
min :: Tile -&gt; Tile -&gt; Tile
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158358"><span id="local-6989586621679158364"><span id="local-6989586621679158368"><span class="annot"><span class="annottext">Int -&gt; Tile -&gt; ShowS
[Tile] -&gt; ShowS
Tile -&gt; String
(Int -&gt; Tile -&gt; ShowS)
-&gt; (Tile -&gt; String) -&gt; ([Tile] -&gt; ShowS) -&gt; Show Tile
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Tile -&gt; ShowS
showsPrec :: Int -&gt; Tile -&gt; ShowS
$cshow :: Tile -&gt; String
show :: Tile -&gt; String
$cshowList :: [Tile] -&gt; ShowS
showList :: [Tile] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><span class="hs-comment">-- | Render a collection of tiles.</span></span><span>
</span><span id="line-69"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderTiles"><span class="hs-identifier hs-type">renderTiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diagram</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span>
</span><span id="line-70"></span><span id="renderTiles"><span class="annot"><span class="annottext">renderTiles :: [Tile] -&gt; Diagram SVG
</span><a href="DeltaQ.Diagram.html#renderTiles"><span class="hs-identifier hs-var hs-var">renderTiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall (v :: * -&gt; *) n m b.
(Metric v, OrderedField n, Monoid' m) =&gt;
n -&gt; QDiagram b v n m -&gt; QDiagram b v n m
</span><span class="hs-identifier hs-var">frame</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span> </span><span class="annot"><span class="annottext">(QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; ([Tile] -&gt; QDiagram SVG V2 Double Any)
-&gt; [Tile]
-&gt; QDiagram SVG V2 Double Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Point V2 Double, QDiagram SVG V2 Double Any)]
-&gt; QDiagram SVG V2 Double Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, HasOrigin a, Monoid' a) =&gt;
[(Point v n, a)] -&gt; a
</span><span class="hs-identifier hs-var">position</span></span><span> </span><span class="annot"><span class="annottext">([(Point V2 Double, QDiagram SVG V2 Double Any)]
 -&gt; QDiagram SVG V2 Double Any)
-&gt; ([Tile] -&gt; [(Point V2 Double, QDiagram SVG V2 Double Any)])
-&gt; [Tile]
-&gt; QDiagram SVG V2 Double Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Tile -&gt; (Point V2 Double, QDiagram SVG V2 Double Any))
-&gt; [Tile] -&gt; [(Point V2 Double, QDiagram SVG V2 Double Any)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Tile -&gt; (Point V2 Double, QDiagram SVG V2 Double Any)
forall {n}. Num n =&gt; Tile -&gt; (P2 n, QDiagram SVG V2 Double Any)
</span><a href="#local-6989586621679158372"><span class="hs-identifier hs-var">renderTile</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679158372"><span class="annot"><span class="annottext">renderTile :: Tile -&gt; (P2 n, QDiagram SVG V2 Double Any)
</span><a href="#local-6989586621679158372"><span class="hs-identifier hs-var hs-var">renderTile</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span> </span><span id="local-6989586621679158379"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158379"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679158380"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158380"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679158381"><span class="annot"><span class="annottext">Token
</span><a href="#local-6989586621679158381"><span class="hs-identifier hs-var">token</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-73"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; n
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158379"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n -&gt; n
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span> </span><span class="annot"><span class="annottext">(n -&gt; n) -&gt; n -&gt; n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; n
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158380"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Token -&gt; Diagram SVG
</span><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="#local-6989586621679158381"><span class="hs-identifier hs-var">token</span></a></span><span>
</span><span id="line-75"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="annot"><span class="hs-comment">-- | Render a single 'Token' associated with a 'Tile'.</span></span><span>
</span><span id="line-78"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-type">renderToken</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Token"><span class="hs-identifier hs-type">Token</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diagram</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span>
</span><span id="line-79"></span><span id="renderToken"><span class="annot"><span class="annottext">renderToken :: Token -&gt; Diagram SVG
</span><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var hs-var">renderToken</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#VarT"><span class="hs-identifier hs-type">VarT</span></a></span><span> </span><span id="local-6989586621679158384"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679158384"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, Eq n, Fractional n, Transformable a) =&gt;
n -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">scale</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Text n) b) =&gt;
String -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679158384"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall t n.
(TrailLike t, V t ~ V2, N t ~ n, Transformable t) =&gt;
n -&gt; t
</span><span class="hs-identifier hs-var">circle</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.44</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall n a.
(InSpace V2 n a, Typeable n, Floating n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">lc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">orange</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Measure Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a n.
(N a ~ n, HasStyle a, Typeable n) =&gt;
Measure n -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">lw</span></span><span> </span><span class="annot"><span class="annottext">Measure Double
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall n a.
(InSpace V2 n a, Floating n, Typeable n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">fc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">white</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">hrule</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-83"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">hrule</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-84"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Close"><span class="hs-identifier hs-type">Close</span></a></span><span> </span><span id="local-6989586621679158395"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679158395"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="annottext">[QDiagram SVG V2 Double Any] -&gt; QDiagram SVG V2 Double Any
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; QDiagram SVG V2 Double Any)
-&gt; [Int] -&gt; [QDiagram SVG V2 Double Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall {n} {b}.
(Typeable n, RealFloat n, Renderable (Path V2 n) b) =&gt;
n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679158396"><span class="hs-identifier hs-var">renderLine</span></a></span><span> </span><span class="annot"><span class="annottext">(Double -&gt; QDiagram SVG V2 Double Any)
-&gt; (Int -&gt; Double) -&gt; Int -&gt; QDiagram SVG V2 Double Any
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double) -&gt; (Int -&gt; Int) -&gt; Int -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679158395"><span class="hs-identifier hs-var">ds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">hrule</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-88"></span><span>    </span><span id="local-6989586621679158396"><span class="annot"><span class="annottext">renderLine :: n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679158396"><span class="hs-identifier hs-var hs-var">renderLine</span></a></span></span><span> </span><span id="local-6989586621679158452"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679158452"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point (V (Trail' Line V2 n)) (N (Trail' Line V2 n))]
-&gt; Trail' Line V2 n
forall t. TrailLike t =&gt; [Point (V t) (N t)] -&gt; t
</span><span class="hs-identifier hs-var">fromVertices</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679158452"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 n
-&gt; (Trail' Line V2 n -&gt; QDiagram b V2 n Any) -&gt; QDiagram b V2 n Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 n -&gt; QDiagram b V2 n Any
forall n b.
(TypeableFloat n, Renderable (Path V2 n) b) =&gt;
Trail' Line V2 n -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">strokeLine</span></span><span>
</span><span id="line-89"></span><span class="annot"><a href="DeltaQ.Diagram.html#renderToken"><span class="hs-identifier hs-var">renderToken</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-type">Open</span></a></span><span> </span><span id="local-6989586621679158455"><span class="annot"><span class="annottext">Op
</span><a href="#local-6989586621679158455"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621679158456"><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679158456"><span class="hs-identifier hs-var">ds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, Eq n, Fractional n, Transformable a) =&gt;
n -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">scale</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Op -&gt; Diagram SVG
</span><a href="#local-6989586621679158457"><span class="hs-identifier hs-var">renderOp</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="#local-6989586621679158455"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">square</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall n a.
(InSpace V2 n a, Floating n, Typeable n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">fc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">white</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[QDiagram SVG V2 Double Any] -&gt; QDiagram SVG V2 Double Any
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double -&gt; QDiagram SVG V2 Double Any)
-&gt; [Double] -&gt; [QDiagram SVG V2 Double Any]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall {n} {b}.
(Typeable n, RealFloat n, Renderable (Path V2 n) b) =&gt;
n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679158459"><span class="hs-identifier hs-var">renderLine</span></a></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679158460"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[QDiagram SVG V2 Double Any] -&gt; QDiagram SVG V2 Double Any
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Op -&gt; [Double] -&gt; [QDiagram SVG V2 Double Any]
forall {b} {b}.
(Typeable b, RealFloat b, Renderable (Text b) b) =&gt;
Op -&gt; [b] -&gt; [QDiagram b V2 b Any]
</span><a href="#local-6989586621679158461"><span class="hs-identifier hs-var">renderLineAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="#local-6989586621679158455"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679158460"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; QDiagram SVG V2 Double Any
forall n t. (InSpace V2 n t, TrailLike t) =&gt; n -&gt; t
</span><span class="hs-identifier hs-var">hrule</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-95"></span><span>    </span><span id="local-6989586621679158460"><span class="annot"><span class="annottext">ys :: [Double]
</span><a href="#local-6989586621679158460"><span class="hs-identifier hs-var hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double) -&gt; [Int] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Double
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Double) -&gt; (Int -&gt; Int) -&gt; Int -&gt; Double
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Num a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">negate</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679158456"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="#local-6989586621679158457"><span class="hs-identifier hs-type">renderOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Op"><span class="hs-identifier hs-type">Op</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Diagram</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SVG</span></span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621679158457"><span class="annot"><span class="annottext">renderOp :: Op -&gt; Diagram SVG
</span><a href="#local-6989586621679158457"><span class="hs-identifier hs-var hs-var">renderOp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="DeltaQ.Diagram.html#OFirst"><span class="hs-identifier hs-var">OFirst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Text n) b) =&gt;
String -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&#8707;&quot;</span></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="#local-6989586621679158457"><span class="hs-identifier hs-var">renderOp</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="DeltaQ.Diagram.html#OLast"><span class="hs-identifier hs-var">OLast</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Text n) b) =&gt;
String -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&#8704;&quot;</span></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="#local-6989586621679158457"><span class="hs-identifier hs-var">renderOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#OChoices"><span class="hs-identifier hs-type">OChoices</span></a></span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-101"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Vn (Trail' Line V2 Double)] -&gt; Trail' Line V2 Double
forall t. TrailLike t =&gt; [Vn t] -&gt; t
</span><span class="hs-identifier hs-var">fromOffsets</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.33</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.15</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span>            </span><span class="annot"><span class="annottext">Trail' Line V2 Double
-&gt; (Trail' Line V2 Double -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 Double -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Path V2 n) b) =&gt;
Trail' Line V2 n -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">strokeLine</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Vn (QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall t. Transformable t =&gt; Vn t -&gt; t -&gt; t
</span><span class="hs-identifier hs-var">translate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-104"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Vn (Trail' Line V2 Double)] -&gt; Trail' Line V2 Double
forall t. TrailLike t =&gt; [Vn t] -&gt; t
</span><span class="hs-identifier hs-var">fromOffsets</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.33</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.6</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.2</span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.15</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-105"></span><span>            </span><span class="annot"><span class="annottext">Trail' Line V2 Double
-&gt; (Trail' Line V2 Double -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 Double -&gt; QDiagram SVG V2 Double Any
forall n b.
(TypeableFloat n, Renderable (Path V2 n) b) =&gt;
Trail' Line V2 n -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">strokeLine</span></span><span> </span><span class="annot"><span class="annottext">QDiagram SVG V2 Double Any
-&gt; (QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Vn (QDiagram SVG V2 Double Any)
-&gt; QDiagram SVG V2 Double Any -&gt; QDiagram SVG V2 Double Any
forall t. Transformable t =&gt; Vn t -&gt; t -&gt; t
</span><span class="hs-identifier hs-var">translate</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double, Double) -&gt; V2 Double
forall n. (n, n) -&gt; V2 n
</span><span class="hs-identifier hs-var">r2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0.1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span>    </span><span id="local-6989586621679158459"><span class="annot"><span class="annottext">renderLine :: n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679158459"><span class="hs-identifier hs-var hs-var">renderLine</span></a></span></span><span> </span><span id="local-6989586621679158512"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679158512"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Point (V (Trail' Line V2 n)) (N (Trail' Line V2 n))]
-&gt; Trail' Line V2 n
forall t. TrailLike t =&gt; [Point (V t) (N t)] -&gt; t
</span><span class="hs-identifier hs-var">fromVertices</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679158512"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 n
-&gt; (Trail' Line V2 n -&gt; QDiagram b V2 n Any) -&gt; QDiagram b V2 n Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Trail' Line V2 n -&gt; QDiagram b V2 n Any
forall n b.
(TypeableFloat n, Renderable (Path V2 n) b) =&gt;
Trail' Line V2 n -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">strokeLine</span></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679158461"><span class="annot"><span class="annottext">renderLineAnnotations :: Op -&gt; [b] -&gt; [QDiagram b V2 b Any]
</span><a href="#local-6989586621679158461"><span class="hs-identifier hs-var hs-var">renderLineAnnotations</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#OChoices"><span class="hs-identifier hs-type">OChoices</span></a></span><span> </span><span id="local-6989586621679158539"><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679158539"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679158540"><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679158540"><span class="hs-identifier hs-var">ys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-110"></span><span>        </span><span class="annot"><span class="annottext">(Rational -&gt; b -&gt; QDiagram b V2 b Any)
-&gt; [Rational] -&gt; [b] -&gt; [QDiagram b V2 b Any]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; b -&gt; QDiagram b V2 b Any
forall {n} {b}.
(Typeable n, RealFloat n, Renderable (Text n) b) =&gt;
Rational -&gt; n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679158542"><span class="hs-identifier hs-var">renderLineAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679158543"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">[b]
</span><a href="#local-6989586621679158540"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-112"></span><span>        </span><span id="local-6989586621679158543"><span class="annot"><span class="annottext">ps :: [Rational]
</span><a href="#local-6989586621679158543"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Rational) -&gt; [Rational] -&gt; [Rational]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">[Rational] -&gt; Rational
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679158539"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679158539"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="#local-6989586621679158461"><span class="hs-identifier hs-var">renderLineAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[b]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679158562"><span class="annot"><span class="annottext">posLineAnnotation :: p -&gt; n -&gt; P2 n
</span><a href="#local-6989586621679158562"><span class="hs-identifier hs-var hs-var">posLineAnnotation</span></a></span></span><span> </span><span id="local-6989586621679158563"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679158563"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.3</span></span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span>    </span><span class="annot"><a href="#local-6989586621679158562"><span class="hs-identifier hs-var">posLineAnnotation</span></a></span><span> </span><span id="local-6989586621679158564"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679158564"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679158565"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679158565"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(n, n) -&gt; P2 n
forall n. (n, n) -&gt; P2 n
</span><span class="hs-identifier hs-var">p2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.1</span></span><span> </span><span class="annot"><span class="annottext">n -&gt; n -&gt; n
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679158565"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>    </span><span id="local-6989586621679158542"><span class="annot"><span class="annottext">renderLineAnnotation :: Rational -&gt; n -&gt; QDiagram b V2 n Any
</span><a href="#local-6989586621679158542"><span class="hs-identifier hs-var hs-var">renderLineAnnotation</span></a></span></span><span> </span><span id="local-6989586621679158633"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679158633"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679158634"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679158634"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="annottext">[(Point V2 n, QDiagram b V2 n Any)] -&gt; QDiagram b V2 n Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, HasOrigin a, Monoid' a) =&gt;
[(Point v n, a)] -&gt; a
</span><span class="hs-identifier hs-var">position</span></span><span>
</span><span id="line-119"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational -&gt; n -&gt; Point V2 n
forall {n} {p}. (Eq n, Fractional n) =&gt; p -&gt; n -&gt; P2 n
</span><a href="#local-6989586621679158562"><span class="hs-identifier hs-var">posLineAnnotation</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679158633"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679158634"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-120"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">n -&gt; QDiagram b V2 n Any -&gt; QDiagram b V2 n Any
forall (v :: * -&gt; *) n a.
(InSpace v n a, Eq n, Fractional n, Transformable a) =&gt;
n -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">scale</span></span><span> </span><span class="annot"><span class="annottext">n
</span><span class="hs-number">0.2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; QDiagram b V2 n Any
forall n b.
(TypeableFloat n, Renderable (Text n) b) =&gt;
String -&gt; QDiagram b V2 n Any
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; QDiagram b V2 n Any) -&gt; String -&gt; QDiagram b V2 n Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; String
</span><a href="DeltaQ.Diagram.html#showProb"><span class="hs-identifier hs-var">showProb</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679158633"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QDiagram b V2 n Any
-&gt; (QDiagram b V2 n Any -&gt; QDiagram b V2 n Any)
-&gt; QDiagram b V2 n Any
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Colour Double -&gt; QDiagram b V2 n Any -&gt; QDiagram b V2 n Any
forall n a.
(InSpace V2 n a, Floating n, Typeable n, HasStyle a) =&gt;
Colour Double -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">fc</span></span><span> </span><span class="annot"><span class="annottext">Colour Double
forall a. (Ord a, Floating a) =&gt; Colour a
</span><span class="hs-identifier hs-var">teal</span></span><span>
</span><span id="line-121"></span><span>            </span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><span class="hs-comment">-- | Show a probability in scientific notation with two digits of precision.</span></span><span>
</span><span id="line-124"></span><span class="annot"><a href="DeltaQ.Diagram.html#showProb"><span class="hs-identifier hs-type">showProb</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-125"></span><span id="showProb"><span class="annot"><span class="annottext">showProb :: Rational -&gt; String
</span><a href="DeltaQ.Diagram.html#showProb"><span class="hs-identifier hs-var hs-var">showProb</span></a></span></span><span> </span><span id="local-6989586621679158637"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679158637"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679158637"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">0.01</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Double -&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;%.2f&quot;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679158638"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Double -&gt; String
forall r. PrintfType r =&gt; String -&gt; r
</span><span class="hs-identifier hs-var">printf</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;%.2e\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679158638"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679158638"><span class="annot"><span class="annottext">x :: Double
</span><a href="#local-6989586621679158638"><span class="hs-identifier hs-var hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Double
forall a. Fractional a =&gt; Rational -&gt; a
</span><span class="hs-identifier hs-var">fromRational</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679158637"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Diagram Layout
------------------------------------------------------------------------------}</span><span>
</span><span id="line-134"></span><span class="hs-comment">{- Note [LayoutComputation]

In order to compute the layout for an outcome diagram,
we use a data structure called 'Shrub', which is a tree with labels
on the edges (as opposed to on the leaves).
The 'Shrub' represents the data that we still need to layout,
we think of the leaves as being located to the left,
and the root to the right, like this:

 leaf
 o----
      \
       o----o----o root
      /
 o----

-}</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">type</span><span> </span><span id="EdgeData"><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-var">EdgeData</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Y"><span class="hs-identifier hs-type">Y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><span class="hs-comment">-- | Layout an outcome diagram.</span></span><span>
</span><span id="line-155"></span><span class="annot"><a href="DeltaQ.Diagram.html#layout"><span class="hs-identifier hs-type">layout</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-156"></span><span id="layout"><span class="annot"><span class="annottext">layout :: Term String -&gt; [Tile]
</span><a href="DeltaQ.Diagram.html#layout"><span class="hs-identifier hs-var hs-var">layout</span></a></span></span><span> </span><span id="local-6989586621679158640"><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679158640"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Shrub EdgeData -&gt; [Tile]
</span><a href="#local-6989586621679158641"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; [Tile]) -&gt; Shrub EdgeData -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Maybe (Term String)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Term String
</span><a href="#local-6989586621679158640"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679158641"><span class="annot"><span class="annottext">go :: Int -&gt; Shrub EdgeData -&gt; [Tile]
</span><a href="#local-6989586621679158641"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679158644"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158644"><span class="hs-identifier hs-var">x0</span></a></span></span><span> </span><span id="local-6989586621679158645"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158645"><span class="hs-identifier hs-var">s0</span></a></span></span><span>
</span><span id="line-159"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158645"><span class="hs-identifier hs-var">s0</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Tile]
</span><a href="#local-6989586621679158647"><span class="hs-identifier hs-var">tiles</span></a></span><span> </span><span class="annot"><span class="annottext">[Tile] -&gt; [Tile] -&gt; [Tile]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Shrub EdgeData -&gt; [Tile]
</span><a href="#local-6989586621679158641"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158648"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158649"><span class="hs-identifier hs-var">s1</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-162"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679158647"><span class="annot"><span class="annottext">[Tile]
</span><a href="#local-6989586621679158647"><span class="hs-identifier hs-var">tiles</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158649"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158649"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitColumn"><span class="hs-identifier hs-var">emitColumn</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158644"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158645"><span class="hs-identifier hs-var">s0</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span id="local-6989586621679158648"><span class="annot"><span class="annottext">x1 :: Int
</span><a href="#local-6989586621679158648"><span class="hs-identifier hs-var hs-var">x1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Tile] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Tile]
</span><a href="#local-6989586621679158647"><span class="hs-identifier hs-var">tiles</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158644"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158644"><span class="hs-identifier hs-var">x0</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><span class="hs-comment">-- | Emit the next column, possible empty.</span></span><span>
</span><span id="line-166"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitColumn"><span class="hs-identifier hs-type">emitColumn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span id="emitColumn"><span class="annot"><span class="annottext">emitColumn :: Int -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitColumn"><span class="hs-identifier hs-var hs-var">emitColumn</span></a></span></span><span> </span><span id="local-6989586621679158655"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158655"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679158656"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term String -&gt; Bool) -&gt; EdgeData -&gt; Bool
forall {t} {a}. (t -&gt; Bool) -&gt; (a, Maybe t) -&gt; Bool
</span><a href="#local-6989586621679158658"><span class="hs-identifier hs-var">onExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Expr.html#isSeq"><span class="hs-identifier hs-var">isSeq</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#expandSeq"><span class="hs-identifier hs-var">expandSeq</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#hasIsolatedTwigs"><span class="hs-identifier hs-var">hasIsolatedTwigs</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-var">dropIsolatedTwigs</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#hasGroupClose"><span class="hs-identifier hs-var">hasGroupClose</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitGroupClose"><span class="hs-identifier hs-var">emitGroupClose</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158655"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term String -&gt; Bool) -&gt; EdgeData -&gt; Bool
forall {t} {a}. (t -&gt; Bool) -&gt; (a, Maybe t) -&gt; Bool
</span><a href="#local-6989586621679158658"><span class="hs-identifier hs-var">onExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var">isVertical</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitParallel"><span class="hs-identifier hs-var">emitParallel</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158655"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term String -&gt; Bool) -&gt; EdgeData -&gt; Bool
forall {t} {a}. (t -&gt; Bool) -&gt; (a, Maybe t) -&gt; Bool
</span><a href="#local-6989586621679158658"><span class="hs-identifier hs-var">onExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Term String -&gt; Bool
forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Expr.html#isVar"><span class="hs-identifier hs-var">isVar</span></a></span><span class="hs-special">)</span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitVar"><span class="hs-identifier hs-var">emitVar</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158655"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158656"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ([Tile], Shrub EdgeData)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;emitColumn: unreachable&quot;</span></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-175"></span><span>    </span><span id="local-6989586621679158658"><span class="annot"><span class="annottext">onExpr :: (t -&gt; Bool) -&gt; (a, Maybe t) -&gt; Bool
</span><a href="#local-6989586621679158658"><span class="hs-identifier hs-var hs-var">onExpr</span></a></span></span><span> </span><span id="local-6989586621679158669"><span class="annot"><span class="annottext">t -&gt; Bool
</span><a href="#local-6989586621679158669"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679158670"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679158670"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; Bool
</span><a href="#local-6989586621679158669"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679158670"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="annot"><a href="#local-6989586621679158658"><span class="hs-identifier hs-var">onExpr</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(a, Maybe t)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span class="annot"><span class="hs-comment">-- | Check that a given 'EdgeData' does not contain a Expr.</span></span><span>
</span><span id="line-179"></span><span class="annot"><a href="DeltaQ.Diagram.html#isSilent"><span class="hs-identifier hs-type">isSilent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-180"></span><span id="isSilent"><span class="annot"><span class="annottext">isSilent :: EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isSilent"><span class="hs-identifier hs-var hs-var">isSilent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Term String)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-181"></span><span class="annot"><a href="DeltaQ.Diagram.html#isSilent"><span class="hs-identifier hs-var">isSilent</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><span class="hs-comment">-- | Expand all 'Seq' in the 'foliage' as a sequence of twigs.</span></span><span>
</span><span id="line-184"></span><span class="annot"><a href="DeltaQ.Diagram.html#expandSeq"><span class="hs-identifier hs-type">expandSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span>
</span><span id="line-185"></span><span id="expandSeq"><span class="annot"><span class="annottext">expandSeq :: Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#expandSeq"><span class="hs-identifier hs-var hs-var">expandSeq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Shrub EdgeData) -&gt; Shrub EdgeData -&gt; Shrub EdgeData
forall a. (a -&gt; Shrub a) -&gt; Shrub a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var">updateFoliage</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall {a} {v}. (a, Maybe (Term v)) -&gt; Shrub (a, Maybe (Term v))
</span><a href="#local-6989586621679158674"><span class="hs-identifier hs-var">expand</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>    </span><span id="local-6989586621679158674"><span class="annot"><span class="annottext">expand :: (a, Maybe (Term v)) -&gt; Shrub (a, Maybe (Term v))
</span><a href="#local-6989586621679158674"><span class="hs-identifier hs-var hs-var">expand</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158676"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158676"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Seq"><span class="hs-identifier hs-type">Seq</span></a></span><span> </span><span id="local-6989586621679158677"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158677"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-188"></span><span>        </span><span class="annot"><span class="annottext">(Shrub (a, Maybe (Term v)) -&gt; Term v -&gt; Shrub (a, Maybe (Term v)))
-&gt; Shrub (a, Maybe (Term v))
-&gt; [Term v]
-&gt; Shrub (a, Maybe (Term v))
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679158679"><span class="annot"><span class="annottext">Shrub (a, Maybe (Term v))
</span><a href="#local-6989586621679158679"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679158680"><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679158680"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[((a, Maybe (Term v)), Shrub (a, Maybe (Term v)))]
-&gt; Shrub (a, Maybe (Term v))
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158676"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Maybe (Term v)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679158680"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub (a, Maybe (Term v))
</span><a href="#local-6989586621679158679"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Shrub (a, Maybe (Term v))
forall a. Shrub a
</span><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158677"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-189"></span><span>        </span><span class="hs-comment">-- Note: The Seq is left-to-right, but the Shrub is right-to-left.</span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-comment">-- foldl reorders the sequence appropriately.</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="#local-6989586621679158674"><span class="hs-identifier hs-var">expand</span></a></span><span> </span><span id="local-6989586621679158683"><span class="annot"><span class="annottext">(a, Maybe (Term v))
</span><a href="#local-6989586621679158683"><span class="hs-identifier hs-var">edge</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, Maybe (Term v)) -&gt; Shrub (a, Maybe (Term v))
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Maybe (Term v))
</span><a href="#local-6989586621679158683"><span class="hs-identifier hs-var">edge</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="annot"><span class="hs-comment">-- | Emit a column with the next named items.</span></span><span>
</span><span id="line-194"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitVar"><span class="hs-identifier hs-type">emitVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span id="emitVar"><span class="annot"><span class="annottext">emitVar :: Int -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitVar"><span class="hs-identifier hs-var hs-var">emitVar</span></a></span></span><span> </span><span id="local-6989586621679158684"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158684"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679158685"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158685"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EdgeData -&gt; Tile) -&gt; [EdgeData] -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Tile
</span><a href="#local-6989586621679158686"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="annot"><span class="annottext">([EdgeData] -&gt; [Tile]) -&gt; [EdgeData] -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158685"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Shrub EdgeData) -&gt; Shrub EdgeData -&gt; Shrub EdgeData
forall a. (a -&gt; Shrub a) -&gt; Shrub a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var">updateFoliage</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall {a} {v} {a}. (a, Maybe (Term v)) -&gt; Shrub (a, Maybe a)
</span><a href="#local-6989586621679158687"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158685"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679158687"><span class="annot"><span class="annottext">dropit :: (a, Maybe (Term v)) -&gt; Shrub (a, Maybe a)
</span><a href="#local-6989586621679158687"><span class="hs-identifier hs-var hs-var">dropit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158690"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158690"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Term v)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>          </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, Maybe a) -&gt; Shrub (a, Maybe a)
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158690"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="#local-6989586621679158687"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158691"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158691"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, Maybe a) -&gt; Shrub (a, Maybe a)
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158691"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>    </span><span class="annot"><a href="#local-6989586621679158687"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="annot"><span class="annottext">(a, Maybe (Term v))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Shrub (a, Maybe a)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;emitSeq does not expect non-Var Tiles&quot;</span></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621679158686"><span class="annot"><span class="annottext">emit :: EdgeData -&gt; Tile
</span><a href="#local-6989586621679158686"><span class="hs-identifier hs-var hs-var">emit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158695"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158695"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Term String)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>     </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158684"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158695"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="#local-6989586621679158686"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158696"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158696"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621679158697"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679158697"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158684"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158696"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Token
</span><a href="DeltaQ.Diagram.html#VarT"><span class="hs-identifier hs-var">VarT</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679158697"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><a href="#local-6989586621679158686"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Tile
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;emitSeq does not expect non-Var Tiles&quot;</span></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><span class="hs-comment">-- | Emit a column with the next parallel items.</span></span><span>
</span><span id="line-207"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitParallel"><span class="hs-identifier hs-type">emitParallel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span id="emitParallel"><span class="annot"><span class="annottext">emitParallel :: Int -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitParallel"><span class="hs-identifier hs-var hs-var">emitParallel</span></a></span></span><span> </span><span id="local-6989586621679158698"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158698"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679158699"><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158699"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EdgeData -&gt; Tile) -&gt; [EdgeData] -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Tile
forall {v}. (Int, Maybe (Term v)) -&gt; Tile
</span><a href="#local-6989586621679158700"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="annot"><span class="annottext">([EdgeData] -&gt; [Tile]) -&gt; [EdgeData] -&gt; [Tile]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [EdgeData]
forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158699"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Shrub EdgeData) -&gt; Shrub EdgeData -&gt; Shrub EdgeData
forall a. (a -&gt; Shrub a) -&gt; Shrub a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var">updateFoliage</span></a></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall {v}. (Int, Maybe (Term v)) -&gt; Shrub (Int, Maybe (Term v))
</span><a href="#local-6989586621679158701"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><a href="#local-6989586621679158699"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-211"></span><span>    </span><span id="local-6989586621679158701"><span class="annot"><span class="annottext">dropit :: (Int, Maybe (Term v)) -&gt; Shrub (Int, Maybe (Term v))
</span><a href="#local-6989586621679158701"><span class="hs-identifier hs-var hs-var">dropit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158702"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158702"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Term v)
</span><span class="hs-identifier hs-var">Nothing</span></span><span>              </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Maybe (Term v)) -&gt; Shrub (Int, Maybe (Term v))
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158702"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Term v)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><a href="#local-6989586621679158701"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158703"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158703"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Last"><span class="hs-identifier hs-type">Last</span></a></span><span>    </span><span id="local-6989586621679158705"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158705"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Term v] -&gt; Shrub (Int, Maybe (Term v))
forall {v}. Int -&gt; [Term v] -&gt; Shrub (Int, Maybe (Term v))
</span><a href="#local-6989586621679158706"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158703"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158705"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><a href="#local-6989586621679158701"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158707"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158707"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#First"><span class="hs-identifier hs-type">First</span></a></span><span>   </span><span id="local-6989586621679158709"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158709"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Term v] -&gt; Shrub (Int, Maybe (Term v))
forall {v}. Int -&gt; [Term v] -&gt; Shrub (Int, Maybe (Term v))
</span><a href="#local-6989586621679158706"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158707"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158709"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><a href="#local-6989586621679158701"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158710"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158710"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Choices"><span class="hs-identifier hs-type">Choices</span></a></span><span> </span><span id="local-6989586621679158712"><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><a href="#local-6989586621679158712"><span class="hs-identifier hs-var">wexprs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Term v] -&gt; Shrub (Int, Maybe (Term v))
forall {v}. Int -&gt; [Term v] -&gt; Shrub (Int, Maybe (Term v))
</span><a href="#local-6989586621679158706"><span class="hs-identifier hs-var">close</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158710"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Rational, Term v) -&gt; Term v) -&gt; [(Rational, Term v)] -&gt; [Term v]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Rational, Term v) -&gt; Term v
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><a href="#local-6989586621679158712"><span class="hs-identifier hs-var">wexprs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>    </span><span class="annot"><a href="#local-6989586621679158701"><span class="hs-identifier hs-var">dropit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158714"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158714"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679158715"><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679158715"><span class="hs-identifier hs-var">t</span></a></span></span><span>               </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int, Maybe (Term v)) -&gt; Shrub (Int, Maybe (Term v))
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158714"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Maybe (Term v)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679158715"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>    </span><span id="local-6989586621679158706"><span class="annot"><span class="annottext">close :: Int -&gt; [Term v] -&gt; Shrub (Int, Maybe (Term v))
</span><a href="#local-6989586621679158706"><span class="hs-identifier hs-var hs-var">close</span></a></span></span><span> </span><span id="local-6989586621679158716"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158716"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679158717"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158717"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="annottext">[((Int, Maybe (Term v)), Shrub (Int, Maybe (Term v)))]
-&gt; Shrub (Int, Maybe (Term v))
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158716"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (Term v)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[((Int, Maybe (Term v)), Shrub (Int, Maybe (Term v)))]
-&gt; Shrub (Int, Maybe (Term v))
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Maybe (Term v))
</span><a href="#local-6989586621679158718"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub (Int, Maybe (Term v))
forall a. Shrub a
</span><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679158718"><span class="annot"><span class="annottext">(Int, Maybe (Term v))
</span><a href="#local-6989586621679158718"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Term v] -&gt; [(Int, Maybe (Term v))]
forall {v}. Int -&gt; [Term v] -&gt; [(Int, Maybe (Term v))]
</span><a href="#local-6989586621679158719"><span class="hs-identifier hs-var">verticals</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158716"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158717"><span class="hs-identifier hs-var">exprs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-219"></span><span>    </span><span id="local-6989586621679158719"><span class="annot"><span class="annottext">verticals :: Int -&gt; [Term v] -&gt; [(Int, Maybe (Term v))]
</span><a href="#local-6989586621679158719"><span class="hs-identifier hs-var hs-var">verticals</span></a></span></span><span> </span><span id="local-6989586621679158721"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158721"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679158722"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158722"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-220"></span><span>        </span><span class="annot"><span class="annottext">(Int -&gt; Term v -&gt; (Int, Maybe (Term v)))
-&gt; [Int] -&gt; [Term v] -&gt; [(Int, Maybe (Term v))]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679158723"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158723"><span class="hs-identifier hs-var">z</span></a></span></span><span> </span><span id="local-6989586621679158724"><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679158724"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158721"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158723"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Maybe (Term v)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Term v
</span><a href="#local-6989586621679158724"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Term v] -&gt; [Int]
forall {v}. [Term v] -&gt; [Int]
</span><a href="#local-6989586621679158725"><span class="hs-identifier hs-var">distances</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158722"><span class="hs-identifier hs-var">exprs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158722"><span class="hs-identifier hs-var">exprs</span></a></span><span> </span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621679158725"><span class="annot"><span class="annottext">distances :: [Term v] -&gt; [Int]
</span><a href="#local-6989586621679158725"><span class="hs-identifier hs-var hs-var">distances</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int]
forall a. HasCallStack =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">init</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; ([Term v] -&gt; [Int]) -&gt; [Term v] -&gt; [Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; Int -&gt; [Int] -&gt; [Int]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">scanl</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; ([Term v] -&gt; [Int]) -&gt; [Term v] -&gt; [Int]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Int) -&gt; [Term v] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Int
forall v. Term v -&gt; Int
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679158700"><span class="annot"><span class="annottext">emit :: (Int, Maybe (Term v)) -&gt; Tile
</span><a href="#local-6989586621679158700"><span class="hs-identifier hs-var hs-var">emit</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158733"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158733"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Last"><span class="hs-identifier hs-type">Last</span></a></span><span>    </span><span id="local-6989586621679158734"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158734"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-224"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158698"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158733"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Tile) -&gt; Token -&gt; Tile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op -&gt; [Int] -&gt; Token
</span><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-var">Open</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="DeltaQ.Diagram.html#OLast"><span class="hs-identifier hs-var">OLast</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Token) -&gt; [Int] -&gt; Token
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term v] -&gt; [Int]
forall {v}. [Term v] -&gt; [Int]
</span><a href="#local-6989586621679158725"><span class="hs-identifier hs-var">distances</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158734"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><a href="#local-6989586621679158700"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158735"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158735"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#First"><span class="hs-identifier hs-type">First</span></a></span><span>   </span><span id="local-6989586621679158736"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158736"><span class="hs-identifier hs-var">exprs</span></a></span></span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158698"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158735"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Tile) -&gt; Token -&gt; Tile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op -&gt; [Int] -&gt; Token
</span><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-var">Open</span></a></span><span> </span><span class="annot"><span class="annottext">Op
</span><a href="DeltaQ.Diagram.html#OFirst"><span class="hs-identifier hs-var">OFirst</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Token) -&gt; [Int] -&gt; Token
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term v] -&gt; [Int]
forall {v}. [Term v] -&gt; [Int]
</span><a href="#local-6989586621679158725"><span class="hs-identifier hs-var">distances</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158736"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><a href="#local-6989586621679158700"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158737"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158737"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Choices"><span class="hs-identifier hs-type">Choices</span></a></span><span> </span><span id="local-6989586621679158738"><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><a href="#local-6989586621679158738"><span class="hs-identifier hs-var">wexprs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-228"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158698"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158737"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Tile) -&gt; Token -&gt; Tile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Op -&gt; [Int] -&gt; Token
</span><a href="DeltaQ.Diagram.html#Open"><span class="hs-identifier hs-var">Open</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Rational] -&gt; Op
</span><a href="DeltaQ.Diagram.html#OChoices"><span class="hs-identifier hs-var">OChoices</span></a></span><span> </span><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679158739"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Token) -&gt; [Int] -&gt; Token
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Term v] -&gt; [Int]
forall {v}. [Term v] -&gt; [Int]
</span><a href="#local-6989586621679158725"><span class="hs-identifier hs-var">distances</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158740"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-229"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158739"><span class="annot"><span class="annottext">[Rational]
</span><a href="#local-6989586621679158739"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158740"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158740"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Rational, Term v)] -&gt; ([Rational], [Term v])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><a href="#local-6989586621679158738"><span class="hs-identifier hs-var">wexprs</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><a href="#local-6989586621679158700"><span class="hs-identifier hs-var">emit</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158742"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158742"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Term v)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158698"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158742"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="annot"><span class="hs-comment">-- | Outcomes that open a new vertical.</span></span><span>
</span><span id="line-233"></span><span id="local-6989586621679158743"><span class="annot"><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-type">isVertical</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679158743"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-234"></span><span id="isVertical"><span class="annot"><span class="annottext">isVertical :: forall v. Term v -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var hs-var">isVertical</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Last"><span class="hs-identifier hs-type">Last</span></a></span><span>    </span><span class="annot"><span class="annottext">[Term v]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-235"></span><span class="annot"><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var">isVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#First"><span class="hs-identifier hs-type">First</span></a></span><span>   </span><span class="annot"><span class="annottext">[Term v]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-236"></span><span class="annot"><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var">isVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Choices"><span class="hs-identifier hs-type">Choices</span></a></span><span> </span><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-237"></span><span class="annot"><a href="DeltaQ.Diagram.html#isVertical"><span class="hs-identifier hs-var">isVertical</span></a></span><span> </span><span class="annot"><span class="annottext">Term v
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-comment">-- | Maximal number of outcomes that are shown vertically.</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- Parallel operations are shown vertically, but also 'Choices'.</span><span>
</span><span id="line-241"></span><span id="local-6989586621679157855"><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-type">maxVertical</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157855"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-242"></span><span id="maxVertical"><span class="annot"><span class="annottext">maxVertical :: forall v. Term v -&gt; Int
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var hs-var">maxVertical</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Seq"><span class="hs-identifier hs-type">Seq</span></a></span><span>   </span><span id="local-6989586621679158752"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158752"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Ord a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Ord a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">maximum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Int) -&gt; [Term v] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Int
forall v. Term v -&gt; Int
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158752"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-243"></span><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Last"><span class="hs-identifier hs-type">Last</span></a></span><span>  </span><span id="local-6989586621679158754"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158754"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Int) -&gt; [Term v] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Int
forall v. Term v -&gt; Int
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158754"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-244"></span><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#First"><span class="hs-identifier hs-type">First</span></a></span><span> </span><span id="local-6989586621679158755"><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158755"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Int) -&gt; [Term v] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term v -&gt; Int
forall v. Term v -&gt; Int
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">[Term v]
</span><a href="#local-6989586621679158755"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-245"></span><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Expr.html#Choices"><span class="hs-identifier hs-type">Choices</span></a></span><span> </span><span id="local-6989586621679158756"><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><a href="#local-6989586621679158756"><span class="hs-identifier hs-var">wts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Int) -&gt; [Int] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Rational, Term v) -&gt; Int) -&gt; [(Rational, Term v)] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term v -&gt; Int
forall v. Term v -&gt; Int
</span><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">(Term v -&gt; Int)
-&gt; ((Rational, Term v) -&gt; Term v) -&gt; (Rational, Term v) -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Rational, Term v) -&gt; Term v
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Rational, Term v)]
</span><a href="#local-6989586621679158756"><span class="hs-identifier hs-var">wts</span></a></span><span>
</span><span id="line-246"></span><span class="annot"><a href="DeltaQ.Diagram.html#maxVertical"><span class="hs-identifier hs-var">maxVertical</span></a></span><span> </span><span class="annot"><span class="annottext">Term v
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-comment">-- | Check whether there is a group of silent foliage that should</span><span>
</span><span id="line-250"></span><span class="hs-comment">-- be closed.</span><span>
</span><span id="line-251"></span><span class="annot"><a href="DeltaQ.Diagram.html#hasGroupClose"><span class="hs-identifier hs-type">hasGroupClose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-252"></span><span id="hasGroupClose"><span class="annot"><span class="annottext">hasGroupClose :: Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#hasGroupClose"><span class="hs-identifier hs-var hs-var">hasGroupClose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; Bool) -&gt; [Shrub EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="#local-6989586621679158757"><span class="hs-identifier hs-var">isGroupClose</span></a></span><span> </span><span class="annot"><span class="annottext">([Shrub EdgeData] -&gt; Bool)
-&gt; (Shrub EdgeData -&gt; [Shrub EdgeData]) -&gt; Shrub EdgeData -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [Shrub EdgeData]
forall a. Shrub a -&gt; [Shrub a]
</span><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var">foliageBushes</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679158757"><span class="annot"><span class="annottext">isGroupClose :: Shrub EdgeData -&gt; Bool
</span><a href="#local-6989586621679158757"><span class="hs-identifier hs-var hs-var">isGroupClose</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679158763"><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158763"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158763"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isSilent"><span class="hs-identifier hs-var">isSilent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData) -&gt; EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; [EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub EdgeData) -&gt; EdgeData
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158763"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">-- | Check whether there are any foliage edges that</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- have no expressions and no siblings.</span><span>
</span><span id="line-259"></span><span class="annot"><a href="DeltaQ.Diagram.html#hasIsolatedTwigs"><span class="hs-identifier hs-type">hasIsolatedTwigs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-260"></span><span id="hasIsolatedTwigs"><span class="annot"><span class="annottext">hasIsolatedTwigs :: Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#hasIsolatedTwigs"><span class="hs-identifier hs-var hs-var">hasIsolatedTwigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; Bool) -&gt; [Shrub EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-var">isIsolatedTwig</span></a></span><span> </span><span class="annot"><span class="annottext">([Shrub EdgeData] -&gt; Bool)
-&gt; (Shrub EdgeData -&gt; [Shrub EdgeData]) -&gt; Shrub EdgeData -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; [Shrub EdgeData]
forall a. Shrub a -&gt; [Shrub a]
</span><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var">foliageBushes</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | 'foliageBushes' returns the collection of all subtrees</span><span>
</span><span id="line-263"></span><span class="hs-comment">-- that consist only of foliage. (These trees have height 1).</span><span>
</span><span id="line-264"></span><span class="hs-comment">--</span><span>
</span><span id="line-265"></span><span class="hs-comment">-- Trees where the immediate children of a root contain both</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- foliage and non-foliage are not returned here!</span><span>
</span><span id="line-267"></span><span id="local-6989586621679157861"><span class="annot"><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-type">foliageBushes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157861"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157861"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-268"></span><span id="foliageBushes"><span class="annot"><span class="annottext">foliageBushes :: forall a. Shrub a -&gt; [Shrub a]
</span><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var hs-var">foliageBushes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-269"></span><span class="annot"><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var">foliageBushes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679158771"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158771"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Shrub a -&gt; Bool) -&gt; [Shrub a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Shrub a -&gt; Bool
forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; Shrub a) -&gt; [(a, Shrub a)] -&gt; [Shrub a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; Shrub a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158771"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158771"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [Shrub a]) -&gt; [(a, Shrub a)] -&gt; [Shrub a]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Shrub a -&gt; [Shrub a]
forall a. Shrub a -&gt; [Shrub a]
</span><a href="DeltaQ.Diagram.html#foliageBushes"><span class="hs-identifier hs-var">foliageBushes</span></a></span><span> </span><span class="annot"><span class="annottext">(Shrub a -&gt; [Shrub a])
-&gt; ((a, Shrub a) -&gt; Shrub a) -&gt; (a, Shrub a) -&gt; [Shrub a]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; Shrub a
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158771"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span class="hs-comment">-- | Emit a column that closes all groups that can be closed</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- at the moment.</span><span>
</span><span id="line-275"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitGroupClose"><span class="hs-identifier hs-type">emitGroupClose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#X"><span class="hs-identifier hs-type">X</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-type">Tile</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span id="emitGroupClose"><span class="annot"><span class="annottext">emitGroupClose :: Int -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitGroupClose"><span class="hs-identifier hs-var hs-var">emitGroupClose</span></a></span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span class="annot"><a href="DeltaQ.Diagram.html#emitGroupClose"><span class="hs-identifier hs-var">emitGroupClose</span></a></span><span> </span><span id="local-6989586621679158773"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158773"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679158774"><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158774"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; Bool) -&gt; [Shrub EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="annot"><span class="annottext">[Shrub EdgeData]
</span><a href="#local-6989586621679158775"><span class="hs-identifier hs-var">children</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Bool) -&gt; [EdgeData] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isSilent"><span class="hs-identifier hs-var">isSilent</span></a></span><span> </span><span class="annot"><span class="annottext">[EdgeData]
</span><a href="#local-6989586621679158776"><span class="hs-identifier hs-var">labels</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Shrub EdgeData] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Shrub EdgeData]
</span><a href="#local-6989586621679158775"><span class="hs-identifier hs-var">children</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-279"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158773"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158777"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">(Token -&gt; Tile) -&gt; Token -&gt; Tile
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Token
</span><a href="DeltaQ.Diagram.html#Close"><span class="hs-identifier hs-var">Close</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Token) -&gt; [Int] -&gt; Token
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">subtract</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158777"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679158779"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Shrub EdgeData
forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var">twig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158777"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Term String)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158780"><span class="annot"><span class="annottext">[[Tile]]
</span><a href="#local-6989586621679158780"><span class="hs-identifier hs-var">tiles</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158781"><span class="annot"><span class="annottext">[Shrub EdgeData]
</span><a href="#local-6989586621679158781"><span class="hs-identifier hs-var">children'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[([Tile], Shrub EdgeData)] -&gt; ([[Tile]], [Shrub EdgeData])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([([Tile], Shrub EdgeData)] -&gt; ([[Tile]], [Shrub EdgeData]))
-&gt; [([Tile], Shrub EdgeData)] -&gt; ([[Tile]], [Shrub EdgeData])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; ([Tile], Shrub EdgeData))
-&gt; [Shrub EdgeData] -&gt; [([Tile], Shrub EdgeData)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Shrub EdgeData -&gt; ([Tile], Shrub EdgeData)
</span><a href="DeltaQ.Diagram.html#emitGroupClose"><span class="hs-identifier hs-var">emitGroupClose</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158773"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Shrub EdgeData]
</span><a href="#local-6989586621679158775"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-282"></span><span>            </span><span id="local-6989586621679158782"><span class="annot"><span class="annottext">tiles2 :: [Tile]
</span><a href="#local-6989586621679158782"><span class="hs-identifier hs-var hs-var">tiles2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Token -&gt; Tile
</span><a href="DeltaQ.Diagram.html#Tile"><span class="hs-identifier hs-var">Tile</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158773"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158783"><span class="hs-identifier hs-var">y2</span></a></span><span> </span><span class="annot"><span class="annottext">Token
</span><a href="DeltaQ.Diagram.html#Horizontal"><span class="hs-identifier hs-var">Horizontal</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679158783"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679158783"><span class="hs-identifier hs-var">y2</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Term String)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158774"><span class="hs-identifier hs-var">ts</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-283"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Tile]] -&gt; [Tile]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">[[Tile]]
</span><a href="#local-6989586621679158780"><span class="hs-identifier hs-var">tiles</span></a></span><span> </span><span class="annot"><span class="annottext">[Tile] -&gt; [Tile] -&gt; [Tile]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Tile]
</span><a href="#local-6989586621679158782"><span class="hs-identifier hs-var">tiles2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EdgeData] -&gt; [Shrub EdgeData] -&gt; [(EdgeData, Shrub EdgeData)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[EdgeData]
</span><a href="#local-6989586621679158776"><span class="hs-identifier hs-var">labels</span></a></span><span> </span><span class="annot"><span class="annottext">[Shrub EdgeData]
</span><a href="#local-6989586621679158781"><span class="hs-identifier hs-var">children'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-285"></span><span>    </span><span id="local-6989586621679158777"><span class="annot"><span class="annottext">y :: Int
</span><a href="#local-6989586621679158777"><span class="hs-identifier hs-var hs-var">y</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. HasCallStack =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679158779"><span class="hs-identifier hs-var">ys</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span id="local-6989586621679158779"><span class="annot"><span class="annottext">ys :: [Int]
</span><a href="#local-6989586621679158779"><span class="hs-identifier hs-var hs-var">ys</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EdgeData -&gt; Int) -&gt; [EdgeData] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">EdgeData -&gt; Int
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[EdgeData]
</span><a href="#local-6989586621679158776"><span class="hs-identifier hs-var">labels</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span id="local-6989586621679158776"><span class="annot"><span class="annottext">labels :: [EdgeData]
</span><a href="#local-6989586621679158776"><span class="hs-identifier hs-var hs-var">labels</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData) -&gt; EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; [EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub EdgeData) -&gt; EdgeData
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158774"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-288"></span><span>    </span><span id="local-6989586621679158775"><span class="annot"><span class="annottext">children :: [Shrub EdgeData]
</span><a href="#local-6989586621679158775"><span class="hs-identifier hs-var hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData) -&gt; Shrub EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; [Shrub EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub EdgeData) -&gt; Shrub EdgeData
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158774"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="annot"><span class="hs-comment">-- | Drop all foliage edges that have no expressions and have no siblings.</span></span><span>
</span><span id="line-291"></span><span class="annot"><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-type">dropIsolatedTwigs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span>
</span><span id="line-292"></span><span id="dropIsolatedTwigs"><span class="annot"><span class="annottext">dropIsolatedTwigs :: Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-var hs-var">dropIsolatedTwigs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-293"></span><span class="annot"><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-var">dropIsolatedTwigs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679158788"><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158788"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-var">isIsolatedTwig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158788"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">([(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; Shrub EdgeData
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[EdgeData] -&gt; [Shrub EdgeData] -&gt; [(EdgeData, Shrub EdgeData)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[EdgeData]
</span><a href="#local-6989586621679158789"><span class="hs-identifier hs-var">labels</span></a></span><span> </span><span class="annot"><span class="annottext">([Shrub EdgeData] -&gt; [(EdgeData, Shrub EdgeData)])
-&gt; [Shrub EdgeData] -&gt; [(EdgeData, Shrub EdgeData)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Shrub EdgeData -&gt; Shrub EdgeData)
-&gt; [Shrub EdgeData] -&gt; [Shrub EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData -&gt; Shrub EdgeData
</span><a href="DeltaQ.Diagram.html#dropIsolatedTwigs"><span class="hs-identifier hs-var">dropIsolatedTwigs</span></a></span><span> </span><span class="annot"><span class="annottext">[Shrub EdgeData]
</span><a href="#local-6989586621679158790"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621679158789"><span class="annot"><span class="annottext">labels :: [EdgeData]
</span><a href="#local-6989586621679158789"><span class="hs-identifier hs-var hs-var">labels</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData) -&gt; EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; [EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub EdgeData) -&gt; EdgeData
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158788"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621679158790"><span class="annot"><span class="annottext">children :: [Shrub EdgeData]
</span><a href="#local-6989586621679158790"><span class="hs-identifier hs-var hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((EdgeData, Shrub EdgeData) -&gt; Shrub EdgeData)
-&gt; [(EdgeData, Shrub EdgeData)] -&gt; [Shrub EdgeData]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(EdgeData, Shrub EdgeData) -&gt; Shrub EdgeData
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(EdgeData, Shrub EdgeData)]
</span><a href="#local-6989586621679158788"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="annot"><span class="hs-comment">-- | Check whether a 'Shrub' is a twig without expression.</span></span><span>
</span><span id="line-301"></span><span class="annot"><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-type">isIsolatedTwig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#EdgeData"><span class="hs-identifier hs-type">EdgeData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-302"></span><span id="isIsolatedTwig"><span class="annot"><span class="annottext">isIsolatedTwig :: Shrub EdgeData -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-var hs-var">isIsolatedTwig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Maybe (Term String)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-303"></span><span class="annot"><a href="DeltaQ.Diagram.html#isIsolatedTwig"><span class="hs-identifier hs-var">isIsolatedTwig</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub EdgeData
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Shrub
    data structure
------------------------------------------------------------------------------}</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- | A 'Shrub' is a rooted tree that has labels (only) on the edges</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- (as opposed to on the leaves).</span><span>
</span><span id="line-311"></span><span class="hs-keyword">newtype</span><span> </span><span id="Shrub"><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-var">Shrub</span></a></span></span><span> </span><span id="local-6989586621679157840"><span class="annot"><a href="#local-6989586621679157840"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Branch"><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unBranch"><span class="annot"><span class="annottext">forall a. Shrub a -&gt; [(a, Shrub a)]
</span><a href="DeltaQ.Diagram.html#unBranch"><span class="hs-identifier hs-var hs-var">unBranch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679157840"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157840"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158794"><span id="local-6989586621679158799"><span class="annot"><span class="annottext">Shrub a -&gt; Shrub a -&gt; Bool
(Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool) -&gt; Eq (Shrub a)
forall a. Eq a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
== :: Shrub a -&gt; Shrub a -&gt; Bool
$c/= :: forall a. Eq a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
/= :: Shrub a -&gt; Shrub a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158813"><span id="local-6989586621679158818"><span id="local-6989586621679158823"><span id="local-6989586621679158828"><span id="local-6989586621679158833"><span id="local-6989586621679158838"><span id="local-6989586621679158843"><span class="annot"><span class="annottext">Eq (Shrub a)
Eq (Shrub a) =&gt;
(Shrub a -&gt; Shrub a -&gt; Ordering)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Bool)
-&gt; (Shrub a -&gt; Shrub a -&gt; Shrub a)
-&gt; (Shrub a -&gt; Shrub a -&gt; Shrub a)
-&gt; Ord (Shrub a)
Shrub a -&gt; Shrub a -&gt; Bool
Shrub a -&gt; Shrub a -&gt; Ordering
Shrub a -&gt; Shrub a -&gt; Shrub a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (Shrub a)
forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Ordering
forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Shrub a
$ccompare :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Ordering
compare :: Shrub a -&gt; Shrub a -&gt; Ordering
$c&lt; :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
&lt; :: Shrub a -&gt; Shrub a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
&lt;= :: Shrub a -&gt; Shrub a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
&gt; :: Shrub a -&gt; Shrub a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Bool
&gt;= :: Shrub a -&gt; Shrub a -&gt; Bool
$cmax :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Shrub a
max :: Shrub a -&gt; Shrub a -&gt; Shrub a
$cmin :: forall a. Ord a =&gt; Shrub a -&gt; Shrub a -&gt; Shrub a
min :: Shrub a -&gt; Shrub a -&gt; Shrub a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158860"><span id="local-6989586621679158865"><span id="local-6989586621679158869"><span class="annot"><span class="annottext">Int -&gt; Shrub a -&gt; ShowS
[Shrub a] -&gt; ShowS
Shrub a -&gt; String
(Int -&gt; Shrub a -&gt; ShowS)
-&gt; (Shrub a -&gt; String) -&gt; ([Shrub a] -&gt; ShowS) -&gt; Show (Shrub a)
forall a. Show a =&gt; Int -&gt; Shrub a -&gt; ShowS
forall a. Show a =&gt; [Shrub a] -&gt; ShowS
forall a. Show a =&gt; Shrub a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; Shrub a -&gt; ShowS
showsPrec :: Int -&gt; Shrub a -&gt; ShowS
$cshow :: forall a. Show a =&gt; Shrub a -&gt; String
show :: Shrub a -&gt; String
$cshowList :: forall a. Show a =&gt; [Shrub a] -&gt; ShowS
showList :: [Shrub a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679158875"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-315"></span><span>    </span><span id="local-6989586621679158880"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; Shrub a -&gt; Shrub b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679158881"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679158881"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679158882"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158882"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(b, Shrub b)] -&gt; Shrub b
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679158881"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158883"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Shrub a -&gt; Shrub b
forall a b. (a -&gt; b) -&gt; Shrub a -&gt; Shrub b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679158881"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub a
</span><a href="#local-6989586621679158884"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158883"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158883"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158884"><span class="annot"><span class="annottext">Shrub a
</span><a href="#local-6989586621679158884"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158882"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><span class="hs-comment">-- | Test whether a 'Shrub' is an isolated root.</span></span><span>
</span><span id="line-318"></span><span id="local-6989586621679157825"><span class="annot"><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-type">isRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157825"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-319"></span><span id="isRoot"><span class="annot"><span class="annottext">isRoot :: forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var hs-var">isRoot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-320"></span><span class="annot"><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="annot"><span class="hs-comment">-- | The 'Shrub' that is an isolated root.</span></span><span>
</span><span id="line-323"></span><span id="local-6989586621679157841"><span class="annot"><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-type">root</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157841"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-324"></span><span id="root"><span class="annot"><span class="annottext">root :: forall a. Shrub a
</span><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="annot"><span class="hs-comment">-- | Test whether a 'Shrub' is a single edge.</span></span><span>
</span><span id="line-327"></span><span id="local-6989586621679158885"><span class="annot"><a href="DeltaQ.Diagram.html#isTwig"><span class="hs-identifier hs-type">isTwig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679158885"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-328"></span><span id="isTwig"><span class="annot"><span class="annottext">isTwig :: forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isTwig"><span class="hs-identifier hs-var hs-var">isTwig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679158887"><span class="annot"><span class="annottext">Shrub a
</span><a href="#local-6989586621679158887"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shrub a -&gt; Bool
forall a. Shrub a -&gt; Bool
</span><a href="DeltaQ.Diagram.html#isRoot"><span class="hs-identifier hs-var">isRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub a
</span><a href="#local-6989586621679158887"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-329"></span><span class="annot"><a href="DeltaQ.Diagram.html#isTwig"><span class="hs-identifier hs-var">isTwig</span></a></span><span> </span><span class="annot"><span class="annottext">Shrub a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="annot"><span class="hs-comment">-- | Construct a 'Shrub' with a single edge.</span></span><span>
</span><span id="line-332"></span><span id="local-6989586621679157824"><span class="annot"><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-type">twig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679157824"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157824"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-333"></span><span id="twig"><span class="annot"><span class="annottext">twig :: forall a. a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#twig"><span class="hs-identifier hs-var hs-var">twig</span></a></span></span><span> </span><span id="local-6989586621679158888"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158888"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158888"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Shrub a
forall a. Shrub a
</span><a href="DeltaQ.Diagram.html#root"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-334"></span><span>
</span><span id="line-335"></span><span class="hs-comment">-- | The 'foliage' of a 'Shrub' is the collection of</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- edges that end in a leaf.</span><span>
</span><span id="line-337"></span><span class="hs-comment">--</span><span>
</span><span id="line-338"></span><span class="hs-comment">-- This function returns the labels of the foliage of the given 'Shrub'.</span><span>
</span><span id="line-339"></span><span id="local-6989586621679157832"><span class="annot"><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-type">foliage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157832"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679157832"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-340"></span><span id="foliage"><span class="annot"><span class="annottext">foliage :: forall a. Shrub a -&gt; [a]
</span><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var hs-var">foliage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-341"></span><span class="annot"><a href="DeltaQ.Diagram.html#foliage"><span class="hs-identifier hs-var">foliage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679158890"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158890"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [a]) -&gt; [(a, Shrub a)] -&gt; [a]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; [a]
forall {a}. (a, Shrub a) -&gt; [a]
</span><a href="#local-6989586621679158891"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158890"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-343"></span><span>    </span><span id="local-6989586621679158891"><span class="annot"><span class="annottext">go :: (a, Shrub a) -&gt; [a]
</span><a href="#local-6989586621679158891"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158893"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158893"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158893"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-344"></span><span>    </span><span class="annot"><a href="#local-6989586621679158891"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679158894"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158894"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [a]) -&gt; [(a, Shrub a)] -&gt; [a]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; [a]
</span><a href="#local-6989586621679158891"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158894"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="hs-comment">-- | Replace the foliage by news 'Shrub's.</span><span>
</span><span id="line-347"></span><span class="hs-comment">--</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- Each edge in the foliage is replaced by the new 'Shrub'</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- whose root is attached to the end of the edge that is not a leaf.</span><span>
</span><span id="line-350"></span><span class="hs-comment">--</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- Special cases:</span><span>
</span><span id="line-352"></span><span class="hs-comment">--</span><span>
</span><span id="line-353"></span><span class="hs-comment">-- * If the new 'Shrub' is 'root', the foliage edge will be removed.</span><span>
</span><span id="line-354"></span><span class="hs-comment">-- * If the new 'Shrub' is a 'twig', the foliage edge will get a new label.</span><span>
</span><span id="line-355"></span><span id="local-6989586621679157835"><span class="annot"><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-type">updateFoliage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679157835"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157835"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157835"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Shrub"><span class="hs-identifier hs-type">Shrub</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679157835"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-356"></span><span id="updateFoliage"><span class="annot"><span class="annottext">updateFoliage :: forall a. (a -&gt; Shrub a) -&gt; Shrub a -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var hs-var">updateFoliage</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Shrub a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-357"></span><span class="annot"><a href="DeltaQ.Diagram.html#updateFoliage"><span class="hs-identifier hs-var">updateFoliage</span></a></span><span> </span><span id="local-6989586621679158896"><span class="annot"><span class="annottext">a -&gt; Shrub a
</span><a href="#local-6989586621679158896"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679158897"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158897"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">([(a, Shrub a)] -&gt; Shrub a) -&gt; [(a, Shrub a)] -&gt; Shrub a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [(a, Shrub a)])
-&gt; [(a, Shrub a)] -&gt; [(a, Shrub a)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; [(a, Shrub a)]
</span><a href="#local-6989586621679158898"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158897"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-358"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621679158898"><span class="annot"><span class="annottext">update :: (a, Shrub a) -&gt; [(a, Shrub a)]
</span><a href="#local-6989586621679158898"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158900"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158900"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Shrub a -&gt; [(a, Shrub a)]
forall a. Shrub a -&gt; [(a, Shrub a)]
</span><a href="DeltaQ.Diagram.html#unBranch"><span class="hs-identifier hs-var">unBranch</span></a></span><span> </span><span class="annot"><span class="annottext">(Shrub a -&gt; [(a, Shrub a)]) -&gt; Shrub a -&gt; [(a, Shrub a)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Shrub a
</span><a href="#local-6989586621679158896"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158900"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><a href="#local-6989586621679158898"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679158901"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158901"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-type">Branch</span></a></span><span> </span><span id="local-6989586621679158902"><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158902"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679158901"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)] -&gt; Shrub a
forall a. [(a, Shrub a)] -&gt; Shrub a
</span><a href="DeltaQ.Diagram.html#Branch"><span class="hs-identifier hs-var">Branch</span></a></span><span> </span><span class="annot"><span class="annottext">([(a, Shrub a)] -&gt; Shrub a) -&gt; [(a, Shrub a)] -&gt; Shrub a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((a, Shrub a) -&gt; [(a, Shrub a)])
-&gt; [(a, Shrub a)] -&gt; [(a, Shrub a)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">(a, Shrub a) -&gt; [(a, Shrub a)]
</span><a href="#local-6989586621679158898"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, Shrub a)]
</span><a href="#local-6989586621679158902"><span class="hs-identifier hs-var">cs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Example expressions
------------------------------------------------------------------------------}</span><span>
</span><span id="line-365"></span><span class="annot"><a href="DeltaQ.Diagram.html#example1"><span class="hs-identifier hs-type">example1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-366"></span><span id="example1"><span class="annot"><span class="annottext">example1 :: O
</span><a href="DeltaQ.Diagram.html#example1"><span class="hs-identifier hs-var hs-var">example1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-367"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AZ&quot;</span></span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%2F%5C."><span class="hs-operator hs-var">./\.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AB&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BZ&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BC&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CZ&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span class="annot"><a href="DeltaQ.Diagram.html#example2"><span class="hs-identifier hs-type">example2</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-371"></span><span id="example2"><span class="annot"><span class="annottext">example2 :: O
</span><a href="DeltaQ.Diagram.html#example2"><span class="hs-identifier hs-var hs-var">example2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;AB&quot;</span></span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BX&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;BC&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CX&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;XY&quot;</span></span><span>
</span><span id="line-375"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;YZ&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;YQ&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;QZ&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span class="annot"><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-type">exampleS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-378"></span><span id="exampleS"><span class="annot"><span class="annottext">exampleS :: O
</span><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-var hs-var">exampleS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;S1&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;S2&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;S3&quot;</span></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span class="annot"><a href="DeltaQ.Diagram.html#example3"><span class="hs-identifier hs-type">example3</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-381"></span><span id="example3"><span class="annot"><span class="annottext">example3 :: O
</span><a href="DeltaQ.Diagram.html#example3"><span class="hs-identifier hs-var hs-var">example3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-382"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">O
</span><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-var">exampleS</span></a></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">O
</span><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-var">exampleS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="annot"><span class="annottext">O
</span><a href="DeltaQ.Diagram.html#exampleS"><span class="hs-identifier hs-var">exampleS</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">O
</span><a href="DeltaQ.Diagram.html#example1"><span class="hs-identifier hs-var">example1</span></a></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ZQ&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span class="annot"><a href="DeltaQ.Diagram.html#exampleCache"><span class="hs-identifier hs-type">exampleCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Expr.html#O"><span class="hs-identifier hs-type">O</span></a></span><span>
</span><span id="line-387"></span><span id="exampleCache"><span class="annot"><span class="annottext">exampleCache :: O
</span><a href="DeltaQ.Diagram.html#exampleCache"><span class="hs-identifier hs-var hs-var">exampleCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><span id="line-388"></span><span>    </span><span class="annot"><span class="annottext">[(Rational, O)] -&gt; O
</span><a href="DeltaQ.Expr.html#choices%27"><span class="hs-identifier hs-var">choices'</span></a></span><span>
</span><span id="line-389"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">95</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c-hit&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">5</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c-miss&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">O
</span><a href="#local-6989586621679158911"><span class="hs-identifier hs-var">net</span></a></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var">.\/.</span></a></span><span> </span><span class="annot"><span class="annottext">O
</span><a href="#local-6989586621679158912"><span class="hs-identifier hs-var">timeout</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-392"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-393"></span><span>    </span><span id="local-6989586621679158911"><span class="annot"><span class="annottext">net :: O
</span><a href="#local-6989586621679158911"><span class="hs-identifier hs-var hs-var">net</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;net&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span> </span><span class="annot"><span class="annottext">O -&gt; O -&gt; O
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var">.&gt;&gt;.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;net&quot;</span></span><span>
</span><span id="line-394"></span><span>    </span><span id="local-6989586621679158912"><span class="annot"><span class="annottext">timeout :: O
</span><a href="#local-6989586621679158912"><span class="hs-identifier hs-var hs-var">timeout</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; O
</span><a href="DeltaQ.Expr.html#var"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;t-out&quot;</span></span><span>
</span><span id="line-395"></span></pre></body></html>