<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">{-|
Copyright   : Neil Davies, 2024
              Predictable Network Solutions Ltd., 2024
License     : BSD-3-Clause
Maintainer  : neil.davies@pnsol.com
Description : Type classes for outcomes and their completion times.

Type classes

* 'Outcome' &#8212; outcomes their combinations.
* 'DeltaQ' &#8212; probability distributions of completion times.

-}</span></span><span>
</span><span id="line-17"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="DeltaQ.Class.html"><span class="hs-identifier">DeltaQ.Class</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Type classes</span></span><span>
</span><span id="line-19"></span><span>      </span><span class="annot"><span class="hs-comment">-- ** Outcome</span></span><span>
</span><span id="line-20"></span><span>      </span><span class="annot"><a href="DeltaQ.Class.html#Outcome"><span class="hs-identifier">Outcome</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** DeltaQ</span></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier">Eventually</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#eventually"><span class="hs-identifier">eventually</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#eventuallyFromMaybe"><span class="hs-identifier">eventuallyFromMaybe</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#maybeFromEventually"><span class="hs-identifier">maybeFromEventually</span></a></span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#DeltaQ"><span class="hs-identifier">DeltaQ</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Properties</span></span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><span class="hs-comment">-- $properties</span></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** Outcome</span></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-comment">-- $properties-outcome</span></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><span class="hs-comment">-- ** DeltaQ</span></span><span>
</span><span id="line-37"></span><span>    </span><span class="annot"><span class="hs-comment">-- $properties-deltaq</span></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Outcome
------------------------------------------------------------------------------}</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">1</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-type">.&gt;&gt;.</span></a></span><span> </span><span class="hs-comment">-- less tight</span><span>
</span><span id="line-45"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">2</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-type">.\/.</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">infixr</span><span> </span><span class="hs-number">3</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#.%2F%5C."><span class="hs-operator hs-type">./\.</span></a></span><span> </span><span class="hs-comment">-- more tight</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | An 'Outcome' is the result of an activity that takes time,</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- such as a distributed computation, communication, bus ride, &#8230; .</span><span>
</span><span id="line-50"></span><span class="hs-comment">--</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- 'Outcome's can be composed in sequence or in parallel.</span><span>
</span><span id="line-52"></span><span class="hs-keyword">class</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="Outcome"><span class="annot"><a href="DeltaQ.Class.html#Outcome"><span class="hs-identifier hs-var">Outcome</span></a></span></span><span> </span><span id="local-6989586621679108869"><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-comment">-- | Numerical type representing times in \( [0,+&#8734;) \).</span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-comment">-- For example 'Double' or 'Rational'.</span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Duration"><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-var">Duration</span></a></span></span><span> </span><span id="local-6989586621679108869"><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-comment">-- | The outcome that never finishes.</span><span>
</span><span id="line-59"></span><span>    </span><span id="never"><span class="annot"><a href="DeltaQ.Class.html#never"><span class="hs-identifier hs-type">never</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-comment">-- | The outcome that succeeds after waiting for a fixed amount of time.</span><span>
</span><span id="line-62"></span><span>    </span><span id="wait"><span class="annot"><a href="DeltaQ.Class.html#wait"><span class="hs-identifier hs-type">wait</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-comment">-- | Sequential composition:</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-comment">-- First run the outcome on the left,</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-comment">-- then run the outcome on the right.</span><span>
</span><span id="line-68"></span><span>    </span><span id="sequentially"><span class="annot"><a href="DeltaQ.Class.html#sequentially"><span class="hs-identifier hs-type">sequentially</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-comment">-- | Infix operator synonym for 'sequentially'.</span><span>
</span><span id="line-71"></span><span>    </span><span id=".%3E%3E."><span class="annot"><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-type">(.&gt;&gt;.)</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679108951"><span class="annot"><a href="DeltaQ.Class.html#.%3E%3E."><span class="hs-operator hs-var hs-var">(.&gt;&gt;.)</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">o -&gt; o -&gt; o
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#sequentially"><span class="hs-identifier hs-var">sequentially</span></a></span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-comment">-- | Parallel composition, first to finish:</span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-comment">-- Run two outcomes in parallel,</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">-- finish as soon as any one of them finishes.</span><span>
</span><span id="line-78"></span><span>    </span><span id="firstToFinish"><span class="annot"><a href="DeltaQ.Class.html#firstToFinish"><span class="hs-identifier hs-type">firstToFinish</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-comment">-- | Infix operator synonym for 'firstToFinish'.</span><span>
</span><span id="line-81"></span><span>    </span><span id=".%5C%2F."><span class="annot"><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-type">(.\/.)</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span id="local-6989586621679108954"><span class="annot"><a href="DeltaQ.Class.html#.%5C%2F."><span class="hs-operator hs-var hs-var">(.\/.)</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">o -&gt; o -&gt; o
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#firstToFinish"><span class="hs-identifier hs-var">firstToFinish</span></a></span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-comment">-- | Parallel composiiton, last to finish:</span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-comment">-- Run two outcomes in parallel,</span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-comment">-- finish after all of them have finished.</span><span>
</span><span id="line-88"></span><span>    </span><span id="lastToFinish"><span class="annot"><a href="DeltaQ.Class.html#lastToFinish"><span class="hs-identifier hs-type">lastToFinish</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-comment">-- | Infix operator synonym for 'lastToFinish'.</span><span>
</span><span id="line-91"></span><span>    </span><span id=".%2F%5C."><span class="annot"><a href="DeltaQ.Class.html#.%2F%5C."><span class="hs-operator hs-type">(./\.)</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108869"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621679108957"><span class="annot"><a href="DeltaQ.Class.html#.%2F%5C."><span class="hs-operator hs-var hs-var">(./\.)</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">o -&gt; o -&gt; o
forall o. Outcome o =&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#lastToFinish"><span class="hs-identifier hs-var">lastToFinish</span></a></span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Eventually
------------------------------------------------------------------------------}</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- | 'Eventually' represents a value that either eventually occurs</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- or is eventually abandoned.</span><span>
</span><span id="line-99"></span><span class="hs-comment">--</span><span>
</span><span id="line-100"></span><span class="hs-comment">-- Similar to the 'Maybe' type, but with a different 'Ord' instance:</span><span>
</span><span id="line-101"></span><span class="hs-comment">-- @Occurs x &lt; Abandoned@ for all @x@.</span><span>
</span><span id="line-102"></span><span class="hs-comment">--</span><span>
</span><span id="line-103"></span><span class="hs-keyword">data</span><span> </span><span id="Eventually"><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-var">Eventually</span></a></span></span><span> </span><span id="local-6989586621679108892"><span class="annot"><a href="#local-6989586621679108892"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Occurs"><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-var">Occurs</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679108892"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Abandoned"><span class="annot"><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679108963"><span id="local-6989586621679108969"><span class="annot"><span class="annottext">Eventually a -&gt; Eventually a -&gt; Bool
(Eventually a -&gt; Eventually a -&gt; Bool)
-&gt; (Eventually a -&gt; Eventually a -&gt; Bool) -&gt; Eq (Eventually a)
forall a. Eq a =&gt; Eventually a -&gt; Eventually a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; Eventually a -&gt; Eventually a -&gt; Bool
== :: Eventually a -&gt; Eventually a -&gt; Bool
$c/= :: forall a. Eq a =&gt; Eventually a -&gt; Eventually a -&gt; Bool
/= :: Eventually a -&gt; Eventually a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679108975"><span id="local-6989586621679108980"><span id="local-6989586621679108984"><span class="annot"><span class="annottext">Int -&gt; Eventually a -&gt; ShowS
[Eventually a] -&gt; ShowS
Eventually a -&gt; String
(Int -&gt; Eventually a -&gt; ShowS)
-&gt; (Eventually a -&gt; String)
-&gt; ([Eventually a] -&gt; ShowS)
-&gt; Show (Eventually a)
forall a. Show a =&gt; Int -&gt; Eventually a -&gt; ShowS
forall a. Show a =&gt; [Eventually a] -&gt; ShowS
forall a. Show a =&gt; Eventually a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; Eventually a -&gt; ShowS
showsPrec :: Int -&gt; Eventually a -&gt; ShowS
$cshow :: forall a. Show a =&gt; Eventually a -&gt; String
show :: Eventually a -&gt; String
$cshowList :: forall a. Show a =&gt; [Eventually a] -&gt; ShowS
showList :: [Eventually a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="annot"><span class="hs-comment">-- | For all @x@, we have @Occurs x &lt; Abandoned@.</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679108884"><span id="local-6989586621679108994"><span id="local-6989586621679108998"><span id="local-6989586621679109001"><span id="local-6989586621679109004"><span id="local-6989586621679109007"><span id="local-6989586621679109010"><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679108884"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-type">Eventually</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108884"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621679109015"><span class="annot"><span class="annottext">compare :: Eventually a -&gt; Eventually a -&gt; Ordering
</span><a href="#local-6989586621679109015"><span class="hs-identifier hs-var hs-var hs-var">compare</span></a></span></span><span> </span><span class="annot"><span class="annottext">Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="annot"><span class="annottext">Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">EQ</span></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">GT</span></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ordering
</span><span class="hs-identifier hs-var">LT</span></span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span id="local-6989586621679109017"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109017"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span id="local-6989586621679109018"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109018"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109017"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109018"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679109021"><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-type">Eventually</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-116"></span><span>    </span><span id="local-6989586621679109025"><span class="annot"><span class="annottext">fmap :: forall a b. (a -&gt; b) -&gt; Eventually a -&gt; Eventually b
</span><span class="hs-identifier hs-var hs-var hs-var">fmap</span></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eventually b
forall a. Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span>
</span><span id="line-117"></span><span>    </span><span class="annot"><span class="hs-identifier hs-var">fmap</span></span><span> </span><span id="local-6989586621679109026"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679109026"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span id="local-6989586621679109027"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109027"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; Eventually b
forall a. a -&gt; Eventually a
</span><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-var">Occurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679109026"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109027"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- &gt; Abandoned &lt;*&gt; _ = Abandoned</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- &gt; _ &lt;*&gt; Abandoned = Abandoned</span><span>
</span><span id="line-122"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679109033"><span id="local-6989586621679109037"><span id="local-6989586621679109040"><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-type">Eventually</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621679109043"><span class="annot"><span class="annottext">pure :: forall a. a -&gt; Eventually a
</span><span class="hs-identifier hs-var hs-var hs-var">pure</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Eventually a
forall a. a -&gt; Eventually a
</span><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-var">Occurs</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">Eventually (a -&gt; b)
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span id="local-6989586621679109044"><span class="annot"><span class="annottext">&lt;*&gt; :: forall a b. Eventually (a -&gt; b) -&gt; Eventually a -&gt; Eventually b
</span><span class="hs-operator hs-var hs-var hs-var">&lt;*&gt;</span></span></span><span> </span><span class="annot"><span class="annottext">Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eventually b
forall a. Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><span class="annottext">Eventually (a -&gt; b)
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eventually b
forall a. Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eventually b
forall a. Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span id="local-6989586621679109045"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679109045"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span id="local-6989586621679109046"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109046"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; Eventually b
forall a. a -&gt; Eventually a
</span><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-var">Occurs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679109045"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109046"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | Helper function to eliminate 'Eventually'.</span><span>
</span><span id="line-131"></span><span class="hs-comment">--</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- See also: 'maybe'.</span><span>
</span><span id="line-133"></span><span id="local-6989586621679108907"><span id="local-6989586621679108908"><span class="annot"><a href="DeltaQ.Class.html#eventually"><span class="hs-identifier hs-type">eventually</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108907"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679108908"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108907"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-type">Eventually</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108908"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108907"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-134"></span><span id="eventually"><span class="annot"><span class="annottext">eventually :: forall b a. b -&gt; (a -&gt; b) -&gt; Eventually a -&gt; b
</span><a href="DeltaQ.Class.html#eventually"><span class="hs-identifier hs-var hs-var">eventually</span></a></span></span><span> </span><span id="local-6989586621679109048"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679109048"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679109048"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-135"></span><span class="annot"><a href="DeltaQ.Class.html#eventually"><span class="hs-identifier hs-var">eventually</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679109049"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679109049"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span id="local-6989586621679109050"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109050"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679109049"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109050"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><span class="hs-comment">-- | Helper function that converts 'Maybe' to 'Eventually'.</span></span><span>
</span><span id="line-138"></span><span id="local-6989586621679108911"><span class="annot"><a href="DeltaQ.Class.html#eventuallyFromMaybe"><span class="hs-identifier hs-type">eventuallyFromMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679108911"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-type">Eventually</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108911"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-139"></span><span id="eventuallyFromMaybe"><span class="annot"><span class="annottext">eventuallyFromMaybe :: forall a. Maybe a -&gt; Eventually a
</span><a href="DeltaQ.Class.html#eventuallyFromMaybe"><span class="hs-identifier hs-var hs-var">eventuallyFromMaybe</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eventually a
forall a. Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span>
</span><span id="line-140"></span><span class="annot"><a href="DeltaQ.Class.html#eventuallyFromMaybe"><span class="hs-identifier hs-var">eventuallyFromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679109051"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109051"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Eventually a
forall a. a -&gt; Eventually a
</span><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-var">Occurs</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109051"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="annot"><span class="hs-comment">-- | Helper function that converts 'Eventually' to 'Maybe'.</span></span><span>
</span><span id="line-143"></span><span id="local-6989586621679108913"><span class="annot"><a href="DeltaQ.Class.html#maybeFromEventually"><span class="hs-identifier hs-type">maybeFromEventually</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-type">Eventually</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108913"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679108913"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-144"></span><span id="maybeFromEventually"><span class="annot"><span class="annottext">maybeFromEventually :: forall a. Eventually a -&gt; Maybe a
</span><a href="DeltaQ.Class.html#maybeFromEventually"><span class="hs-identifier hs-var hs-var">maybeFromEventually</span></a></span></span><span> </span><span class="annot"><span class="annottext">Eventually a
</span><a href="DeltaQ.Class.html#Abandoned"><span class="hs-identifier hs-var">Abandoned</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-145"></span><span class="annot"><a href="DeltaQ.Class.html#maybeFromEventually"><span class="hs-identifier hs-var">maybeFromEventually</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Occurs"><span class="hs-identifier hs-type">Occurs</span></a></span><span> </span><span id="local-6989586621679109052"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109052"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679109052"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    DeltaQ
------------------------------------------------------------------------------}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">-- | 'DeltaQ' &#8212; quality attenuation.</span><span>
</span><span id="line-152"></span><span class="hs-comment">--</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- 'DeltaQ' is a probability distribution of time.</span><span>
</span><span id="line-154"></span><span class="hs-comment">--</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- Specifically, 'DeltaQ' is the probability distribution</span><span>
</span><span id="line-156"></span><span class="hs-comment">-- of finish times for an outcome.</span><span>
</span><span id="line-157"></span><span class="hs-keyword">class</span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-type">Probability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Enum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-type">Probability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Num</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-type">Probability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fractional</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-type">Probability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Outcome"><span class="hs-identifier hs-type">Outcome</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span id="DeltaQ"><span class="annot"><a href="DeltaQ.Class.html#DeltaQ"><span class="hs-identifier hs-var">DeltaQ</span></a></span></span><span> </span><span id="local-6989586621679108916"><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span></span><span>
</span><span id="line-164"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-comment">-- | Numerical type representing probabilities in \( [0,1] \).</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">-- For example 'Double' or 'Rational'.</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span id="Probability"><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-var">Probability</span></a></span></span><span> </span><span id="local-6989586621679108916"><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- | Left-biased random choice.</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- @choice p@ chooses the left argument with probablity @p@</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-comment">-- and the right argument with probability @(1-p)@.</span><span>
</span><span id="line-174"></span><span>    </span><span id="choice"><span class="annot"><a href="DeltaQ.Class.html#choice"><span class="hs-identifier hs-type">choice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-type">Probability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-comment">-- | Random choice between multiple alternatives</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-comment">-- @choices [(w_1, o_1), (w_2, o_2), &#8230;]@ chooses randomly between multiple</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-comment">-- outcomes. The probability @p_i@ for choosing the outcome @o_i@ is</span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-comment">-- determined by the weights as @p_i = w_i / (w_1 + w_2 + &#8230;)@.</span><span>
</span><span id="line-181"></span><span>    </span><span id="choices"><span class="annot"><a href="DeltaQ.Class.html#choices"><span class="hs-identifier hs-type">choices</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-type">Probability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679109061"><span class="annot"><a href="DeltaQ.Class.html#choices"><span class="hs-identifier hs-var hs-var">choices</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">o
forall o. Outcome o =&gt; o
</span><a href="DeltaQ.Class.html#never"><span class="hs-identifier hs-var">never</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="DeltaQ.Class.html#choices"><span class="hs-identifier hs-var">choices</span></a></span><span> </span><span id="local-6989586621679109072"><span class="annot"><span class="annottext">[(Probability o, o)]
</span><a href="#local-6989586621679109072"><span class="hs-identifier hs-var">wos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>        </span><span class="annot"><span class="annottext">((Probability o, o) -&gt; o -&gt; o) -&gt; o -&gt; [(Probability o, o)] -&gt; o
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Probability o -&gt; o -&gt; o -&gt; o) -&gt; (Probability o, o) -&gt; o -&gt; o
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">Probability o -&gt; o -&gt; o -&gt; o
forall o. DeltaQ o =&gt; Probability o -&gt; o -&gt; o -&gt; o
</span><a href="DeltaQ.Class.html#choice"><span class="hs-identifier hs-var">choice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">o
forall o. Outcome o =&gt; o
</span><a href="DeltaQ.Class.html#never"><span class="hs-identifier hs-var">never</span></a></span><span>
</span><span id="line-185"></span><span>        </span><span class="annot"><span class="annottext">([(Probability o, o)] -&gt; o) -&gt; [(Probability o, o)] -&gt; o
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Probability o -&gt; (Probability o, o) -&gt; (Probability o, o))
-&gt; [Probability o] -&gt; [(Probability o, o)] -&gt; [(Probability o, o)]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679109076"><span class="annot"><span class="annottext">Probability o
</span><a href="#local-6989586621679109076"><span class="hs-identifier hs-var">wtot</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679109077"><span class="annot"><span class="annottext">Probability o
</span><a href="#local-6989586621679109077"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679109078"><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679109078"><span class="hs-identifier hs-var">o</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Probability o
</span><a href="#local-6989586621679109077"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Probability o -&gt; Probability o -&gt; Probability o
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="annot"><span class="annottext">Probability o
</span><a href="#local-6989586621679109076"><span class="hs-identifier hs-var">wtot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">o
</span><a href="#local-6989586621679109078"><span class="hs-identifier hs-var">o</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Probability o]
</span><a href="#local-6989586621679109080"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">[(Probability o, o)]
</span><a href="#local-6989586621679109072"><span class="hs-identifier hs-var">wos</span></a></span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-187"></span><span>        </span><span id="local-6989586621679109080"><span class="annot"><span class="annottext">ws :: [Probability o]
</span><a href="#local-6989586621679109080"><span class="hs-identifier hs-var hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Probability o -&gt; Probability o -&gt; Probability o)
-&gt; [Probability o] -&gt; [Probability o]
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">scanr1</span></span><span> </span><span class="annot"><span class="annottext">Probability o -&gt; Probability o -&gt; Probability o
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Probability o, o) -&gt; Probability o)
-&gt; [(Probability o, o)] -&gt; [Probability o]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Probability o, o) -&gt; Probability o
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Probability o, o)]
</span><a href="#local-6989586621679109072"><span class="hs-identifier hs-var">wos</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-comment">-- | Uniform probability distribution on a time interval.</span><span>
</span><span id="line-190"></span><span>    </span><span id="uniform"><span class="annot"><a href="DeltaQ.Class.html#uniform"><span class="hs-identifier hs-type">uniform</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-comment">-- | Probability of /not/ finishing.</span><span>
</span><span id="line-193"></span><span>    </span><span id="failure"><span class="annot"><a href="DeltaQ.Class.html#failure"><span class="hs-identifier hs-type">failure</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-type">Probability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-comment">-- | Probability of finishing within the given time @t@.</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-comment">-- \&quot;Within\&quot; is inclusive,</span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-comment">-- i.e. this returns the probability that the finishing time is @&lt;= t@.</span><span>
</span><span id="line-199"></span><span>    </span><span id="successWithin"><span class="annot"><a href="DeltaQ.Class.html#successWithin"><span class="hs-identifier hs-type">successWithin</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-type">Probability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-comment">-- | Given a probability @p@, return the smallest time @t@</span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">-- such that the probability of completing within that time</span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-comment">-- is at least @p@.</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-comment">-- Return 'Abandoned' if the given probability</span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-comment">-- exceeds the probability of finishing.</span><span>
</span><span id="line-207"></span><span>    </span><span id="quantile"><span class="annot"><a href="DeltaQ.Class.html#quantile"><span class="hs-identifier hs-type">quantile</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Probability"><span class="hs-identifier hs-type">Probability</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-type">Eventually</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- | The earliest finish time with non-zero probability.</span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-comment">-- Return 'Abandoned' if the outcome is 'never'.</span><span>
</span><span id="line-212"></span><span>    </span><span id="earliest"><span class="annot"><a href="DeltaQ.Class.html#earliest"><span class="hs-identifier hs-type">earliest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-type">Eventually</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-comment">-- | The last finish time which still has non-zero probability to occur.</span><span>
</span><span id="line-215"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-comment">-- Return 'Abandoned' if arbitrarily late times are possible.</span><span>
</span><span id="line-217"></span><span>    </span><span id="deadline"><span class="annot"><a href="DeltaQ.Class.html#deadline"><span class="hs-identifier hs-type">deadline</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="DeltaQ.Class.html#Eventually"><span class="hs-identifier hs-type">Eventually</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="DeltaQ.Class.html#Duration"><span class="hs-identifier hs-type">Duration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679108916"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">{-----------------------------------------------------------------------------
    Properties
------------------------------------------------------------------------------}</span><span>
</span><span id="line-222"></span><span class="annot"><span class="hs-comment">{-$properties
All instances of the above type classes are expected to satisfy
the following properties.

For instances that use approximate arithmetic
such as floating point arithmetic or fixed precision arithmetic,
equality may be up to numerical accuracy.
-}</span></span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span class="annot"><span class="hs-comment">{-$properties-outcome

'never'

&gt; never .&gt;&gt;. y = never
&gt; never ./\. y = never
&gt; never .\/. y = y
&gt;
&gt; x .&gt;&gt;. never = never
&gt; x ./\. never = never
&gt; x .\/. never = x

'wait'

&gt; wait t .&gt;&gt;. wait s  =  wait (t+s)
&gt; wait t ./\. wait s  =  wait (max t s)
&gt; wait t .\/. wait s  =  wait (min t s)

'(.&gt;&gt;.)'

&gt; (x .&gt;&gt;. y) .&gt;&gt;. z  =  x .&gt;&gt;. (y .&gt;&gt;. z)

'(./\.)'

&gt; (x ./\. y) ./\. z  =  x ./\. (y ./\. z)
&gt;
&gt; x ./\. y  =  y ./\. x

'(.\/.)'

&gt; (x .\/. y) .\/. z  =  x .\/. (y .\/. z)
&gt;
&gt; x .\/. y  =  y .\/. x

-}</span></span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="annot"><span class="hs-comment">{-$properties-deltaq

'choice'

&gt; choice 1 x y = x
&gt; choice 0 x y = y
&gt;
&gt; choice p x y .&gt;&gt;. z  =  choice p (x .&gt;&gt;. z) (y .&gt;&gt;. z)
&gt; choice p x y ./\. z  =  choice p (x ./\. z) (y ./\. z)
&gt; choice p x y .\/. z  =  choice p (x .\/. z) (y .\/. z)

'choices'

&gt; choices [] = never
&gt; choices ((w,o) : wos) = choice p o (choices wos)
&gt;   where  p = w / (w + sum (map fst wos))

'uniform'

&gt; wait t .&gt;&gt;. uniform r s  =  uniform (t+r) (t+s)
&gt; uniform r s .&gt;&gt;. wait t  =  uniform (r+t) (s+t)

'failure'

&gt; failure never      = 1
&gt; failure (wait t)   = 0
&gt; failure (x .&gt;&gt;. y) = 1 - (1 - failure x) * (1 - failure y)
&gt; failure (x ./\. y) = 1 - (1 - failure x) * (1 - failure y)
&gt; failure (x .\/. y) = failure x * failure y
&gt;
&gt; failure (choice p x y) = p * failure x + (1-p) * failure y
&gt; failure (uniform r s)  = 0

'successWithin'

&gt; successWithin never    t = 0
&gt; successWithin (wait s) t = if t &lt; s then 0 else 1
&gt;
&gt; successWithin (x ./\. y) t =
&gt;   successWithin t x * successWithin t y
&gt; successWithin (x .\/. y) t =
&gt;   1 - (1 - successWithin t x) * (1 - successWithin t y)
&gt;
&gt; successWithin (choice p x y) t =
&gt;   p * successWithin t x + (1-p) * successWithin t y
&gt; successWithin (uniform r s) t
&gt;   | t &lt; r           = 0
&gt;   | r &lt;= t &amp;&amp; t &lt; s = (t-r) / (s-r)
&gt;   | s &lt;= t          = 1

'quantile'

&gt; p &lt;= q  implies  quantile p o &lt;= quantile q o
&gt;
&gt; quantile p never    = Abandoned
&gt; quantile p (wait t) = if p &gt; 0 then Occurs t else Abandoned
&gt;
&gt; quantile p (uniform r s)  =  r + p*(s-t)  if r &lt;= s

'earliest'

&gt; earliest never      = Abandoned
&gt; earliest (wait t)   = Occurs t
&gt; earliest (x .&gt;&gt;. y) = (+) &lt;$&gt; earliest x &lt;*&gt; earliest y
&gt; earliest (x ./\. y) = max (earliest x) (earliest y)
&gt; earliest (x .\/. y) = min (earliest x) (earliest y)
&gt;
&gt; earliest (choice p x y) = min (earliest x) (earliest y)  if p &#8800; 0, p &#8800; 1
&gt; earliest (uniform r s)  = Occurs r   if r &lt;= s

'deadline'

&gt; deadline never      =  Abandoned
&gt; deadline (wait t)   =  Occurs t
&gt; deadline (x .&gt;&gt;. y) =  (+) &lt;$&gt; deadline x &lt;*&gt; deadline y
&gt; deadline (x ./\. y) =  max (deadline x) (deadline y)
&gt;
&gt; deadline (x .\/. y) =  min (deadline x) (deadline y)
&gt;   if failure x = 0, failure y = 0
&gt;
&gt; deadline (choice p x y) = max (deadline x) (deadline y)
&gt;   if p &#8800; 0, p &#8800; 1, failure x = 0, failure y = 0
&gt;
&gt;
&gt; deadline (uniform r s)  = Occurs s   if r &lt;= s

-}</span></span></pre></body></html>